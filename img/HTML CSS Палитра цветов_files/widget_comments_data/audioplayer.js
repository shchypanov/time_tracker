(window.webpackJsonp=window.webpackJsonp||[]).push([["bundles/audioplayer"],{"1V+M":function(e,t,i){"use strict";i.d(t,"a",function(){return s});var a=i("t7n3");function s(e,t){var i=e.play();i&&i.catch&&i.catch(e=>{Object(a.v)(t)&&t(e)})}},"4bNW":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return onRowOver});var _lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("zxIV"),_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Egk5");function onRowOver(audioEl,event,forceRedraw){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"podcast_list_snippet")||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"podcast_snippet__controls")||(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"leaved",!1),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"actions")&&!forceRedraw||Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"no_extra")||(clearTimeout(window.audioRowHoverTO),window.audioRowHoverTO=setTimeout(()=>{var audio=AudioUtils.getAudioFromEl(audioEl),audioObject=AudioUtils.getAudioFromEl(audioEl,!0),actions=[],moreActions=[],context=AudioUtils.getContextPlaylist(audioEl,!0),[contextSection]=AudioUtils.contextSplit(context),extra=AudioUtils.getAudioExtra(audioObject);if(audioObject.isDeleted)if(AudioUtils.isPodcast(audioObject))actions.push(["add",AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"==contextSection)actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{var deleteRestoreInfo=AudioUtils.getAddRestoreInfo();deleteRestoreInfo[audioObject.fullId]&&deleteRestoreInfo[audioObject.fullId].deleteAll&&actions.push(["delete",AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{var actionsList=["next","add","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(AudioUtils.isPodcast(audioObject))actionsList=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.V)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"current_delete","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["recoms","next","edit","add","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=vk.id?["add"]:[];else if(contextSection)switch(contextSection){case"my":case"search_owned_audios":case"module":case"user_list":case"group_list":actionsList=["recoms","edit","next","add","delete","share","open_album","add_to_playlist"];break;case"edit_playlist":actionsList=["add","next","edit"];break;case"recoms_recoms":actionsList=["recoms","next","add","recoms_delete","share","open_album","add_to_playlist"];break;case"recoms_recent_audios":actionsList=["recoms","edit","next","add","listened_delete","share","open_album","add_to_playlist"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add","share","open_album","add_to_playlist"])}actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&each(extra.moder_actions,(i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])});var ap=getAudioPlayer(),currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget&&(AudioUtils.isPodcast(audioObject)||inArray(contextSection,["my","group_list","search_owned_audios"]));each(actionsList,(e,t)=>{switch(t){case"next":audioObject.isCurrent||audioObject.isClaimed||AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":var i=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&(i=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=i&&actions.push(["add",AudioUtils.addAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,AudioUtils.replaceWithOriginal.bind(AudioUtils,audioEl,audioObject))},getLang("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",AudioUtils.isPodcast(audioObject)?AudioUtils.editEpisode:AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":!audioObject.canDelete||audioObject.isInRecomsBlock||vk.widget||actions.push(["delete",AudioUtils.isPodcast(audioObject)?AudioUtils.deleteEpisode:AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"current_delete":actions.push(["current_delete",AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms_delete":audioObject.isInRecomsBlock||actions.push(["recoms_delete",AudioUtils.deleteRecomsAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"listened_delete":audioObject.isInRecomsBlock||actions.push(["listened_delete",AudioUtils.deleteListenedAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"fave":AudioUtils.isPodcast(audioObject)&&actions.push(["fave",AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"share":audioObject.isClaimed||moreActions.push(["share",AudioUtils.shareAudio,getLang("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",getLang("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",AudioUtils.showAudioAlbum,getLang("audio_open_album")]);break;case"open_episode":AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",AudioUtils.openEpisode,getLang("audio_podcast_open_episode")])}}),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){var actionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)('<div class="_audio_row__actions audio_row__actions"></div>');each(actions,(e,t)=>{var i=AudioUtils.getRowActionName(t[0],audioObject,audioEl),a=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)(`<button aria-label="${i}" data-action="${t[0]}" class="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${" "+t[4]||!1}" ${t[3]||""}>${t[2]||""}</button>`);a.addEventListener("click",e=>(t[1]&&t[1].call(window,audioEl,audioObject,audio),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(e))),actionsEl.appendChild(a)});var audioRestorationInfo=AudioUtils.getAddRestoreInfo()[audioObject.fullId];audioRestorationInfo&&"added"===audioRestorationInfo.state&&addClass(audioEl,"audio_row__added");var rowInfoEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__info",audioEl),rowDurationEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__duration",audioEl),rowAlreadyActionsEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__actions",audioEl);if(!rowInfoEl)return;Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.fb)(rowAlreadyActionsEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rb)(rowDurationEl,"visibility","hidden"),rowInfoEl.appendChild(actionsEl);var moreActionsBtnEl=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.H)("_audio_row__action_more",actionsEl);moreActions.length&&moreActionsBtnEl&&setMoreAction(audioEl,audio,audioObject,moreActions,moreActionsBtnEl),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(audioEl,"actions",1)}},forceRedraw?0:10)))}function setMoreAction(e,t,i,a,s){var o=gpeByClass("im-page_classic",e),r=gpeByClass("_im_peer_history_w",e),l=gpeByClass("_im_peer_history",e),d=gpeByClass("_im_chat_body_abs",e),n=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),_=gpeByClass("wk_history_audio_content",e),u={};l?(u.getWrapEl=(()=>o?null:d),u.appendTo=l):_?u.appendTo=_:u.appendToParent=!0;var c=new ElementTooltip(s,extend({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:n,bottomGap:o&&r?parseInt(getStyle(r,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.s)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(e,"leaved")&&AudioUtils.onRowLeave(e)}},u));each(a,(a,s)=>{var o,r,l=Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.mb)(Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,s));"add_to_playlist"==s[0]?(l.addEventListener("mouseenter",o=(()=>{clearTimeout(r),r=setTimeout(()=>{l.removeEventListener("mouseenter",o),AudioUtils.initRowPlaylistsChooser(t,l,c)},150)})),l.addEventListener("mouseleave",()=>{clearTimeout(r)})):l.addEventListener("click",t=>(s[1].call(window,e,i),Object(_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.c)(t)));n.appendChild(l)}),Object(_lib_dom__WEBPACK_IMPORTED_MODULE_0__.i)(e,"tt",c)}},"4e3S":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return AudioLayer});var _lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("98sY");class AudioLayer{static prepare(e){stManager.add(["audio.js","audio.css","suggester.js","auto_list.js","indexer.js"],function(){e&&e()})}constructor(){this._els={layerPlace:ge("top_audio_layer_place"),topPlayBtn:geByClass1("_top_audio_player_play"),topNotaBtn:geByClass1("_top_nav_audio_btn"),topNotaBtnGroup:ge("top_audio_btn_group")}}toggle(e,t){this._initTooltip();var i=this._els.tooltip,a=void 0!==e?e:!i.isShown();a?(i.show(),cancelStackPush("top_audio",()=>{this.toggle(!1,!0)},!0)):(t||cancelStackPop(),i.hide()),toggleClass(this._els.topNotaBtn,"active",a)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){var e=getXY(this._els.layerPlace),t=getXY("ts_wrap")[0]-e[0]-1,i=0;isVisible(this._els.topNotaBtnGroup)?i=-t+(getXY(this._els.topNotaBtn)[0]-e[0])+15:i=-t+(getXY(this._els.topPlayBtn)[0]-e[0])+3;return{left:t,top:0,arrowPosition:i}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="audio_layer_container">\n        <div class="top_audio_loading">\n          ${rs(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=se(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}),ajax.post("al_audio.php",{act:"layer",is_layer:1,is_current_playlist:ap.getCurrentPlaylist()?1:0},{onDone:(html,data,templatesScript)=>{try{eval(templatesScript)}catch(e){Object(_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.e)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage(geByClass1("_audio_page_layout",this._els.container),data),this._initSection="recoms"==data.initSection?data.initSection:void 0,this._page.onLayerShow(this._initSection)}}))}}},B3ia:function(e,t,i){"use strict";var a=i("4e3S"),s=i("pp2G"),o=i("zxIV"),r=i("rEJs");class l{constructor(e,t){this.ap=getAudioPlayer(),this._el=e,this._playIconBtn=Object(o.F)("top_audio"),this._audioBtnGroup=Object(o.F)("top_audio_btn_group"),this.init()}static init(){var e=Object(o.F)("top_audio_player"),t=Object(o.i)(e,"object");t||(t=new l(e),Object(o.i)(e,"object",t))}init(){var e=this;function t(t){return Object(o.V)(this,"top_audio_player_play")?(e.ap.podcastSetActionRef(e.ap.getCurrentAudio(),e.ap.isPlaying()?s.a.PodcastsLogs.ACTION_PAUSE:s.a.PodcastsLogs.ACTION_PLAY,"top_player"),e.ap.isPlaying()?e.ap.pause():e.ap.play(),!1):Object(o.V)(this,"top_audio_player_prev")?(e.ap.playPrev(),!1):Object(o.V)(this,"top_audio_player_next")?(e.ap.playNext(),!1):void 0}this.ap.on(this,r.a.UPDATE,this.onPlay.bind(this)),this.ap.on(this,r.a.PLAY,this.onPlay.bind(this)),this.ap.on(this,r.a.PAUSE,this.onPause.bind(this)),this.ap.top=this,each(["prev","play","next"],function(i,a){addEvent(Object(o.H)("top_audio_player_"+a,e._el),"click",t)}),addEvent(this._el,"mousedown",function(e){if(!Object(o.V)(Object(o.z)(e.target),"top_audio_player_btn"))return 1!=e.which||Object(o.V)(e.target,"top_audio_player_btn")||Object(o.V)(e.target,"top_audio_player_act_icon")||s.a.getLayer().toggle(),cancelEvent(e)}),addEvent(Object(o.F)("top_audio"),"mousedown",function(e){return!0!==checkEvent(e)&&(s.a.getLayer().toggle(),cancelEvent(e))}),browser.safari||addEvent(document,"keydown keyup",function(e){Object(o.wb)(Object(o.F)("top_audio_play"),"shuffle",e.shiftKey)}),this.onPlay(this.ap.getCurrentAudio())}onPlay(e,t,i){var a="top_audio_player_enabled";if(e){var r=()=>{var t=getAudioPlayer();setTimeout(function(){var e=s.a.getLayer();e&&e.isShown()&&e.updatePosition()},1),Object(o.wb)(this._el,"audio_player_podcast",s.a.isPodcast(t.getCurrentAudio())),Object(o.a)(this._el,a),Object(o.wb)(this._el,"top_audio_player_playing",t.isPlaying());var r=Object(o.H)("_top_audio_player_play_blind_label");r&&(r.innerHTML=t.isPlaying()?getLang("global_audio_pause"):getLang("global_audio_play")),e=s.a.asObject(e),clearTimeout(this._currTitleReTO);var d=Object(o.H)("top_audio_player_title_out",this._el);Object(o.fb)(d);var n=Object(o.H)("top_audio_player_title",this._el);if(0!=i){var _=i<0?-10:10,u=`opacity: 0; top: ${_}px; left: ${n.offsetLeft}px`,c=e.performer+" &ndash; "+e.title,h=Object(o.mb)('<div class="top_audio_player_title top_audio_player_title_next" style="'+u+'">'+c+"</div>");h.setAttribute("onmouseover","setTitle(this)"),i>0?domInsertAfter(h,n):domInsertBefore(h,n),Object(o.a)(n,"top_audio_player_title_out"),Object(o.rb)(n,{top:-_,opacity:0}),setTimeout(function(){Object(o.rb)(h,{top:0,opacity:1})},10),clearTimeout(this._currTitleReTO),this._currTitleReTO=setTimeout(function(){Object(o.fb)(n),Object(o.hb)(h,"top_audio_player_title_next")},l.TITLE_CHANGE_ANIM_SPEED)}else n&&(n.innerHTML=e.performer+" &ndash; "+e.title,n.titleSet=0,n.setAttribute("onmouseover","setTitle(this)"))};i=intval(i),Object(o.V)(this._playIconBtn,a)?r():(Object(o.a)(this._playIconBtn,a),setTimeout(()=>{Object(o.W)(this._audioBtnGroup),r()},150))}else{Object(o.hb)(this._playIconBtn,a),Object(o.hb)(this._el,a),Object(o.hb)(this._el,"top_audio_player_playing"),Object(o.hb)(this._el,"audio_player_podcast"),Object(o.ub)(this._audioBtnGroup);var d=Object(o.H)("top_audio_play__button",this._audioBtnGroup);d&&Object(o.hb)(d,"loading");var n=s.a.getLayer();n&&n.isShown()&&n.updatePosition()}}onPause(){Object(o.hb)(this._el,"top_audio_player_playing");var e=Object(o.H)("_top_audio_player_play_blind_label");e&&(e.innerHTML=getLang("global_audio_play"))}onNext(){}}l.TITLE_CHANGE_ANIM_SPEED=190;var d=i("D33C"),n=(i("OEbY"),i("KKXr"),i("XLUH")),_=e=>Math.log(1+34*e)/Math.log(35);class u extends n.a{playerListen(e,t){this.player.on(t,e,t)}playerUnListen(e,t){this.player.off(t)}listenPlay(e,t){this.listen(r.a.PLAY,e,t)}listenPause(e,t){this.listen(r.a.PAUSE,e,t)}listenProgress(e,t){this.listen(r.a.PROGRESS,e,t)}listenVolume(e,t){this.listen(r.a.VOLUME,e,t)}listenSeek(e,t){this.listen(r.a.SEEK,e,t)}listenPlaylistChanged(e,t){this.listen(r.a.PLAYLIST_CHANGED,e,t)}listenEnded(e,t){this.listen(r.a.ENDED,e,t)}listenPlayNext(e,t){this.listen(r.a.PLAY_NEXT,e,t)}listenAdCompleted(e,t){this.listen(r.a.AD_COMPLETED,e,t)}useNewStats(){var e=this.player.getCurrentAudio();return!!e&&Boolean(e[s.a.AUDIO_ITEM_INDEX_NEW_STATS])}getPausedBy(e){var{pausedByVideo:t,pausedByStories:i,pausedByAudio:a,pausedByQueue:s}=this.player;return t&&e<t||window.Videoview&&Videoview.isLayerShown()?"video":i&&e<i||window.cur&&cur.storyLayer?"stories":a&&e<a?"audio":s&&e<s?"queue":null}getState(){var e=super.getState(),t=this.getAudioId();if(t){var i=Object(o.G)("_audio_row_"+t+" audio_row__current",Object(o.F)("page_layout"));if(i&&i.length)return n.b}return e}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){var e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[s.a.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*_(this.player.getVolume()))}getAudioId(){var e=this.player.getCurrentAudio();if(e)return e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.a.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){var e=this.player.getCurrentAudio();if(e)return e[s.a.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){var e=this.player._prevAudio;if(e)return e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.a.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){var e=this.player._prevPlaylist;if(e)return e.getFullId()}getPlaylistId(){var e=this.player.getCurrentPlaylist();if(e)return e.getFullId()}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getListenedTime(){var e=Math.round(this.player._listenedTime);return isNaN(e)?0:e||0}getSearchParams(){var e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){var e=this.player.getCurrentPlaylist();if(e)return e.isShuffled()}isRealPlaylist(){var e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){var e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){var e=this.player.getCurrentAudio();return s.a.isPodcast(e)}isLastTrack(){var e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return!!e&&(!(!e||t)||t.indexOfAudio(e)+1===t.getAudiosCount())}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){var t=this.player.getListenedHash();!t&&window.cur&&cur.audioPage&&(t=cur.audioPage._data.listenedHash);var i=extend({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);isArray(cur.audioLoadTimings)&&(i.timings=cur.audioLoadTimings.join(","),cur.audioLoadTimings=[]),ajax.post("al_audio.php",i,{onDone:e=>{this.player._adsConfig=e}})}}var c=i("6ng+"),h=(i("pIFo"),i("tMHi")),p=i("YvCB"),g=i("1V+M"),A=0,f=3,y="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA";class P{constructor(e){this.type="html5",this.opts=e||{},this._audioNodes=[],this._currentAudioEl=this._createAudioNode(),this._prefetchAudioEl=this._createAudioNode()}destroy(){}getPlayedTime(){for(var e=this._currentAudioEl.played,t=0,i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return t}clearAudioNode(){this._currentAudioEl=this._createAudioNode(y)}_setAudioNodeUrl(e,t){var i=Object(h.a)(t),a=i===y;Object(o.i)(e,"setUrlTime",a?0:vkNow()),this._currentHls&&(e===this._currentAudioEl||a)&&(this._currentHls.destroy(),this._currentHls=null),this._isHlsUrl(i)?this._initHls(e,i):e.src=i}_isHlsUrl(e){return/\.m3u8/.test(Object(h.a)(e))}_initHls(e,t){if(window.Hls){var i=new Hls({debug:!!ls.get("audio_hls_debug"),maxBufferHole:3,nudgeOffset:.5,nudgeMaxRetry:5});i.attachMedia(e),i.loadSource(t),this._currentHls=i,this._hlsError=null,i.on(Hls.Events.ERROR,(e,t)=>{t.details===Hls.ErrorDetails.BUFFER_STALLED_ERROR&&(i.stopLoad(),i.startLoad()),t.fatal&&(console.log("audio hls error",e,t),this._hlsError={type:t.type,details:t.details,url:t.frag&&t.frag.url||t.context&&t.context.url,code:t.networkDetails?t.networkDetails.status:0},this.opts.onFail&&this.opts.onFail())});var a=getAudioPlayer();a.isPlaying()&&!a.ads.isPlaying()&&this.play(t)}else stManager.add("hls.min.js",()=>{this._currentAudioEl===e&&this._initHls(e,t)})}_createAudioNode(e){var t=new Audio;return this.opts.onBufferUpdate&&addEvent(t,"progress",()=>{this._currentAudioEl===t&&this.opts.onBufferUpdate(this.getCurrentBuffered());var e=t.buffered;1===e.length&&0===e.start(0)&&e.end(0)===t.duration&&(t._fullyLoaded=!0)}),this.opts.onProgressUpdate&&addEvent(t,"timeupdate",()=>{this._currentAudioEl===t&&this.opts.onProgressUpdate(this.getCurrentProgress(),this.getPlayedTime())}),this.opts.onEnd&&addEvent(t,"ended",()=>{this._currentAudioEl===t&&this.opts.onEnd()}),this.opts.onSeeked&&addEvent(t,"seeked",()=>{this._currentAudioEl===t&&this.opts.onSeeked()}),this.opts.onSeek&&addEvent(t,"seeking",()=>{this._currentAudioEl===t&&this.opts.onSeek()}),addEvent(t,"error",()=>{AudioUtils.debugLog("HTML5 error track loading"),this._prefetchAudioEl===t?this._prefetchAudioEl=this._createAudioNode():this._currentAudioEl===t&&t.src!==y&&this.opts.onFail&&this.opts.onFail()}),addEvent(t,"canplay",()=>{var e=Object(o.i)(t,"setUrlTime");e&&(cur.audioLoadTimings=cur.audioLoadTimings||[],cur.audioLoadTimings.push(vkNow()-e),Object(o.i)(t,"setUrlTime",0)),this._currentAudioEl===t&&(this.opts.onCanPlay&&this.opts.onCanPlay(),Object(o.i)(t,"canplay",!0))}),addEvent(t,"durationchange",()=>{this._currentAudioEl===t&&this._seekOnReady&&isFinite(t.duration)&&(this.seek(this._seekOnReady),this._seekOnReady=!1)}),t.crossOrigin="anonymous",e&&(this._setAudioNodeUrl(t,e),t.preload="auto",t.volume=this._volume||1,t.load()),this._audioNodes.push(t),this._audioNodes.length>10&&this._audioNodes.splice(0,5),t}onReady(e){e(!0)}prefetch(e){this._isHlsUrl(e)||(this._prefetchAudioEl&&this._setAudioNodeUrl(this._prefetchAudioEl,y),this._prefetchAudioEl=this._createAudioNode(e))}seek(e){var t=this._currentAudioEl;isFinite(t.duration)&&t.src&&t.src!==y?t.currentTime=t.duration*e:this._seekOnReady=e}setVolume(e){void 0===e&&(e=this._currentAudioEl.volume),this._currentAudioEl.volume=e,this._prefetchAudioEl&&(this._prefetchAudioEl.volume=e),this._volume=e}setPlaybackRate(e){this._currentAudioEl.playbackRate=e}getCurrentProgress(){var e=this._currentAudioEl;return isNaN(e.duration)?0:Math.max(0,Math.min(1,e.currentTime/e.duration))}getCurrentBuffered(){var e=this._currentAudioEl;return e&&e.buffered.length?Math.min(1,e.buffered.end(0)/e.duration):0}isFullyLoaded(){return this._currentAudioEl._fullyLoaded}setUrl(e,t){if(!e)return t&&t(!1);var i=Object(h.a)(e),a=this._currentAudioEl;return a.src&&a.src!==y&&(this._seekOnReady=!1),a.src===i||this._currentHls&&this._currentHls.url===i?(this.opts.onCanPlay&&this.opts.onCanPlay(),t&&t(!0)):(this._prefetchAudioEl&&this._prefetchAudioEl.readyState>A&&(this._prefetchAudioEl.src===i?(this._currentAudioEl.pause(0),this._setAudioNodeUrl(this._currentAudioEl,y),this._prefetchAudioEl.readyState>=f&&setTimeout(()=>this.opts.onCanPlay&&this.opts.onCanPlay()),this._currentAudioEl=this._prefetchAudioEl,a=this._currentAudioEl,this._prefetchAudioEl=!1):this._prefetchAudioEl.src&&this._setAudioNodeUrl(this._prefetchAudioEl,y)),a.src!==i&&(this._setAudioNodeUrl(a,i),a.load(),Object(o.i)(this._currentAudioEl,"canplay",null),this._stopFrequencyAnalise()),t&&t(!0))}playAudioEl(e){Object(g.a)(e,t=>{t.code!==t.ABORT_ERR&&Object(p.a)(()=>triggerEvent(e,"error",!1,!0),10)})}play(e){this._stopFrequencyAnalise(),this._prefetchAudioEl.src===Object(h.a)(e)&&this._prefetchAudioEl.readyState>A&&(this._setAudioNodeUrl(this._currentAudioEl,y),this._currentAudioEl=this._prefetchAudioEl,this._prefetchAudioEl=this._createAudioNode(),this.opts.onCanPlay&&this.opts.onCanPlay());var t=this._currentAudioEl;t.src&&(this.playAudioEl(t),this._startFrequencyAnalise())}preparePlay(){if(browser.safari){var e=this._currentAudioEl;this.playAudioEl(e)}}_startFrequencyAnalise(){function e(e,t,i,a){return(i-t)*e/a+t}function t(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,s=null;this._freqUpdateInterval=setInterval(()=>{var r;this._currentAudioEl.paused||!Object(o.i)(this._currentAudioEl,"canplay")?r=[0,0,0,0]:(++i>3&&(i=0,a=s,s=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)],a||(a=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)])),r=[e(i,a[0],s[0],3),e(i,a[1],s[1],3),e(i,a[2],s[2],3),e(i,a[3],s[3],3)]),this.opts&&this.opts.onFrequency(r)},50)}_stopFrequencyAnalise(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts&&this.opts.onFrequency([0,0,0,0])}pause(){var e=this._currentAudioEl;if(e.src){var t=e.pause();void 0!=t&&t.catch(function(){})}this._stopFrequencyAnalise()}stop(){this._currentAudioEl.pause(),this._currentAudioEl=this._createAudioNode(y),this._stopFrequencyAnalise()}_setFadeVolumeInterval(e){if(e){if(!this._fadeVolumeWorker&&window.Worker&&window.Blob){var t=new Blob(["\n          var interval;\n          onmessage = function(e) {\n            clearInterval(interval);\n            if (e.data == 'start') {\n              interval = setInterval(function() { postMessage({}); }, 20);\n            }\n          }\n        "]);try{this._fadeVolumeWorker=new Worker(window.URL.createObjectURL(t))}catch(e){this._fadeVolumeWorker=!1}}this._fadeVolumeWorker?(this._fadeVolumeWorker.onmessage=e,this._fadeVolumeWorker.postMessage("start")):this._fadeVolumeInterval=setInterval(e,60)}else this._fadeVolumeWorker&&(this._fadeVolumeWorker.terminate(),this._fadeVolumeWorker=null),this._fadeVolumeInterval&&clearInterval(this._fadeVolumeInterval)}fadeVolume(e,t){e=Math.max(0,Math.min(1,e));var i=this._currentAudioEl,a=0;if(a=e<i.volume?-.06:.001,Math.abs(e-i.volume)<=.001)return this._setFadeVolumeInterval(),t&&t();var s=i.volume;this._setFadeVolumeInterval(()=>{a>0&&(a*=1.35),s+=a;if(a<0?s<=e:s>=e)return this.setVolume(e),this._setFadeVolumeInterval(),t&&t();this.setVolume(s)})}getErrorData(){var e=this._currentAudioEl.error||{};return{is_hls:this._currentHls?1:0,url:this._currentHls?this._currentHls.url:this._currentAudioEl.currentSrc,error_code:e.code,error_message:e.message,hls_error:this._hlsError?JSON.stringify(this._hlsError):null}}}P.isSupported=(()=>{var e="undefined"!=typeof navigator?navigator.userAgent:"";if(/(Windows NT 5.1|Windows XP)/.test(e)&&(browser.vivaldi||browser.opera||browser.mozilla))return AudioUtils.debugLog("Force no HTML5 (xp vivaldi / opera / mozilla)"),!1;if(/(Windows 7|Windows NT 6.1)/.test(e)&&(browser.vivaldi||browser.opera))return AudioUtils.debugLog("Force no HTML5 (win7 vivaldi / opera)"),!1;var t=document.createElement("audio");if(t.canPlayType){var i=t.canPlayType('audio/mpeg; codecs="mp3"'),a=!!i.replace(/no/,"");return AudioUtils.debugLog("HTML5 browser support "+(a?"yes":"no"),i,e),a}return AudioUtils.debugLog("audio.canPlayType is not available",e),!1});var E="flash_audio";class I{constructor(e){this.type="flash",this.opts=e||{},window._flashAudioInstance=this}static onAudioFinishCallback(){var e=window._flashAudioInstance;e.opts.onEnd&&e.opts.onEnd()}static onAudioProgressCallback(e,t){if(t){var i=window._flashAudioInstance;i._total=t,i._currProgress=e/t,i.opts.onProgressUpdate&&i.opts.onProgressUpdate(i._currProgress,e)}}static onAudioLoadProgressCallback(e,t){var i=window._flashAudioInstance;i._currBuffered=e/t,i.opts.onBufferUpdate&&i.opts.onBufferUpdate(i._currBuffered)}fadeVolume(e,t){return this.setVolume(e),t()}_startFrequencyAnalise(){function e(e,t,i,a){return(i-t)*e/a+t}function t(e,t){return Math.random()*(t-e)+e}this._stopFrequencyAnalise();var i=999,a=null,s=null;this._freqUpdateInterval=setInterval(()=>{var o;++i>3&&(i=0,a=s,s=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)],a||(a=[t(.7,1),t(.55,.8),t(.3,.55),t(.03,.45)])),o=[e(i,a[0],s[0],3),e(i,a[1],s[1],3),e(i,a[2],s[2],3),e(i,a[3],s[3],3)],this.opts.onFrequency(o)},50)}_stopFrequencyAnalise(){this._stopFrequencyAnaliseCallback&&this._stopFrequencyAnaliseCallback(),delete this._stopFrequencyAnaliseCallback,clearInterval(this._freqUpdateInterval),this.opts.onFrequency([0,0,0,0])}destroy(){Object(o.fb)(E)}onReady(e){if(this._player)return e(!0);if(!1===this._player)return e(!1);this._onReady=e;Object(o.F)(E)||document.body.appendChild(Object(o.e)("div",{id:E,className:"fixed"})),renderFlash(E,{url:"/swf/audio_lite.swf",id:"player",height:2},{swliveconnect:"true",allowscriptaccess:"always",wmode:"opaque"},{onPlayFinish:"AudioPlayerFlash.onAudioFinishCallback",onLoadProgress:"AudioPlayerFlash.onAudioLoadProgressCallback",onPlayProgress:"AudioPlayerFlash.onAudioProgressCallback"})&&setTimeout(()=>this._checkFlashLoaded(),50)}setUrl(e,t){var i=Object(h.a)(e);this._url!==i?(this._url=i,this._player&&this._player.loadAudio(i),t&&t(!0)):t&&t(!0)}setVolume(e){this._player&&this._player.setVolume&&this._player.setVolume(e)}setPlaybackRate(){return!1}play(){this._player&&this._player.playAudio(),this._startFrequencyAnalise()}seek(e){var t=(this._total||0)*e;this._player&&this._player.playAudio(t)}pause(){this._player&&this._player.pauseAudio(),this._stopFrequencyAnalise()}isFullyLoaded(){return!1}getPlayedTime(){return 0}getCurrentProgress(){return this._currProgress||0}getCurrentBuffered(){return this._currBuffered||0}stop(){this._player&&this._player.stopAudio(),this._stopFrequencyAnalise()}_checkFlashLoaded(){var e=Object(o.F)("player");if(this._checks=this._checks||0,this._checks++,this._checks>10)return this._player=!1,this._onReady&&this._onReady(!1);e&&e.paused?(this._player=e,this._onReady&&this._onReady(!0),this._onReady=null):setTimeout(()=>this._checkFlashLoaded(),100)}getErrorData(){return{url:this._url}}}var v=i("XBHu"),b=i("xk4V");class m{constructor(){if(this._currentAudio=!1,this._isPlaying=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._tasks=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!1,!vk.isBanned){s.a.debugLog("Player creation");var e=new u(this);this.stats=new c.a(e),this.ads=new v.a(this,m.getVersion()),this._initImpl(),this._initEvents(),this._restoreVolumeState(),this._podcastCleanStates(),setTimeout(()=>{this.restoreState(),s.a.toggleAudioHQBodyClass(),this.updateCurrentPlaying()})}}static getVersion(){return 15}static _sendLCNotification(){var e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){var t="_audio_show_hq_label";return void 0===e?!!ls.get(t):(e=!!e,ls.set(t,e),s.a.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return geByClass(`_audio_row_${e}`,t)}static getDeviceId(){var e=ls.get(m.LS_PREFIX+m.LS_UUID);return e||(e=b(),ls.set(m.LS_PREFIX+m.LS_UUID,e)),e}static showSubscriptionPopup(){showBox("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return intval(ls.get(m.LS_PREFIX+m.LS_DURATION_TYPE))}static _setTabIcon(e){setFavIcon(m.tabIcons[e])}static _lsGet(e){return ls.get(m.LS_PREFIX+e)}static _lsSet(e,t){ls.set(m.LS_PREFIX+e,t)}static _podcastGetStates(){return(m._lsGet(m.LS_PODCASTS)||{}).states||{}}static _podcastSetStates(e){var t=m._lsGet(m.LS_PODCASTS)||{};t.states=e,m._lsSet(m.LS_PODCASTS,t)}static podcastToggleFave(e,t){if(t){t=s.a.asObject(t);var i=s.a.getAudioExtra(t).faveHash;i&&bookmarkPodcast(e,t.fullId,i)}}static podcastGetPlaybackRate(){return(m._lsGet(m.LS_PODCASTS)||{}).rate||1}static getLang(e){var t=getAudioPlayer();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){m._iterateCacheKeys(e=>e===m.LS_VER)}static clearOutdatedCacheKeys(){(ls.get(m.LS_PREFIX+m.LS_SAVED)||0)<vkNow()-72e5&&m._iterateCacheKeys((e,t)=>!inArray(t,[m.LS_PL,m.LS_TRACK,m.LS_PROGRESS]))}static clearAllCacheKeys(){m._iterateCacheKeys(()=>!1),setCookie("remixcurr_audio","",-1)}static _iterateCacheKeys(e){for(var t in window.localStorage)if(0===t.indexOf(m.LS_KEY_PREFIX+"_")){var i=t.split("_");e(i[1],i[2])||localStorage.removeItem(t)}}_initImpl(e){this._impl&&this._impl.destroy();var t=0,i=e=>{if(-1!==t){if(e&&(t++,this._implSetDelay(200),t>3)){t=-1;var i=new MessageBox({title:getLang("global_error")}).content(getLang("audio_error_loading")).setButtons("Ok",function(){t=0,curBox().hide()});return i.show(),Object(p.a)(function(){t=0,i.hide()},3e3),this.notify(r.a.ENDED),void this.notify(r.a.FAILED)}s.a.isPodcast(this.getCurrentAudio())?(this._isPlaying=!1,this.notify(r.a.PAUSE),this.notify(r.a.ENDED),this.stop()):this._repeatCurrent?(this._autoNext=!0,this.notify(r.a.ENDED),this.notify(r.a.PLAY),this.notify(r.a.PROGRESS,0),this._implSeekImmediate(0),Object(p.a)(()=>{this._impl&&this._impl.clearAudioNode&&(this._impl.clearAudioNode(),this._implSetUrl(this.getCurrentAudio())),this._implPlay()})):(this._isPlaying=!1,this.notify(r.a.PAUSE),this.notify(r.a.ENDED),this.playNext(!0)),this._sendListenedData()}},a={onBufferUpdate:e=>{this.notify(r.a.BUFFERED,e)},onEnd:i,onFail:()=>{this._sendPlayerErrorStats(this._impl),i(!0)},onCanPlay:()=>this.notify(r.a.CAN_PLAY),onProgressUpdate:(e,t)=>{var i=this.getCurrentAudio();!this._muteProgressEvents&&i&&this.notify(r.a.PROGRESS,e,i[s.a.AUDIO_ITEM_INDEX_DURATION],t)},onFrequency:e=>{this.notify(r.a.FREQ_UPDATE,e)}};s.a.debugLog("Implementation init"),s.a.debugLog("param browser.flash",browser.flash),s.a.debugLog("param force HTML5",!!e),e?this._impl=new P(a):P.isSupported()?this._impl=new P(a):browser.flash&&(this._impl=new I(a)),this._implSetVolume(0)}onMediaKeyPressedEvent(e){var t=this.getCurrentAudio();this.getCurrentPlaylist();if(t)switch(e.keyCode){case 179:this.isPlaying()?this.pause():this.play();break;case 178:this.seek(0),this.pause();break;case 177:this.playPrev();break;case 176:this.playNext()}}deletePlaylist(e){for(var t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){if(!e.hasMore())return e;each(this._playlists,(i,a)=>{a.getId()===e.getId()&&a.mergeWith(t)})}deleteCurrentPlaylist(){this.stop(),delete this._currentAudio,delete this._currentPlaylist,this.notify(r.a.UPDATE),this.notify(r.a.PLAYLIST_CHANGED),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;var t=s.a.asObject(this.getCurrentAudio()),i=[];if(t){var a=geByClass("_audio_row_"+t.fullId);i=i.concat([].slice.call(a))}for(var o=0,r=this._currentPlayingRows.length;o<r;o++){var l=this._currentPlayingRows[o];l&&!inArray(l,i)&&this.toggleCurrentAudioRow(l,!1,e)}if(t)for(var d=0,n=i.length;d<n;d++){var _=i[d];if(_){if(gpeByClass("article_editor_canvas",_))continue;this.toggleCurrentAudioRow(_,!0,e)}}this._currentPlayingRows=i,each(geByClass("_audio_pl"),(e,t)=>removeClass(t,"audio_pl__playing"));var u=this.getCurrentPlaylist();if(this.isPlaying()&&u){var c=geByClass(`_audio_pl_${u.getOwnerId()}_${u.getPlaylistId()}`);c&&each(c,(e,t)=>addClass(t,"audio_pl__playing"))}}scrollToCurrentPlaying(e,t){var i=m.getAudioElementsByAudioId(e);window.AudioPage&&i.forEach(e=>{var i=currentAudioPage(e);if(i&&i._scroll){var a=i.getPageContainer();m.getAudioElementsByAudioId(t,a).length||i.drawMore(),i.scrollIntoView(m.getAudioElementsByAudioId(t,a)[0],150)}})}toggleCurrentAudioRow(e,t,i){var a=s.a.getAudioFromEl(e,!0);a.isCurrent!==t&&(addClass(e,s.a.AUDIO_CURRENT_CLS),a.withInlinePlayer&&toggleClass(e,"audio_row__player_transition",i),(i=!!a.withInlinePlayer&&i)?setTimeout(()=>this._updateAudioEl(t,e,a,i),0):this._updateAudioEl(t,e,a,i))}_updateAudioEl(e,t,i,a){var o=geByClass1("_audio_row__play_btn",t),l=geByClass1("_audio_row__title",t),d=geByClass1("_audio_row__duration",t),n=s.a.getDurationMod(e?i.duration:i.duration*this.getCurrentProgress()),_=(e,t="")=>{if(d){var i=s.a.getDurationMod(e);d.innerHTML=t+formatTime(e),i!==n&&(replaceClass(d,s.a.AUDIO_DURATION_CLS+"-"+n,s.a.AUDIO_DURATION_CLS+"-"+i),n=i)}};if(i.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,r.a.PLAY,e=>{s.a.asObject(e).fullId===i.fullId&&(addClass(t,s.a.AUDIO_PLAYING_CLS),o&&attr(o,"aria-label",getLang("global_audio_pause")),l&&attr(l,"role","heading"))}),this.on(t,r.a.PROGRESS,(e,t,a)=>{if(i.withInlinePlayer||!this.ads.isPlaying()){a=intval(a);var s=0,o="";m.getDurationType()?(s=Math.round(a-t*a),o="-"):s=Math.round(t*a),_(s,o)}else _(i.duration)}),this.on(t,[r.a.PAUSE,r.a.ENDED],()=>{removeClass(t,s.a.AUDIO_PLAYING_CLS),o&&attr(o,"aria-label",getLang("global_audio_play")),l&&attr(l,"role","")});var u=data(t,"bars");if(!u&&(i.isWithCovers||i.isNumeric||i.isPodcastListSnippet)){if(u=se('<canvas class="audio_row__sound_bars"></canvas>'),i.isPodcastListSnippet?geByClass1("podcast_list_snippet__cover",t).appendChild(u):t.appendChild(u),u.width=s.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),u.height=s.a.AUDIO_ROW_COVER_SIZE*(isRetina()?2:1),u.style.width=s.a.AUDIO_ROW_COVER_SIZE,u.style.height=s.a.AUDIO_ROW_COVER_SIZE,isRetina())u.getContext("2d").scale(2,2);var c=i.isNumeric;this.on(t,r.a.FREQ_UPDATE,(e,t)=>w(u,t,c)),w(u,[0,0,0,0],c),data(t,"bars",u)}toggleClass(t,s.a.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),removeClass(t,s.a.AUDIO_PLAYING_CLS),removeClass(t,s.a.AUDIO_CURRENT_CLS),_(i.duration),o&&attr(o,"aria-label",getLang("global_audio_play")),l&&attr(l,"role","");var h=data(t,"bars");h&&(re(h),data(t,"bars",null))}a?setTimeout(()=>{var e=s.a.getAudioFromEl(t,!0);toggleClass(t,s.a.AUDIO_CURRENT_CLS,!!e.isCurrent)},0):toggleClass(t,s.a.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){removeClass(e,s.a.AUDIO_CURRENT_CLS);var t=data(e,"player_inited");if(t){setTimeout(()=>re(geByClass1("_audio_inline_player",e)),200);var i=geByClass1("_audio_duration",e);i&&(i.innerHTML=formatTime(s.a.getAudioFromEl(e,!0).duration)),this.off(e),each(t.sliders,(e,t)=>t.destroy()),data(e,"player_inited",!1);var a=geByClass1("has_audio_player",e);a&&removeClass(a,"has_audio_player")}}_addRowPlayer(e){if(!(geByClass1("_audio_inline_player",e)||hasClass(e,"podcast_list_snippet")||hasClass(e,"podcast_snippet__controls"))){var t=se(vk.audioInlinePlayerTpl||getTemplate("audio_inline_player")),i=geByClass1("_audio_player__place",e);i.appendChild(t),addClass(i,"has_audio_player");var a=new Slider(geByClass1("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),o=new Slider(geByClass1("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>{var t=s.a.asObject(this.getCurrentAudio());return formatTime(Math.round(e*t.duration))},onEndDragging:e=>{var i=s.a.asObject(this.getCurrentAudio());i&&s.a.isPodcast(i)&&this.podcastSetActionRef(i,s.a.PodcastsLogs.ACTION_SEEK,"",t),this.seek(e)}});this.ads.isPlaying()&&o.toggleAdState(!0),this.on(e,r.a.AD_DEINITED,()=>{}),this.on(e,r.a.AD_READY,()=>{}),this.on(e,r.a.AD_STARTED,()=>{o.toggleAdState(!0),o.setBackValue(0)}),ap.on(e,r.a.AD_COMPLETED,()=>o.toggleAdState(!1)),ap.on(e,r.a.START_LOADING,()=>o.toggleLoading(!0)),ap.on(e,r.a.CAN_PLAY,()=>o.toggleLoading(!1)),ap.on(e,r.a.BUFFERED,(e,t)=>o.setBackValue(t)),ap.on(e,r.a.PROGRESS,(e,t)=>{o.toggleLoading(!1),o.setValue(t)}),ap.on(e,r.a.VOLUME,(e,t)=>{a.setValue(t)}),data(e,"player_inited",{sliders:[a,o]})}}hasStatusExport(){for(var e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e){this._statusExport=e}deleteAudioFromAllPlaylists(e){e=isObject(e)||isArray(e)?s.a.asObject(e).fullId:e,each(this._playlists,(t,i)=>i.removeAudio(e))}updateAudio(e,t){var i="";return isString(e)?i=e:isArray(e)&&(i=s.a.asObject(e).fullId),t||(t=e),each(this._playlists,(e,a)=>{for(var o=a.getAudiosList(),r=function(e,a){`${o[e][s.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${o[e][s.a.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(t)&&each(t,(t,i)=>o[e][t]=i),isArray(t)&&(o[e]=t))},l=0,d=o.length;l<d;l++)r(l)}),`${this._currentAudio[s.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[s.a.AUDIO_ITEM_INDEX_ID]}`===i&&(isObject(t)&&each(t,(e,t)=>this._currentAudio[e]=t),isArray(t)&&(this._currentAudio=t,this.notify(r.a.CURRENT_CHANGED))),this.notify(r.a.UPDATE),e}_triggerTNSPixel(){var e=m._lsGet("tns_triggered_time_v3")||0,t=vkNow();t-e<864e5||(m._lsSet("tns_triggered_time_v3",t),vkImage().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${irand(1,1e9)}`)}_restoreVolumeState(){m.clearDeprecatedCacheKeys(),m.clearOutdatedCacheKeys();var e=m._lsGet(m.LS_VOLUME);this._userVolume=void 0==e||!1===e?m.DEFAULT_VOLUME:e}restoreState(){if(!vk.widget&&(m.clearDeprecatedCacheKeys(),m.clearOutdatedCacheKeys(),!window.cur.audioPreventRestoreTrack)){this._currentAudio=m._lsGet(m.LS_TRACK);var e=m._lsGet(m.LS_PL);e&&(e=JSON.parse(e),this._currentPlaylist=new AudioPlaylist(e),this._initPlayingContext(e.context),e.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=e.originalPlaylistRawId)),this._currentPlaylist&&this._currentAudio?this.notify(r.a.UPDATE):this._currentPlaylist=this._currentAudio=!1;var t=0;if(s.a.isPodcast(this._currentAudio))t=((m._podcastGetStates()[`${this._currentAudio[s.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[s.a.AUDIO_ITEM_INDEX_ID]}`]||{}).position||0)/this._currentAudio[s.a.AUDIO_ITEM_INDEX_DURATION];else t=m._lsGet(m.LS_PROGRESS)||0;this._currentAudio&&t&&this._impl&&0===this._impl.type.indexOf("html5")&&(this._implSetUrl(this._currentAudio,!0),t<1&&this._implSeek(t),this._implSetVolume(0)),this.notify(r.a.CURRENT_CHANGED),this._updatePlaybackRate()}}_ensureImplReady(e){this._impl&&this._impl.onReady(t=>{if(t)return e();"flash"===this._impl.type&&(s.a.debugLog("Flash not initialized, lets try HTML5 as desperate way"),this._initImpl(!0))})}_implNewTask(e,t){this._taskIDCounter=this._taskIDCounter||1,this._tasks=this._tasks||[],this._tasks.push({name:e,cb:t,id:`${e}_${this._taskIDCounter++}`}),this._implDoTasks()}_implDoTasks(){if(this._tasks=this._tasks||[],!this._taskInProgress){var e=this._tasks.shift();e&&(e=clone(e),this._taskInProgress=e.id,this._ensureImplReady(()=>{e.cb.call(this,()=>{this._taskAbort!==e.id?(this._taskInProgress=!1,this._implDoTasks()):this._taskAbort=!1})}))}}_implClearAllTasks(){this._taskAbort=this._taskInProgress,this._taskInProgress=!1,this._tasks=[]}_implClearTask(e){this._tasks=this._tasks||[],this._tasks=this._tasks.filter(t=>t.name!==e)}_implSetDelay(e){this._implNewTask("delay",t=>{Object(p.a)(t,e)})}_implPlay(){this._implNewTask("play",e=>{var t=s.a.asObject(this.getCurrentAudio());if(this._impl.play(t.url),this._muteProgressEvents=!1,this._allowPrefetchNext=!0,t.actionHash&&(s.a.connectListenQueue(),ajax.post("al_audio.php",{act:"start_playback",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash,uuid:m.getDeviceId()})),s.a.isPodcast(t)){var i=this._podcastRestoreState();this._podcastUpdateState(t,i,0,s.a.PodcastsLogs.ACTION_PLAY)}e()})}_implSeekImmediate(e){this._impl&&this._impl.seek(e)}_implSeek(e){this._implClearTask("seek"),this._implNewTask("seek",t=>{this._impl.seek(e),t()})}_implPause(){this._implNewTask("pause",e=>{this._impl.pause(),e()})}_implSetVolume(e,t){if(this._impl)if(t){var i=e?"vol_up":"vol_down";this._implNewTask(i,t=>{this._impl.fadeVolume(e,()=>t())})}else this._implNewTask("vol_set",t=>{this._impl.setVolume(e),t()})}_implSetUrl(e,t){this._implClearTask("url"),this._implNewTask("url",i=>{t||this.notify(r.a.START_LOADING);var a=this._taskInProgress;this._ensureHasURL(e,e=>{a===this._taskInProgress&&(e=s.a.asObject(e),this._impl.setUrl(e.url,e=>{e||(this._implClearAllTasks(),this._onFailedUrl()),i()}))})})}toggleDurationType(){var e=m.LS_PREFIX+m.LS_DURATION_TYPE,t=intval(ls.get(e));ls.set(e,!t),this.notify(r.a.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}_initEvents(){var e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",()=>{this.isPlaying()&&(this.pausedByAudio=vkNow(),this.pause()),delete this.pausedByVideo}),e.addRecvClbk("video_start","audio",()=>{this.isPlaying()&&(this.pause(),this.pausedByVideo=vkNow())}),e.addRecvClbk("video_hide","audio",()=>{!this.isPlaying()&&this.pausedByVideo&&(vkNow()-this.pausedByVideo<18e4&&this.play(),delete this.pausedByVideo)}),e.addRecvClbk("logged_off","audio",()=>{cur.loggingOff=!0,m.clearAllCacheKeys(),this.stop()}),e.addRecvClbk("stories_video_start","audio",()=>{this.isPlaying()&&(this.pause(),this.pausedByStories=vkNow())}),e.addRecvClbk("stories_video_end","audio",()=>{!this.isPlaying()&&this.pausedByStories&&(vkNow()-this.pausedByStories<18e4&&this.play(),delete this.pausedByStories)}))}addPlaylist(e){this.hasPlaylist(e.getId())||this._playlists.push(e)}_cleanUpPlaylists(){for(var e=0,t=-1,i=this._playlists.length-1;i>=0;i--){var a=this._playlists[i];if(!a.isReference()&&(e+=a.getAudiosCount())>4e3){t=i;break}}if(-1!==t){t+=1;for(var s=this._playlists.slice(0,t),o=this.getCurrentPlaylist(),r=[],l=0;l<s.length;l++){var d=s[l];if(o===d&&(d=!1),d&&!d.isReference())for(var n=t;n<this._playlists.length;n++){var _=this._playlists[n];_.isReference()&&_.getSelf()===d&&(d=!1)}d&&r.push(l)}for(var u=0;u<r.length;u++){var c=r[u];this._playlists.splice(c,1)}r.length&&debugLog("AudioPlayer - "+r.length+" playlists removed")}}hasPlaylist(e,t,i){var a;a=void 0!==t&&void 0!==i?`${e}_${t}_${i}`:e;for(var s=0;s<this._playlists.length;s++){var o=this._playlists[s];if(!o.isReference()&&o.getId()===a)return o}return!1}getPlaylist(e,t,i,a){if(e&&!t&&!i){var s=e.split("_");e=s[0],t=s[1],i=s[2]}var o=this.hasPlaylist(e,t,i);return o?(o.mergeWith({accessHash:a}),o):new AudioPlaylist({type:e,ownerId:t,albumId:i,hasMore:e!==AudioPlaylist.TYPE_TEMP,accessHash:a})}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||s.a.getAudioFullId(this._currentAudio)===s.a.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t,i){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(!hasClass(e,"audio_row__added_next")){addClass(e,"audio_row__added_next");var a=this.getCurrentPlaylist();if(a){var o=s.a.asObject(this.getCurrentAudio());if(o&&t.fullId===o.fullId)return;var l=a.indexOfAudio(o);if(-1===l)return;this.notify(r.a.PLAY_NEXT,t.fullId);var d=a.indexOfAudio(t);-1!==d?a.moveAudio(d,l+1):a.addAudio(i,l+1)}else{var n=s.a.getContextPlaylist(e);this.play(i,n.playlist,n.context)}var _=window.AudioPage&&currentAudioPage(e);if(_){var u=_.getPageCurrentPlaylist();u&&_.onUserAction(t,u)}}}on(e,t,i){isArray(t)||(t=[t]),each(t,(t,a)=>this.subscribers.push({context:e,et:a,cb:i}))}off(e){this.subscribers=this.subscribers.filter(t=>t.context!==e)}notify(e,t,i,a){var o=this.getCurrentAudio(),l=s.a.asObject(o);if(this._impl&&(this.ads.isPlaying()||!this._muteProgressEvents||!inArray(e,[r.a.BUFFERED,r.a.PROGRESS])))switch(inArray(e,[r.a.PLAY,r.a.PAUSE])&&(this.subscribers=this.subscribers.filter(e=>!(e.context instanceof Element)||bodyNode.contains(e.context)),this.updateCurrentPlaying(!0)),each(this.subscribers||[],(s,r)=>{r.et===e&&r.cb(o,t,i,a)}),e){case r.a.VOLUME:m._lsSet(m.LS_VOLUME,this._userVolume);break;case r.a.PLAY:this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),m._setTabIcon("play"),this._sendStatusExport();break;case r.a.PLAYLIST_CHANGED:this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio();break;case r.a.PROGRESS:if(this._listenedTime=a,s.a.isPodcast(l))t&&a&&this._podcastUpdateState(l,t,a,s.a.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isPlaying()){var d=this.getCurrentPlaylist(),n=this._impl.getCurrentProgress();if(vk.widget||m._lsSet(m.LS_PROGRESS,n),this._trackListenedData(l,d,a,this._getPlayingContext()),!vk.widget&&this._allowPrefetchNext&&n>=.8){var _=d.getNextAudio(o);_&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(_))}}break;case r.a.PAUSE:s.a.isPodcast(l)&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),s.a.PodcastsLogs.ACTION_PAUSE);var u=this.getCurrentPlaylist();this._trackListenedData(l,u,a,this._getPlayingContext()),m._setTabIcon("pause");break;case r.a.SEEK:s.a.isPodcast(l)&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),s.a.PodcastsLogs.ACTION_SEEK);break;case r.a.ENDED:s.a.isPodcast(l)&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),s.a.PodcastsLogs.ACTION_HEARTBEAT)}}_trackListenedDataSwitch(e,t,i){if(this._currentAudioListenData){this._switchPlaylistRef||(this._switchPlaylistRef=this._currentPlaylist);var a=0,s=this.isAutoPlayed(),o=t&&this._prevContext!==t,r=this._switchPlaylistRef&&i&&this._switchPlaylistRef.getId()!==i.getId();this._seq&&!s?a="next_btn":(o||r)&&(a="playlist_change"),!a&&s&&(a="playlist_next"),this._currentAudioListenData.end_stream_reason=a||"unknown",this._switchPlaylistRef=i}}_trackListenedData(e,t,i,a){if(i=Math.round(i)||0){var o=s.a.asObject(e);if(!o.useNewStats){var r={audio_id:o.fullId,listened:i,context:a};vk.widget&&(r.ref=cur.widgetReferrer||""),t&&(a===AudioPlaylist.TYPE_SEARCH&&(r.search_params=JSON.stringify(t.getSearchParams())),t.getType()===AudioPlaylist.TYPE_PLAYLIST&&(r.playlist_id=t.getFullId&&t.getFullId()),t.isShuffled()&&(r.shuffled=1)),e.trackCode&&(r.track_code=e.trackCode),this.isRepeatCurrentAudio()&&(r.repeat="one"),this.isAutoPlayed()&&(r.auto=1),this.hasPrevAudio()&&(r.prev_audio_id=s.a.asObject(this._prevAudio).fullId),this.hasPrevPlaylist()&&this._prevPlaylist.getType()===AudioPlaylist.TYPE_PLAYLIST&&(r.prev_playlist_id=this._prevPlaylist.getFullId&&this._prevPlaylist.getFullId()),this.isPlaying()||(r.end_stream_reason="stop_btn"),r.state=document.hidden?"background":"app",this._currentAudioListenData=r,clearTimeout(this._sendListenedTO),this._sendListenedTO=setTimeout(()=>{this._sendListenedData()},1e4)}}}_sendListenedData(){clearTimeout(this._sendListenedTO);var e=this._currentAudioListenData;if(this._currentAudioListenData=!1,e&&e.listened&&this.getListenedHash()){var t=extend({act:"listened_data",impl:this._impl.type,hash:this.getListenedHash(),v:5,loc:nav.strLoc},e);isArray(cur.audioLoadTimings)&&(t.timings=cur.audioLoadTimings.join(","),cur.audioLoadTimings=[]),ajax.post("al_audio.php",t,{onDone:e=>this.ads.setAdsConfig(e)})}}_sendPlayerErrorStats(e){var t=s.a.asObject(this.getCurrentAudio());if(t){var{full_id:i}=t,a=extend({audio:i,impl_type:e.type,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",a)}}playLive(e,t){var i=this.getPlaylist(AudioPlaylist.TYPE_LIVE,vk.id,data[0]);i.mergeWith({live:e,hasMore:!1}),e=i.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},extend(t,{onDone:(e,t,a)=>{i.mergeWith({title:t&&t.title,list:[e]}),this.play(e,i,a)}}))}_sendStatusExport(){var e=s.a.asObject(this.getCurrentAudio());if(e){var t=this.statusSent?this.statusSent.split(","):[!1,0],i=vkNow()-intval(t[1]);if(this.hasStatusExport()&&!s.a.isPodcast(e)&&(e.id!=t[0]||i>3e5)){var a=this.getCurrentPlaylist(),o=a?a.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:intval(o&&(o.top_audio||o.top))}),0),this.statusSent=e.id+","+vkNow()}}}saveStateCurrentPlaylist(){if(!vk.widget){var e=this.getCurrentPlaylist();m._lsSet(m.LS_PL,e?e.serialize():null),m._lsSet(m.LS_SAVED,vkNow())}}_saveStateCurrentAudio(){if(!vk.widget){var e=this.getCurrentAudio();if(e){var t=clone(e);t[s.a.AUDIO_ITEM_INDEX_URL]="",m._lsSet(m.LS_TRACK,t),setCookie("remixcurr_audio",`${e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[s.a.AUDIO_ITEM_INDEX_ID]}`,1)}else m._lsSet(m.LS_TRACK,null),setCookie("remixcurr_audio",null,1)}}seekCurrentAudio(e){if(this.ads.isPlaying())return!1;var t=10/s.a.asObject(this.getCurrentAudio()).duration,i=this.getCurrentProgress()+(e?t:-t);i=Math.max(0,Math.min(1,i)),this.seek(i)}setVolume(e){var t=Math.min(1,Math.max(0,e));this._userVolume=t,this._implSetVolume(t),this.ads.updateVolume(),this.notify(r.a.VOLUME,t)}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seek(e){this._implSeekImmediate(e),this.notify(r.a.SEEK)}seekToTime(e,t){var i=this.getCurrentAudio();if(!i)return 0;var a=e/i[s.a.AUDIO_ITEM_INDEX_DURATION];if(a=Math.max(0,a),a=Math.min(a,1),this.seek(a),s.a.isPodcast(i)){var o="",r=s.a.asObject(i);t&&(o=s.a.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(r,s.a.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(r,a,0,o)}return a}_ensureHasURL(e,t){var i=[];this._currentUrlEnsure=this._currentUrlEnsure||{};var a=s.a.asObject(e);if(a){if(a.url)return t&&t(e);var o=this.getCurrentPlaylist(),r=o.indexOfAudio(e);if(r>=0)for(var l=r;l<r+5;l++){var d=s.a.asObject(o.getAudioAt(l));!d||d.url||this._currentUrlEnsure[d.fullId]||(i.push(d.fullId+"_"+d.actionHash+"_"+d.urlHash),this._currentUrlEnsure[d.fullId]=!0)}i.push(a.fullId),i.length&&ajax.post("al_audio.php",{act:"reload_audio",ids:i.join(",")},{onDone:(i,o,r,l)=>{getAudioPlayer().setStatusExportInfo(o),this._listenedHash=r,l&&getAudioPlayer()._podcastSaveData(l),each(i,(t,i)=>{i=s.a.asObject(i);var o={};o[s.a.AUDIO_ITEM_INDEX_URL]=i.url,o[s.a.AUDIO_ITEM_INDEX_ADS]=i.ads,a.fullId===i.fullId&&(o[s.a.AUDIO_ITEM_INDEX_FLAGS]=i.flags,o[s.a.AUDIO_ITEM_INDEX_EXTRA]=i.extra),this.updateAudio(i.fullId,o),a.fullId===i.fullId&&(e[s.a.AUDIO_ITEM_INDEX_URL]=i.url,e[s.a.AUDIO_ITEM_INDEX_ADS]=i.ads,e[s.a.AUDIO_ITEM_INDEX_FLAGS]=i.flags,e[s.a.AUDIO_ITEM_INDEX_EXTRA]=i.extra),this._currentAudio&&s.a.asObject(this._currentAudio).fullId===i.fullId&&(this._currentAudio[s.a.AUDIO_ITEM_INDEX_URL]=i.url,this._currentAudio[s.a.AUDIO_ITEM_INDEX_ADS]=i.ads,this._currentAudio[s.a.AUDIO_ITEM_INDEX_FLAGS]=i.flags,this._currentAudio[s.a.AUDIO_ITEM_INDEX_EXTRA]=i.extra),delete this._currentUrlEnsure[i.fullId]}),t&&t(e)}})}}toggleAudio(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;if(domClosest("_audio_row__tt",t.target))return cancelEvent(t);var i=domClosest("_audio_row",e),a=s.a.getAudioFromEl(i,!0);if(window.getSelection&&window.getSelection().rangeCount){var o=window.getSelection().getRangeAt(0);if(o){var{commonAncestorContainer:r}=o;if(r&&domClosest("_audio_row",r)===i&&o.startOffset!==o.endOffset)return!1}}if(t&&hasClass(t.target,"mem_link"))return nav.go(attr(t.target,"href"),t,{navigateToUploader:!0}),cancelEvent(t);if(hasClass(t.target,"_audio_row__title_inner")){if(s.a.isPodcast(a))return showPodcast(i,a.fullId),cancelEvent(t);if(a.lyrics&&!a.isInAttach)return s.a.toggleAudioLyrics(i,a),cancelEvent(t)}if(hasClass(t.target.parentNode,"audio_row__performers")){if(checkEvent(t)||vk.widget)return!0;if(!gpeByClass("_ape_audio_item",t.target)){var l=domData(t.target,"performer");if(l)return s.a.audioSearchPerformer(t.target,l,t),cancelEvent(t)}return!0}var d=cur.cancelClick||t&&(hasClass(t.target,"audio_lyrics")||domClosest("_audio_duration_wrap",t.target)||domClosest("_audio_inline_player",t.target)||domClosest("audio_performer",t.target)),n=hasClass(t.target,"slider")||domClosest("slider",t.target),_=cur._sliderMouseUpNowEl&&cur._sliderMouseUpNowEl===geByClass1("audio_inline_player_progress",i);if(n&&_&&(d=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,d)return!0;if(s.a.isClaimedAudio(a)||a.isReplaceable){var u=s.a.getAudioExtra(a).claim;if(u)return void(hasClass(i,"no_actions")||a.isInEditBox||showAudioClaimWarning(a,u,s.a.replaceWithOriginal.bind(s.a,i,a)))}if(this.podcastSetActionRef(a,a.isPlaying?s.a.PodcastsLogs.ACTION_PAUSE:s.a.PodcastsLogs.ACTION_PLAY,"",i),a.isPlaying)this.pause();else{var c=s.a.getContextPlaylist(i);this.play(a.fullId,c.playlist,a.context||c.context),cur.audioPage&&cur.audioPage.onUserAction(a,c.playlist)}s.a.onRowOver(i,!1,!0)}_onFailedUrl(){this.notify(r.a.FAILED),this.isPlaying()&&(this.pause(),this.playNext(!0,!0))}playNextPlaylist(e,t,i){var a=this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,i);a.loadAll(()=>{var e=this.getCurrentPlaylist();if(e)e.addAudio(a.getAudiosList());else{this._currentPlaylist=new AudioPlaylist(a);var t=a.getAudioAt(0);t&&(this._currentAudio=t,this.notify(r.a.UPDATE),this.notify(r.a.PLAYLIST_CHANGED),this.updateCurrentPlaying())}}),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}playPlaylist(e,t,i,a,s){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;this.playNextInPlaylist(e,t,i,a,{shuffled:s,preDoPlay:e=>{s&&(e.isShuffled()&&e.shuffle(0),e.shuffle(irand(1,999999),!0))}})}playBlock(e,t,i,a,s,o="default"){this.playNextInPlaylist(e,t,i,a,{type:s,trackType:o,shuffled:!1})}playNextInPlaylist(e,t,i,a,s={}){var o=this.getCurrentPlaylist(),r=this.getPlaylist(s.type||AudioPlaylist.TYPE_PLAYLIST,e,t,i);if(o&&o.getId()===r.getId()&&this.isPlaying()&&!s.shuffled)this.pause();else{var l=()=>{s.preDoPlay&&s.preDoPlay(r);var e=r.getNextAudio(!1,!0);e&&this.play(e,r,a)};r.load(0,l,null,s.trackType),r.getAudiosCount()&&!s.shuffled?l():this._impl&&this._impl.preparePlay&&!this.ads.isPlaying()&&this._impl.preparePlay()}}_initPlayingContext(e){this._playingContext=e}getListenedHash(){return this._listenedHash||""}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}play(e,t,i,a,o){if(!cur.loggingOff)if(this._impl){this._seq=a,this._autoNext=o,this._prevAudio=this._currentAudio,this._cleanUpPlaylists(),(isObject(e)||isArray(e))&&(e=s.a.asObject(e))&&(e=e.fullId);var l=s.a.asObject(this._currentAudio),d=this.getCurrentPlaylist();!e&&l&&(e=l.fullId);var n=!1,_=e&&l&&e==l.fullId;t?d&&(n=t==d.getSelf()||t==d):(t=d,n=!0),n||i||debugLog("New playlist play init without context"),i&&(this._prevContext=this._playingContext,this._initPlayingContext(i));var u=t.getAudio(e);if(u&&t.load(t.indexOfAudio(u)+3),_||(this._trackListenedDataSwitch(l,i,t),this._sendListenedData(),t.getType()===AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(u)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),l&&s.a.isPodcast(l)&&this.isPlaying()&&this._podcastUpdateState(l,this.getCurrentProgress(),this._impl.getPlayedTime(),s.a.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0})),_||this.ads.isPlaying()||this.ads.deinit(),_&&n)this.ads.isPlaying()?this.ads.resume():this.isPlaying()||(this._isPlaying=!0,m._sendLCNotification(),this.notify(r.a.PLAY),_||this.notify(r.a.PROGRESS,0),this._implClearAllTasks(),this._implSetVolume(0),this._implSetUrl(u),this._implPlay(),this._updatePlaybackRate(),this._implSetVolume(this.getVolume(),!0),s.a.isPodcast(u)&&this._podcastUpdateState(s.a.asObject(u),this.getCurrentProgress(),this._impl.getPlayedTime()));else if(e&&u)if(this._currentAudio=u,n||(this._currentPlaylist&&(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio),this._currentPlaylist=new AudioPlaylist(t),this.notify(r.a.PLAYLIST_CHANGED)),this.notify(r.a.CURRENT_CHANGED),this._isPlaying=!0,this.updateCurrentPlaying(!0),l&&this.scrollToCurrentPlaying(l.fullId,e),this.ads.isPlaying())this.notify(r.a.PLAY,!0),this.ads.resume();else{m._sendLCNotification(),this.notify(r.a.PLAY,!0,intval(a),o),this.notify(r.a.PROGRESS,0),this._muteProgressEvents=!0,this._implClearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay();var c=s.a.asObject(u);o?this.ads.startPlay(c,!1,()=>{(u=this.getCurrentAudio())&&this.isPlaying()&&(this.notify(r.a.UPDATE),this._implSetUrl(u),this._implPlay(),this._updatePlaybackRate(),this._implSetVolume(this.getVolume()),this._triggerTNSPixel())}):(this._implSetVolume(0,!0),this._implPause(),this.ads.startPlay(c,!0,()=>{(u=this.getCurrentAudio())&&this.isPlaying()&&(this.notify(r.a.UPDATE),this._implSetUrl(u),this._implPlay(),this._updatePlaybackRate(),this._implSetVolume(this.getVolume()),this._triggerTNSPixel())}))}}else s.a.showNeedFlashBox()}preloadDefaultPlaylist(e){browser.safari&&!m._lsGet(m.LS_TRACK)&&this.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,e).load()}instantPlay(e,t,i){var a=!browser.safari&&t&&t.shiftKey;this.playPlaylist(vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID,i,"header",a),statlogsValueEvent("client_header_play_button",a?"shuffle":"play"),setTimeout(()=>{addClass(e,"loading")},400)}_prefetchAudio(e){(e=s.a.asObject(e))&&e.url&&this._impl.prefetch&&this._impl.prefetch(e.url)}getCurrentPlaylist(){return this._currentPlaylist}getPlaylists(){return clone(this._playlists)}pause(){this.ads.isPlaying()&&this.ads.pause(),this._isPlaying=!1,this.notify(r.a.PAUSE),this._implSetVolume(0,!0),this._implPause()}stop(){this._isPlaying=!1,this._impl.stop(),this.notify(r.a.STOP)}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e}getCurrentAudio(){return this._currentAudio}playNext(e){this._playNext(1,e)}playPrev(){this._playNext(-1)}_playNext(e,t){if(!this.ads.isPlaying()){var i=10,a=this.getCurrentAudio(),o=this.getCurrentPlaylist(),l=(e,i)=>{s.a.isClaimedAudio(e)||this.play(e,o,!1,i,t)};if(a&&o)if(e>0){for(var d=o.getNextAudio(a);i&&d&&s.a.isClaimedAudio(d);)d=o.getNextAudio(d),i--;if(d)l(d,1);else if(o.isLive())this._muteProgressEvents=!0,o.fetchNextLiveAudio(e=>l(e,1));else{if(d=o.getAudioAt(0),s.a.isClaimedAudio(d))for(var n=o.getAudiosList(),_=o.getAudiosCount(),u=0;u<_;u++){var c=n[u];if(!s.a.isClaimedAudio(c)){d=c;break}}if(!this.isRepeatAll())if(o.indexOfAudio(a)+1===o.getAudiosCount())return this._implSeekImmediate(0),this.stop(),void(s.a.isClaimedAudio(d)||(this._currentAudio=d,this.updateCurrentPlaying(!0),this.notify(r.a.CURRENT_CHANGED),this.notify(r.a.UPDATE)));l(d,1)}}else{var h=o.indexOfAudio(this._currentAudio)-1;if(h<0)this.seek(0);else{for(var p=o.getAudioAt(h);i&&p&&s.a.isClaimedAudio(p);)p=o.getAudioAt(--h),i--;p?l(p,-1):this.seek(0)}}}}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,i,a,s){var o=m._podcastGetStates(),r=Math.round(e.duration*t);o[e.fullId]={t:vkNow(),position:r},m._podcastSetStates(o),a&&this._podcastSendLogs(a,e,i,r,s)}_podcastSendLogs(e,t,i,a,o){if(t&&e&&s.a.isPodcast(t)&&(!cur._podcastsActionId||!cur._podcastsActionId[e]||this._podcastsActionLastId[e]!==cur._podcastsActionId[e])){var r=this._podcastsActionRef[t.fullId]||{},l=r[e]||{};s.a.PodcastsLogs.log(e,extend({audio:t,position:a,listen:i},l,o||{})),delete r[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}}podcastSetActionRef(e,t,i,a){e=s.a.asObject(e),t&&s.a.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:i,refEl:a},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=irand(0,1e6))}_podcastCleanStates(){var e=m._podcastGetStates(),t=!1;return each(e,(i,a)=>{Date.now()-a.t>2419200&&(delete e[i],t=!0)}),t&&m._podcastSetStates(e),e}_podcastSaveData(e){var t=m._podcastGetStates();each(e,(e,i)=>{var a=i.state;if(a){var s=+a[1];(!t[e]||!t[e][1]||s&&s>t[e][1])&&(t[e]={position:+a[0],t:Date.now()})}}),m._podcastSetStates(t)}_podcastRestoreState(){var e=s.a.asObject(this.getCurrentAudio());if(!s.a.isPodcast(e))return 0;var t=0;cur.podcastSeekToTime?(t=this.seekToTime(cur.podcastSeekToTime,cur.podcastSeekToTimeRef),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef):(t=((m._podcastGetStates()[e.fullId]||{}).position||0)/e.duration)&&t<1&&this._implSeek(t);return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!s.a.isPodcast(this._currentAudio)&&s.a.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){this._implNewTask("playback_rate",e=>{var t=!this.ads.isPlaying()&&s.a.isPodcast(this._currentAudio)?m.podcastGetPlaybackRate():1;this._impl.setPlaybackRate(t),e()})}podcastChangePlaybackRate(e){var t=m._lsGet(m.LS_PODCASTS)||{},i=t.rate||1;e?i-=m.PLAYBACK_RATE_STEP:i+=m.PLAYBACK_RATE_STEP,!e&&i>m.PLAYBACK_RATE_MAX?i=1:e&&i<1&&(i=m.PLAYBACK_RATE_MAX),t.rate=i,m._lsSet(m.LS_PODCASTS,t),this._updatePlaybackRate()}playAudio(e){var t=new AudioPlaylist(AudioPlaylist.TYPE_TEMP);t.mergeWith({list:[e]}),this.play(e,t)}}m.LS_VER="v20",m.LS_KEY_PREFIX="audio",m.LS_PREFIX=m.LS_KEY_PREFIX+"_"+m.LS_VER+"_",m.LS_VOLUME="vol",m.LS_PL="pl",m.LS_TRACK="track",m.LS_SAVED="saved",m.LS_PROGRESS="progress",m.LS_PODCASTS="podcasts",m.LS_DURATION_TYPE="dur_type",m.LS_UUID="uuid",m.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",m.PLAYBACK_RATE_STEP=.5,m.PLAYBACK_RATE_MAX=3,m.DEFAULT_VOLUME=.4761515102104643;var O=window.devicePixelRatio>=2?"_2x":"";function w(e,t,i){var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.fillStyle=i?"#3D6899":"#ffffff";for(var s=0;s<4;s++){var o=2+12*t[s];a.fillRect(13+4*s,12-o+14,2,o)}}function T(){window.AudioLayer=a.a,window.AudioUtils=s.a,window.TopAudioPlayer=l,window.AudioPlaylist=d.a,window.AudioPlayer=m}m.tabIcons={def:`/images/icons/favicons/fav_logo${O}.ico`,play:`/images/icons/favicons/fav_play${O}.ico`,pause:`/images/icons/favicons/fav_pause${O}.ico`},i.d(t,"a",function(){return T})},D33C:function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return AudioPlaylist});var core_js_modules_es6_regexp_search__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("OG14"),core_js_modules_es6_array_sort__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("Vd3H"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("pIFo"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("KKXr"),_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("pp2G"),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("PMB/");class AudioPlaylist{constructor(e,t,i){getAudioPlayer().addPlaylist(this);var a={};if(e&&isFunction(e.getId))return this._ref=e,void getAudioPlayer().addPlaylist(this);isObject(e)?a=e:(a.ownerId=t,a.type=e,a.albumId=i||++AudioPlaylist.plIndex),this._type=a.type,this._ownerId=a.ownerId||vk.id,this._albumId=a.albumId||0,this._fromId=a.fromId||0,this._list=[],this.mergeWith(a)}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&isObject(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getOwnerId(){return this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getRawId(){return this.getSelf()._rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getFeedFrom(){return this.getSelf()._feedFrom}getFeedOffset(){return this.getSelf()._feedOffset}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getShuffle(){return this.getSelf()._shuffle}getFriendId(){return this.getSelf()._friend}getNextOffset(){var e=this.getSelf();return e._forceReload?(e._forceReload=!1,0):""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getAudiosList(){return this.getSelf()._list||[]}getSortedAudiosList(){return this.getSelf()._sortedList||this.getAudiosList()||[]}getUnshuffledAudiosList(){var e=this.getSelf();return e._originalList?e._originalList:e._list}getItemsList(){return this.getSelf()._items||[]}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){var e=this.getSelf()._live;return!!e&&{hostId:(e=e.split(","))[0],audioId:e[1],hash:e[2]}}getAudioAt(e){return this.getSelf()._list.length>e?this.getSelf()._list[e]:null}getAudiosCount(){return this.getSelf()._list.length}getTotalDuration(){var e=this.getAudiosList(),t=0;return each(e,function(e,i){t+=i[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_DURATION]}),t}getItemsCount(){var e=this.getSelf();return e._items=e._items||[],e._items.length}setForceReload(e){this.getSelf()._forceReload=e}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){var t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isShuffled(){return!!this.getShuffle()}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}isInitedSortedList(){return!!this.getSelf()._sorted}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}_unref(){var e=this._ref;if(isObject(e)){var t={};for(var i in e)if(e.hasOwnProperty(i)&&!isFunction(e[i])&&0===i.indexOf("_")){var a=e[i];t[i.substr(1)]=isObject(a)?clone(a):a}t.hasMore=!1,delete t.ownerId,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._ownerId=t.ownerId||vk.id,this._albumId=AudioPlaylist.plIndex++,this._list=[],this.mergeWith(t)}}equals(e){return this.getSelf()===e.getSelf()}serialize(){var e={},t=getAudioPlayer().getCurrentAudio(),i=Math.max(0,this.indexOfAudio(t));return e.list=clone(this.getAudiosList().slice(Math.max(0,i-100),i+300),!0),each(e.list,function(e,t){t[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_URL]=""}),e.type=AudioPlaylist.TYPE_TEMP,e.ownerId=vk.id,e.albumId=irand(1,999),e.hasMore=!1,e.title=this.getTitle(),e.context=getAudioPlayer()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),JSON.stringify(e)}toString(){return this.getId()}_moveCurrentAudioAtFirstPosition(){var e=getAudioPlayer().getCurrentAudio(),t=this.getSelf(),i=this.indexOfAudio(e);-1!==i&&(t._list.splice(i,1),t._list.unshift(e),t._movedAudioToFirstPos=i)}_resetMovedAudioToInitialPosition(){var e=this.getSelf();if(e._movedAudioToFirstPos){var t=e._list.splice(0,1);e._list.splice(e._movedAudioToFirstPos,0,t[0]),delete e._movedAudioToFirstPos}}_ensureIndex(e){var t=this.getSelf();if(t._index)e&&e();else{var i=function(e,t){var i=intval(t);return i>=33&&i<48?String.fromCharCode(i):e};t._index=new vkIndexer(t._list,function(e){return(e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,i)},e)}}clean(e){e||this._unref();var t=this.getSelf();t._hasMore=!0,t._list=[],t._items=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){var t=this.getSelf();t._originalList||(t._originalList=[].concat(t._list)),t._sorted=!0,t._list=e}removeSortedList(){var e=this.getSelf();e._originalList&&(e._list=[].concat(e._originalList)),e._sorted=!1}shuffle(e,t){if(!(this.isShuffled()&&e||!this.isShuffled()&&!e)){var i=this.getSelf();if(delete i._sorted,e){var a=!1;if(this.hasMore())if(this.getType()===AudioPlaylist.TYPE_SEARCH)i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),a=!0;else if(inArray(this.getType(),[AudioPlaylist.TYPE_RECOM])){var s=getAudioPlayer().getCurrentAudio(),o=this.indexOfAudio(s);this.clean(!0),o>=0&&i.addAudio(s,0),a=!0}else this._unref(),(i=this.getSelf())._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),a=!0;else i._originalList=i._originalList||[].concat(i._list),shuffle(i._list),t||this._moveCurrentAudioAtFirstPosition(),a=!0;a&&(i._shuffle=e)}else i._originalList?i._list=i._originalList:this.clean(!0),delete i._shuffle,delete i._originalList;return!0}}getNextAudio(e,t){if(!e)return!!(e=this.getAudioAt(0))&&(t&&_utils__WEBPACK_IMPORTED_MODULE_4__.a.asObject(e).isClaimed?this.getNextAudio(e,!0):e);var i=this.indexOfAudio(e);if(i<0)return!1;if(i+1<this.getAudiosCount()){var a=this.getAudioAt(i+1);return t&&_utils__WEBPACK_IMPORTED_MODULE_4__.a.asObject(a).isClaimed?this.getNextAudio(a,!0):a}return!1}removeAudio(e){var t=this.indexOfAudio(e);if(t>=0){this._unref();var i=this._list.splice(t,1);return this._index&&this._index.remove(i[0]),t}return-1}addAudio(e,t){this._unref();var i=void 0===t,a=e=>{var a=this.getUnshuffledAudiosList(),s=this.indexOfAudio(e);if(s>=0){if(i)return;a.splice(s,1)}(e=clone(e))[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_TITLE]=clean(replaceEntities(e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_PERFORMER]=clean(replaceEntities(e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,"")),i?a.push(e):a.splice(t,0,e),this._index&&this._index.add(e)};if(isArray(e)&&isArray(e[0]))for(var s=0,o=e.length;s<o;s++)a(e[s]);else e&&e.length&&a(e)}moveAudio(e,t){this._unref();var i=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,i[0])}indexOfAudio(e){if(!e)return-1;var t;isString(e)?t=e.split("_"):isObject(e)?t=[e.ownerId,e.id]:isArray(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_ID]]);var i=this.getSelf()._list;if(!i)return-1;for(var a=0,s=i.length;a<s;a++)if(i[a]&&t[0]==i[a][_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==i[a][_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_ID])return a;return-1}getAudio(e){if(!e)return null;var t=this.getSelf();e=e.split("_");for(var i=0,a=t._list.length;i<a;i++)if(e[0]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[i][_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_ID])return t._list[i];return null}loadAll(e){if(!this.isFullyLoadable())return e&&e();this.load(0,e,!0)}load(offset,onDone,needAll,trackType="default"){isFunction(offset)&&(onDone=offset,offset=0);var searchParams=this.getSearchParams();offset=intval(offset);var countAvailable=this.getType()===AudioPlaylist.TYPE_FEED?this.getItemsCount():this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t)=>{var i=this._onDoneLoading;delete this._onDoneLoading,delete this._loadingAll,each(i||[],(e,i)=>{i&&i(this,t)})};if(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery)return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),!this._loadingAll){if(needAll)return this._loadingAll=!0,void Object(_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.a)(this,callOnDones);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout);var ownerId=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();ajax.post("al_audio.php",{act:"load_section",type:this.getType(),owner_id:ownerId,playlist_id:this.getPlaylistId(),offset:offset,access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?intval(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),shuffle:this.getShuffle(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:intval(nav.objLoc.claim),track_type:trackType},{onDone:(loadedPlaylist,tpl,langs,templatesScript)=>{if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!this._loadingAll||needAll){var audioPlayer=getAudioPlayer();audioPlayer.mergePlaylistData(this,loadedPlaylist),callOnDones(),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}}})}}mergeWith(e){if(!isObject(this._ref)){if(e.list&&this.addAudio(e.list),e.items){this._items=this._items||[];for(var t=0,i=e.items.length;t<i;t++)this._items.push(e.items[t])}each(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","originalList","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","shuffle","subTitle","title","totalCount","totalCountHash","wallQuery","wallType"],(t,i)=>{void 0!==e[i]&&(this["_"+i]=e[i])})}}search(e,t){var i=this.getSelf();isObject(e)||(e={q:e}),this._ensureIndex(()=>{var a=i._index?i._index.search(e.q):[];return a=a.filter(function(t){return!e.lyrics||!!intval(t[_utils__WEBPACK_IMPORTED_MODULE_4__.a.AUDIO_ITEM_INDEX_LYRICS])}),t(a)})}sendSearchStats(e){if("search_play"==e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextLiveAudio(e){var t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>{if(t){var i=this.indexOfAudio(t);i>=0?this.moveAudio(i,this.getAudiosCount()-1):this.addAudio(t)}e&&e(t)}})}}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_FEED="feed",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.DEFAULT_PLAYLIST_ID=-1},"PMB/":function(__webpack_module__,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return loadAllPlaylistAudios});var AUDIO_LOAD_CHUNK_SIZE=2e3;function loadAllPlaylistAudios(playlist,onDone){if(!playlist.hasMore()||!playlist.isFullyLoadable())return onDone&&onDone();var chunks=[],totalCount=playlist.getTotalCount(),isDeleted=!1,onAllLoaded=()=>{if(isDeleted)return onDone&&onDone(null,isDeleted);var e=[];each(chunks,function(t,i){i&&(e=e.concat(i))}),each(getAudioPlayer().getPlaylists(),function(t,i){i.getId()===playlist.getId()&&(i._list=e)}),getAudioPlayer().mergePlaylistData(playlist,{hasMore:!1}),onDone&&onDone(playlist)},loadChunk=(chunkIndex,_cb)=>{ajax.post("al_audio.php",{act:"load_section",type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset:chunkIndex*AUDIO_LOAD_CHUNK_SIZE,is_loading_all:1,claim:intval(nav.objLoc.claim)},{onDone:function onDone(data,tpl,langs,templatesScript){if(0===chunkIndex){if(addTemplates({audio_playlist_snippet:tpl}),extend(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,_cb();totalCount=data.totalCount,getAudioPlayer().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,_cb()}})},loadAllChunks=(e,t)=>{t=t||0;var i=Math.max(0,Math.ceil(totalCount/AUDIO_LOAD_CHUNK_SIZE));i-t<=0?e():function(){for(var a=new CallHub(e,i-t),s=t;s<i;s++)loadChunk(s,function(){a.done()})}()};void 0===totalCount?loadChunk(0,function(){isDeleted?onAllLoaded():loadAllChunks(onAllLoaded,1)}):loadAllChunks(onAllLoaded,0)}},pp2G:function(e,t,i){"use strict";var a={};i.r(a),i.d(a,"ACTION_PLAY",function(){return P}),i.d(a,"ACTION_PAUSE",function(){return E}),i.d(a,"ACTION_SEEK",function(){return I}),i.d(a,"ACTION_HEARTBEAT",function(){return v}),i.d(a,"ACTION_TIME_MARKER",function(){return b}),i.d(a,"log",function(){return m});var s=i("uk5P");i("pIFo");var o=i("zxIV");var r=i("4bNW");i("KKXr");i("rGqo"),i("Btvt");var l=i("t7n3");var d=i("Egk5");var n=[];var _=i("rEJs");function u(e,t=!0){var i="";if(t=!AudioUtils.isPodcast(e)&&t,isArray(e[AudioUtils.AUDIO_ITEM_INDEX_MAIN_ARTISTS])&&(i=AudioUtils.getAudioArtistsString(e[AudioUtils.AUDIO_ITEM_INDEX_MAIN_ARTISTS],t)),isArray(e[AudioUtils.AUDIO_ITEM_INDEX_FEAT_ARTISTS])&&(i+=" feat. ",i+=AudioUtils.getAudioArtistsString(e[AudioUtils.AUDIO_ITEM_INDEX_FEAT_ARTISTS],t)),!i){var a=e[AudioUtils.AUDIO_ITEM_INDEX_PERFORMER].replace(/<\/?em>/g,"");if(t)i=`<a class="artist_link" data-performer="${a}" href="${"/audio?performer=1&q="+encodeURIComponent(a)}">${a}</a>`;else i=a}return i}var c=600,h=3600,p=36e3;function g(e){return e<c?"s":e<h?"m":e<p?"l":"n"}function A(e,t){for(var i=JSON.parse(getTemplate("audio_bits_to_cls")),a=e[AudioUtils.AUDIO_ITEM_INDEX_FLAGS],s=[],o=0;o<32;o++){var r=1<<o;a&r&&s.push(i[r])}AudioUtils.isPodcast(e)&&(s.push("audio_podcast"),AudioUtils.isPrivatePodcast(e)&&s.push("audio_podcast_private")),t&&s.push(t);var l="";if(e[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL]){var d=e[AudioUtils.AUDIO_ITEM_INDEX_COVER_URL].split(",");l="background-image: url("+d[0]+")"}var n=AudioUtils.getAudioPerformers(e),_=e[AudioUtils.AUDIO_ITEM_INDEX_DURATION],u=formatTime(_),c=clean(JSON.stringify(e)),h=getTemplate("audio_row",e);return h=(h=(h=(h=(h=(h=h.replace(/%cls%/,()=>s.join(" "))).replace(/%duration%/,()=>u)).replace(/%serialized%/,()=>c)).replace(/%cover_style%/,()=>l)).replace(/%performers%/,()=>n)).replace(/%duration_mod%/,()=>g(_))}i("OEbY");function f(e){if(!e)return null;if(isObject(e))return e;if("string"==typeof e)return{id:e};var t=(e[s.a.AUDIO_ITEM_INDEX_HASHES]||"").split("/"),i=(e[s.a.AUDIO_ITEM_INDEX_COVER_URL]||"").split(","),a=u(e,!1);return{id:intval(e[s.a.AUDIO_ITEM_INDEX_ID]),owner_id:intval(e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]),ownerId:e[s.a.AUDIO_ITEM_INDEX_OWNER_ID],fullId:e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.a.AUDIO_ITEM_INDEX_ID],title:e[s.a.AUDIO_ITEM_INDEX_TITLE],subTitle:e[s.a.AUDIO_ITEM_INDEX_SUBTITLE],performer:a,duration:intval(e[s.a.AUDIO_ITEM_INDEX_DURATION]),lyrics:intval(e[s.a.AUDIO_ITEM_INDEX_LYRICS]),url:e[s.a.AUDIO_ITEM_INDEX_URL],flags:e[s.a.AUDIO_ITEM_INDEX_FLAGS],context:e[s.a.AUDIO_ITEM_INDEX_CONTEXT],extra:e[s.a.AUDIO_ITEM_INDEX_EXTRA],accessKey:e[s.a.AUDIO_ITEM_ACCESS_KEY],addHash:t[0]||"",editHash:t[1]||"",actionHash:t[2]||"",deleteHash:t[3]||"",replaceHash:t[4]||"",urlHash:t[5]||"",restoreHash:t[6]||"",canEdit:!!t[1],canDelete:!!t[3],isLongPerformer:e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_LONG_PERFORMER_BIT,canAdd:!!(e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_CAN_ADD_BIT),coverUrl_s:i[0],coverUrl_p:i[1],isClaimed:!!(e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_CLAIMED_BIT),isExplicit:!!(e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_EXPLICIT_BIT),isUMA:!!(e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_UMA_BIT),isReplaceable:!!(e[s.a.AUDIO_ITEM_INDEX_FLAGS]&s.a.AUDIO_ITEM_REPLACEABLE),ads:e[s.a.AUDIO_ITEM_INDEX_ADS],album:e[s.a.AUDIO_ITEM_INDEX_ALBUM],albumId:intval(e[s.a.AUDIO_ITEM_INDEX_ALBUM_ID]),albumPart:intval(e[s.a.AUDIO_ITEM_INDEX_ALBUM_PART]),trackCode:e[s.a.AUDIO_ITEM_INDEX_TRACK_CODE],restrictionStatus:e[s.a.AUDIO_ITEM_INDEX_RESTRICTION],useNewStats:Boolean(e[s.a.AUDIO_ITEM_INDEX_NEW_STATS])}}var y=i("W0fz");var P="play",E="pause",I="seek",v="heartbeat",b="time_marker";function m(e,t){var i=t.audio;AudioUtils.isPodcast(i)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.log(e,t)})}var O=i("RbYe");var w=25e3,T=null,L=null,C=null;function D(e){window.Notifier&&T!==e.key&&(C&&clearTimeout(C),T=e.key,Notifier.addKey({key:e.key,ts:e.timestamp},(t,i)=>(function(e,t){if(e===T)if(t.failed)S(!0);else for(var i=getAudioPlayer(),a=i.isPlaying(),s=i.getCurrentAudio(),o=AudioUtils.isPodcast(s),r=0;r<t.events.length;r++){var l=t.events[r].data;if("start"===l.type&&AudioPlayer.getDeviceId()!==l.uuid&&!L&&!o&&a){i.pausedByQueue=vkNow(),i.pause(),L=showBox("al_audio.php",{act:"start_playback_box",uuid:l.uuid,device_name:l.device_name},{params:{hideButtons:!0,onHide:()=>{L=!1}},containerClass:"audio_playback_box"});break}}})(e.key,i)),C=setTimeout(()=>S(!0),w))}function S(e){var t=getAudioPlayer().getCurrentAudio(),i=window.Notifier&&t&&!vk.widget,a=!e&&T,s=AudioUtils.isPodcast(t);!i||s||a||t&&(t=AudioUtils.asObject(t),ajax.post("al_audio.php",{act:"queue_params",audio_id:t.id,owner_id:t.owner_id,hash:t.actionHash},{onDone:e=>{if(e&&e.errors&&!e.errors.length){var t=e.data.queues[0];t&&D(t)}}}))}var U=i("aong"),R=i("/PiP"),k=i("EasH"),j=i("XzvV");function x(e){Object(k.d)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{Object(j.d)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()">${getLang("global_close")}</button>\n    <div class="audio_restriction_box__icon audio_restriction_box__icon_pensive_face"></div>\n    <div class="audio_restriction_box__title">${getLang("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n        <button class="flat_button" onclick="curBox().hide()">${getLang("global_close")}</button>\n    </div>\n  `)}function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}i.d(t,"a",function(){return N});var N=M({},s.a,{audioSearchPerformer:function(e,t,i){var a=!!window.AudioPage&&currentAudioPage(e),s=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout(function(){a&&s?(t=unclean(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},i,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(e,i)},50)},toggleAudioLyrics:function(e,t){var i=Object(o.H)("_audio_row__lyrics",e);if(i)if(Object(o.vb)(i)){var a=Object(o.N)(e)[1],s=Object(o.N)(i)[1];Object(o.rb)(e,"height",a+s),Object(o.i)(e,"prevHeight",a)}else{var r=Object(o.i)(e,"prevHeight");Object(o.rb)(e,"height",r)}else{Object(o.a)(e,"audio_loading");var l={act:"get_lyrics",aid:t.fullId,lid:t.lyrics};AudioUtils.isPodcast(t)&&(l.podcast=!0),ajax.post("al_audio.php",l,{onDone:function(a){Object(o.hb)(e,"audio_loading"),i=Object(o.mb)(`<div class="_audio_row__lyrics audio_row__lyrics" data-nodrag="1" style="display:none;"><div class="audio_row__lyrics_inner">${a}</div></div>`),Object(o.H)("_audio_row_content",e).appendChild(i),AudioUtils.toggleAudioLyrics(e,t)}})}},getRowActionName:function(e,t,i){var a,s=AudioUtils.getAddRestoreInfo();switch(e){case"current_delete":a=getLang("audio_delete_from_current");break;case"recoms_delete":a=getLang("audio_dont_show");break;case"listened_delete":a=getLang("audio_remove_from_list");break;case"delete":if(AudioUtils.isPodcast(t))a=getLang("audio_podcast_delete_episode");else if(window.AudioPage&&AudioPage.isInRecentPlayed(i))a=getLang("audio_remove_from_list");else{var o=s[t.fullId];a=o&&o.deleteAll?o.deleteAll.text:getLang("global_delete_audio")}break;case"restore_recoms":a=getLang("audio_restore_audio");break;case"add":var r=s[t.fullId];if(AudioUtils.isPodcast(t))a=getLang("audio_podcast_restore_episode");else if(r&&"deleted"==r.state)a=getLang("audio_restore_audio");else if(r&&"added"==r.state)a=getLang("global_delete_audio");else{var l=!!window.AudioPage&&currentAudioPage(i);a=l&&l.getOwnerId()<0&&l.canAddToGroup()?getLang("audio_add_to_group"):getLang("audio_add_to_audio")}break;case"edit":a=AudioUtils.isPodcast(t)?getLang("audio_podcast_edit_episode"):getLang("audio_edit_audio");break;case"next":a=cur.lang&&cur.lang.global_audio_set_next_audio||getLang("audio_set_next_audio");break;case"recoms":a=getLang("audio_show_recommendations");break;case"fave":a=AudioUtils.isPodcast(t)?getLang("audio_podcast_listen_later"):"";break;default:a=""}return a},initRowPlaylistsChooser:function(e,t,i){var a,s=AudioUtils.asObject(e);a=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,AudioUtils.playlistsByAudioDataCache=AudioUtils.playlistsByAudioDataCache||{};var o=AudioUtils.playlistsByAudioDataCache,r=a+"_"+s.ownerId+"_"+s.id;o[r]?AudioUtils._showPlaylistsChooser(i,t,o[r],a,s,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:a,audio_owner_id:s.ownerId,audio_id:s.id},{onDone:(l,d,n)=>{var _=o[r]={playlists:l,morePlaylists:d,newPlaylistHash:n};AudioUtils._showPlaylistsChooser(i,t,_,a,s,e)}})},addToPlaylistsBoxInit:function e(t,i,a,s,r){if("undefined"==typeof AutoList)return stManager.add("auto_list.js",()=>{e(t,i,a,s,r)});var l=curBox(),d=Object(o.H)("_audio_atp_content",l.bodyNode),n=Object(o.H)("_audio_atp_list",l.bodyNode),_=Object(o.F)("audio_atp_search"),u=Object(o.H)("_audio_atp_empty"),c=Object(o.N)(d)[1];Object(o.rb)(n,{height:c-Object(o.N)(_)[1]});var h,p="";function g(){h&&h.destroy(),n.innerHTML="";var e=[];e=p?s.filter(e=>e[2].toLowerCase().indexOf(p)>=0):s,Object(o.vb)(n,0!=e.length),Object(o.vb)(u,0==e.length),h=new AutoList(n,{onNeedRows:(t,i)=>{for(var a=[],s=i,o=Math.min(e.length,i+30),r=s;r<o;r++){var l=e[r];if(l){var d=`<div class="ape_pl_item _ape_pl_item ${l[4]?"ape_selected":""}" data-id="${l[1]}"><div class="ape_check"><div class="ape_check_icon"></div></div><div class="ape_pl_item_inner"><span class="ape_pl_title">${l[2]}</span> <span class="ape_pl_size">${l[3]}</span></div></div>`;a.push(d)}}t(a)}})}g(),cur.addToPlaylistSearch=debounce(function(e){p=trim(e).toLowerCase(),g()},200);var A={},f={};addEvent(n,"click",e=>{var t=Object(o.n)("_ape_pl_item",e.target),i=Object(o.s)(t,"id");Object(o.wb)(t,"ape_selected")?(f[i]=!0,delete A[i]):(A[i]=!0,delete f[i])}),l.removeButtons(),l.addButton(getLang("global_save"),e=>{var s=Object.keys(f),o=Object.keys(A);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:s.join(","),remove_pl_ids:o.join(","),owner_id:t,audio_owner_id:i,audio_id:a,hash:r},{showProgress:lockButton.pbind(e),hideProgress:unlockButton.pbind(e),onDone:()=>{l.hide()}})},"ok",!0),l.addButton(getLang("global_cancel"),l.hide.bind(this),"no",!0)},showRecoms:function(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)},shareAudio:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(t=t||getAudioPlayer().getCurrentAudio()){t=AudioUtils.asObject(t);var i=AudioUtils.isPodcast(t)?"podcast":"audio";return!showBox("like.php",{act:"publish_box",object:i+t.fullId,list:t.actionHash,to:"mail"},{stat:["page.js","page.css","wide_dd.js","wide_dd.css","sharebox.js"],onFail:function(e){return showDoneBox(e),!0}})}},showAudioAlbum:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();t=AudioUtils.asObject(t),layers.fullhide&&layers.fullhide(),AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2])},openEpisode:function(e,t){t=AudioUtils.asObject(t),AudioUtils.isPodcast(t)&&showPodcast(e,t.fullId,null,"audio")},replaceWithOriginal:function(e,t,i){(t=t||getAudioPlayer().getCurrentAudio())&&(t=AudioUtils.asObject(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(a){var s=JSON.parse(t.extra).claim.original;s[AudioUtils.AUDIO_ITEM_INDEX_ID]=a,s[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;var r=Object(o.mb)(AudioUtils.drawAudio(s));e.parentElement.insertBefore(r,e),e.parentElement.removeChild(e),i&&i()},onFail:i}))},editAudio:function(e,t,i){showBox("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:i},{params:{width:"456px",bodyStyle:"padding: 20px; background-color: #F7F7F7;",hideButtons:1},dark:1})},editEpisode:function(e,t){AudioUtils.isPodcast(t)&&(cur.podcastEditData={audioId:t.fullId},stManager.add([jsc("web/podcast.js")],function(){Podcast.edit(t.fullId)}))},deleteCurrentAudio:function(e,t){var i=getAudioPlayer().getCurrentPlaylist();i&&i.removeAudio(t.fullId),Object(o.fb)(e)},deleteRecomsAudio:function(e,t){AudioUtils.deleteAudio(e,t,!1,!0)},deleteListenedAudio:function(e,t){AudioUtils.deleteAudio(e,t,!1,!1,!0)},deleteAudio:function(e,t,i,a,s){function r(t){return Object(o.s)(e,"in-progress",Object(l.r)(t))}if(window.tooltips&&tooltips.hideAll(),!Object(l.r)(Object(o.s)(e,"in-progress"))){r(!0);var d=!1;t.isClaimed&&(d=!0);var n=AudioUtils.getAddRestoreInfo(),_=n[t.fullId];if(_&&_.deleteAll)showFastBox({title:getLang("audio_delete_all_title"),dark:1},_.deleteConfirmMsg||"",getLang("global_delete"),function(e){var t=extend({act:"delete_all"},_.deleteAll);ajax.post("al_audio.php",t,{showProgress:lockButton.pbind(e),onDone:function(){var e=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,_.deleteAll.from_id,AudioPlaylist.DEFAULT_PLAYLIST_ID);getAudioPlayer().deletePlaylist(e),nav.reload()}})},getLang("global_cancel"));else{if(d?Object(o.fb)(e):Object(o.a)(e,"audio_row__deleted"),s){ajax.post("al_audio.php",{act:"remove_listened",audio_id:t.id,audio_owner_id:t.ownerId,hash:t.actionHash}),Object(o.fb)(e);var u=getAudioPlayer().getCurrentPlaylist();u&&u.getType()==AudioPlaylist.TYPE_RECOM&&u.getAlbumId()==AudioUtils.AUDIO_RECOMS_TYPE_LISTENED&&u.removeAudio(t.fullId)}else if(a){var c={act:"hide_recommendation",hash:AudioUtils.getAudioExtra(t).recom.hash,audio_id:t.fullId};nav.objLoc.audio_id&&(c.recommendation_type="query"),ajax.post("al_audio.php",c,{onDone:()=>{r(!1)}}),n[t.fullId]={state:"recom_hidden"};var h=getAudioPlayer().getCurrentPlaylist();h&&h.getType()==AudioPlaylist.TYPE_RECOM&&(n[t.fullId].removedCurrentPos=h.removeAudio(t))}else ajax.post("al_audio.php",{act:"delete_audio",oid:t.ownerId,aid:t.id,hash:t.deleteHash,restore:1,track_code:t.trackCode},{onDone:(i,a)=>{d||r(!1),n[t.fullId]={state:"deleted",deleteAll:i,deleteConfirmMsg:a},d&&AudioUtils.deleteDeletedAudios(),AudioUtils.onRowOver(e,!1,!0)}});AudioUtils.onRowOver(e,!1,!0)}}},deleteEpisode:function(e,t){AudioUtils.isPodcast(t)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.deleteEpisode(t.fullId,t.deleteHash)})},restoreEpisode:function(e,t){AudioUtils.isPodcast(t)&&stManager.add([jsc("web/podcast.js")],function(){Podcast.restoreEpisode(t.fullId,t.editHash)})},deleteDeletedAudios:function(){each(AudioUtils._audioAddRestoreInfo||{},(e,t)=>{"deleted"!=t.state&&"recom_hidden"!=t.state||getAudioPlayer().deleteAudioFromAllPlaylists(e)})},faveEpisode:function(e,t){if(AudioUtils.isPodcast(t)){var i=AudioUtils.getAudioExtra(t).faveHash;bookmarkPodcast(Object(o.H)("audio_row__action_fave",e),t.fullId,i)}},contextSplit:function(e){return isObject(e)&&(e=e.context),(e||"").split(":")},showAudioPlaylist:function(e,t,i,a,s,r){if(cur.apLayer)return cancelEvent(s);if(vk.widget)return!0;if(!s||!(s.metaKey&&browser.mac||s.ctrlKey)){var l=null;return window.Photoview&&window.cur&&cur.pvShown&&(l=clone(nav.objLoc),Photoview.hide(!0)),boxRefreshCoords(boxLoader),Object(o.ub)(boxLoader),Object(o.ub)(boxLayerWrap),stManager.add(["auto_list.js","audio.css"],function(){var s,d;function n(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,s&&removeEvent(window.audioPlaylistLayerWrap,"click",s),d&&removeEvent(bodyNode,"keydown",d),delete cur.apLayer,delete cur.apLayerPlaylistId,Object(o.hb)(layerBG,"ap_layer_bg_dark"),l?nav.change(l):nav.change({z:!1}),layerQueue.pop()}new AudioPlaylist({type:AudioPlaylist.TYPE_PLAYLIST,ownerId:e,albumId:t,hasMore:!0,accessHash:i,fromId:cur.oid}).loadAll(function(_,u){if(Object(o.W)(boxLoader),Object(o.W)(boxLayerWrap),u){var c=getLang("audio_error_deleted_playlist_box").split("/");return new MessageBox({title:c[0]}).content(c[1]).setButtons(getLang("global_close"),function(){curBox().hide(),l&&nav.change(l)}).show(),void nav.setLoc(extend(nav.objLoc,{z:!1}))}var h=extend(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(i?"/"+i:"")});nav.setLoc(h),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=Object(o.mb)('<div class="ap_layer_wrap"></div>'),bodyNode.appendChild(window.audioPlaylistLayerWrap)),window.audioPlaylistLayerWrap.innerHTML="";var p=_.getAudiosList().length,g=_.isBlocked&&_.isBlocked(),A=getTemplate("audio_playlist_snippet",{title:_.getTitle(),subTitle:_.getSubtitle(),description:_.getDescription(),coverStyle:_.getCoverUrl()?"background-image:url('"+_.getCoverUrl()+"'); background-size: cover;":"",authorLine:_.getAuthorLine(),infoLine1:_.getInfoLine1(),infoLine2:_.getInfoLine2(),id:_.getPlaylistId(),ownerId:_.getOwnerId(),href:"/audio?z=audio_playlist"+_.getOwnerId()+"_"+_.getPlaylistId()+"/"+_.getAccessHash(),addCls:_.getAddClasses(),followHash:_.getFollowHash(),accessHash:_.getAccessHash(),editHash:_.getEditHash(),deleteHash:_.getDeleteHash(),replaceHash:_.getReplaceHash(),gridCovers:_.getGridCovers(),type:_.getType(),context:a,followButtonText:_.isFollowed()?getLang("audio_playlist_btn_added"):getLang("audio_playlist_btn_add")});if(cur.apLayer=Object(o.mb)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${A}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),g){var f=Object(o.H)("audio_pl_snippet__body",cur.apLayer);f.innerHTML=getTemplate("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),addEvent(window.audioPlaylistLayerWrap,"click",s=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=Object(o.H)("_ap_layer__close",cur.apLayer)||layers.fullhide()}),addEvent(bodyNode,"keydown",d=function(e){if(27==e.keyCode)return layers.fullhide(),cancelEvent(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),Object(o.a)(layerBG,"ap_layer_bg_dark");var y=Object(o.H)("_audio_pl_snippet__list",cur.apLayer),P=AudioUtils.getAlbumParts(_),E=0;p&&!g&&(cur.apLayerAutoList=new AutoList(y,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){for(var i=[],a=_.getUnshuffledAudiosList(),s=t-=E;s<t+30;s++){var o=a[s];if(!o)break;if(P&&P.length&&P[0].offset===s){var r=P.shift();E++,i.push(AudioUtils.drawAlbumPartRow(r.number))}i.push(AudioUtils.drawAudio(o))}e(i)}})),boxRefreshCoords(cur.apLayer),getAudioPlayer().updateCurrentPlaying(),layers.fullhide=n,cur.apLayerPlaylistId=[e,t],r&&r()})}),!1}},editPlaylist:function(e,t,i,a){stManager.add(["audio.js","audio.css","auto_list.js"],function(){ajax.post("al_audio.php",{act:"playlists_edit_data",owner_id:e},{onDone:function(s){s.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=s.audio_playlist_cover_upload_options),AudioPage.editPlaylist(e,t,i,a)}})})},followPlaylist:function(e,t,i,a,s=!1){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function r(a){var s=Object(o.s)(e,"text-followed"),r=Object(o.s)(e,"text-follow");Object(o.s)(e,"tooltip-text",a?s:r),e.innerHTML=a?s:r,u.setFollowed(a);var l=u.getAddClasses()||"";l=l.replace("audio_pl__followed",""),a&&(l+=" audio_pl__followed"),u.mergeWith({addClasses:l}),each(Object(o.G)(`_audio_pl_${t}_${i}`),(t,i)=>{Object(o.wb)(i,"audio_pl__followed",a);var s=i.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];s&&(s.innerHTML=e.innerHTML)})}function l(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){var a=null;n=n.filter(e=>{var s=e.playlistId===i&&e.playlistOwnerId===t;return s&&(a=e.pl),!s}),a&&cur.audioPage._data.playlists.unshift(a)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter(e=>{var a=e.id===i&&e.owner_id===t;return a&&n.push({playlistId:i,playlistOwnerId:t,pl:e}),!a});cur.audioPage.updatePlaylistsCounter(vk.id)}}var d=Object(o.T)("_audio_pl",e),_=Object(o.wb)(d,"audio_pl__followed"),u=getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,i);r(_),l(_),ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:i,hash:a,showcase:s},{onDone(e){!function(e,t){if(cur.audioPage&&isObject(e)){if(t){var{playlists:i,playlistsIndex:a}=cur.audioPage._data,s=Array.isArray(i)&&i.find(t=>t.id===e.id&&t.owner_id===e.owner_id);s||(i&&(i.unshift(e),a.add(e)),cur.audioPage.updatePlaylistsCounter(vk.id))}cur.audioPage.requestUpdate(["all","playlists"],vk.id)}}(e,_)},onFail:e=>(new MessageBox({title:getLang("global_error")}).content(e).setButtons("Ok",function(){curBox().hide()}).show(),r(!1),l(!1),!0)})},getLayer:function(){var e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e},updateQueueReceivedPost:function(e){e&&each(Object(o.G)("_audio_row",e),function(){Object(o.s)(this,"new-post","groups"==cur.module?"wall":"feed")})},toggleAudioHQBodyClass:function(){var e=AudioPlayer.showHQLabel();Object(o.wb)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS,e)},hasAudioHQBodyClass:function(){return Object(o.V)(document.body,AudioUtils.AUDIO_HQ_LABEL_CLS)},showNeedFlashBox:function(){var e=getLang("global_audio_flash_required").replace("{link}",'<a target=_blank href="https://get.adobe.com/flashplayer">').replace("{/link}","</a>");new MessageBox({title:getLang("audio_need_flash_title")}).content(e).setButtons("Ok",function(){curBox().hide()}).show()},getAddRestoreInfo:function(){return AudioUtils._audioAddRestoreInfo=AudioUtils._audioAddRestoreInfo||{},AudioUtils._audioAddRestoreInfo},addAudio:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;function i(t){return Object(o.s)(e,"in-progress",Object(l.r)(t))}if(!Object(l.r)(Object(o.s)(e,"in-progress"))){i(!0),t||(t=AudioUtils.getAudioFromEl(e,!0));var a=window.AudioPage&&currentAudioPage(e),s=a&&a.getOwnerId()<0&&a.canAddToGroup()?-a.getOwnerId():0,r=AudioUtils.getAddRestoreInfo(),d=r[t.fullId],n=Object(o.H)("_audio_row_"+t.fullId);n=n!=e&&n;var u,c=a&&a.getPageCurrentPlaylist(),h=AudioUtils.getContextPlaylist(e,!0);h&&(u=(h=AudioUtils.contextSplit(h))[0]),("search"==u&&c&&c.getSearchQid()||"search"==cur.module&&cur.qid)&&(u="search:external");var p={act:"add",group_id:s,audio_owner_id:t.ownerId,audio_id:t.id,hash:t.addHash,from:u||"",track_code:t.trackCode};d?"recom_hidden"==d.state?(a&&(a.restoreRecommendation(e),i(!1)),AudioUtils.onRowOver(e,!1,!0)):"deleted"==d.state?(ajax.post("al_audio.php",{act:"restore_audio",oid:t.ownerId,aid:t.id,hash:t.restoreHash,track_code:t.trackCode},{onDone:function(){i(!1)}}),Object(o.hb)(e,"audio_row__deleted"),delete r[t.fullId],AudioUtils.onRowOver(e,!1,!0)):"added"==d.state&&(ajax.post("al_audio.php",{act:"delete_audio",oid:d.audio.ownerId,aid:d.audio.id,hash:d.audio.deleteHash,track_code:t.trackCode},{onDone:function(){var e=window.getAudioPlayer&&window.getAudioPlayer();e&&e.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,s?-s:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).removeAudio(d.addedFullId),i(!1)}}),Object(o.hb)(e,"audio_row__added"),n&&Object(o.hb)(n,"audio_row__added"),delete r[t.fullId],getAudioPlayer().notify(_.a.REMOVED,t.fullId,d.addedFullId)):(ajax.post("al_audio.php",p,{onDone:function(e){if(e){var a=e[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[AudioUtils.AUDIO_ITEM_INDEX_ID];r[t.fullId]={state:"added",addedFullId:a,audio:AudioUtils.asObject(e)},getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,s?-s:vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID).addAudio(e,0),c&&c.getType()==AudioPlaylist.TYPE_SEARCH&&c.sendSearchStats("search_add")}i(!1)},onFail:function(t){return t&&new MessageBox({title:getLang("global_error")}).content(t).setButtons(getLang("global_close"),()=>curBox().hide()).show(),Object(o.hb)(e,"audio_row__added"),i(!1),!0}}),Object(o.a)(e,"audio_row__added"),n&&Object(o.a)(n,"audio_row__added"),getAudioPlayer().notify(_.a.ADDED,t.fullId),a&&c&&a.onUserAction(t,c))}},addAudioToOwner:function(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),cancelEvent(t)},chooseAudioBox:function(e,t,i){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,Object(o.hb)(Object(o.z)(e),"audio_selected"),e.innerHTML=t.labels.add;else{var a=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>a)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,Object(o.a)(Object(o.z)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return Object(d.c)(i)},getAudioArtistsString:function(e,t){var i="";return e.forEach(function(a,s){var o="/audio?performer=1&q="+encodeURIComponent(a.name),r=window.getWebHost?window.getWebHost():"";a.id&&(o=`/artist/${a.id}`),i+=t?`<a class="artist_link" href="${r}${o}">${a.name}</a>`:a.name,s<e.length-1&&(i+=", ")}),i},getAudioPerformers:u,drawAudio:A,isClaimedAudio:function(e){return!!e&&(e=AudioUtils.asObject(e)).flags&AudioUtils.AUDIO_ITEM_CLAIMED_BIT},getDurationMod:g,getAudioExtra:function(e){return"object"==typeof(e=AudioUtils.asObject(e)).extra?e.extra:JSON.parse(e.extra||"{}")},getAudioFromEl:function(e,t){e=Object(o.n)("_audio_row",e);var i=Object(o.i)(e,"audio");return i||(i=JSON.parse(Object(o.s)(e,"audio"))),t&&((i=AudioUtils.asObject(i)).isDeleted=Object(o.V)(e,"audio_row__deleted"),i.isCurrent=Object(o.V)(e,AudioUtils.AUDIO_CURRENT_CLS),i.isPlaying=Object(o.V)(e,AudioUtils.AUDIO_PLAYING_CLS),i.isFromCurrentPlaylist=!!Object(o.T)("_audio_section__current",e),i.isNumeric=!!Object(o.T)("audio_numeric",e),i.isWithCovers=!!Object(o.T)("audio_w_covers",e),i.withInlinePlayer=!i.isWithCovers&&!Object(o.T)("audio_no_inline_player",e),i.isInSnippet=!!Object(o.T)("_audio_pl_snippet__list",e),i.isInEditBox=!!Object(o.T)("_audio_pl_edit_box",e),i.isInRecomsBlock=!!Object(o.T)("_audio_recoms_blocks",e),i.isInFastChat=!!Object(o.T)("fc_tab",e),i.isInAttach=!!Object(o.T)("media_preview",e),i.isSetClaimed=Object(o.V)(e,"audio_moder_claimed"),i.isPodcastListSnippet=Object(o.V)(e,"podcast_list_snippet")),i},getAudioFullId:function(e){return e[s.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[s.a.AUDIO_ITEM_INDEX_ID]},asObject:f,initDomPlaylist:function(e,t){var i=[];return each(t,function(e,t){t&&each(Object(o.G)("_audio_row",t),function(e){i.push(AudioUtils.getAudioFromEl(this))})}),e.addAudio(i),e},getContextPlaylist:function(e,t){var i=getAudioPlayer(),a=AudioUtils.getAudioFromEl(e,!0);function s(e){return[].slice.call(e)}var r,l=null,d=[],n=Object(o.s)(e,"new-post"),_=!1,u=null,c=AudioPlaylist.TYPE_TEMP,h=vk.id,p={},g=window.AudioPage&&currentAudioPage(e);if((window.traverseParent||function(e,t){for(e=Object(o.F)(e);e&&!t(e)&&(e=Object(o.z)(e))!=document;);return null})(e,e=>_=Object(o.s)(e,"audio-context")),_=(_=a.context||_)||("audio"==cur.module?cur.submodule:cur.module),t)return{context:_};var[A,f]=AudioUtils.contextSplit(_),y=Object(o.T)("_audio_pl",e);if(y){var P=(Object(o.s)(y,"playlist-id")||"").split("_");u=i.getPlaylist.apply(i,P);var E=Object(o.s)(y,"title")||"";E&&u.mergeWith({title:clean(E)});var I=Object(o.s)(y,"access-hash")||"";I&&u.mergeWith({accessHash:I}),g&&g.getPageCurrentPlaylist()==u&&g.getSortedList()?u.initSortedList(g.getSortedList()):a.isFromCurrentPlaylist||(u.removeSortedList(),u.shuffle(0)),"music_2018_top_audios"===_&&(d=[Object(o.H)("audio_recoms_audios_block")])}else if(g&&g.getPageCurrentPlaylist())u=g.getPageCurrentPlaylist();else if("module"==A){var v=f;u=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,v||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),d=[l]}else if(0===a.context.indexOf("admin"))(u=i.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,...a.album)).getAudiosCount()||u.setForceReload(!0);else if(0===a.context.indexOf("im"))l=(l=Object(o.T)("_im_peer_history",e))||Object(o.T)("_fc_tab_log_msgs",e),r="im"+(cur.peer||"");else if(0===a.context.indexOf("board"))r=a.context,d=s(Object(o.G)("_wall_audio_rows",l));else if(0===a.context.indexOf("widget"))r=a.context;else if(0===a.context.indexOf("wiki"))r="wiki";else if(0===a.context.indexOf("post")){c=AudioPlaylist.TYPE_WALL,r=a.context;var b=a.context.replace("post","").split("_");h=b[0],p={postId:b[1]}}else if(0===a.context.indexOf("choose"))r=a.context;else if("feed"==n||0===a.context.indexOf("feed")||0===a.context.indexOf("feedsearch"))r="feed",d=s(Object(o.G)("wall_text",l));else if("group_wall"==A||"user_wall"==A||0===a.context.indexOf("reply")||"wall"==n){c=AudioPlaylist.TYPE_WALL,h=cur.oid;var m=(f||"").split("_")[1],O=cur.wallQuery||"",w=Object(o.F)("wall_search"),T=inArray(cur.wallType,["own","full_own"])?"own":"all";r=hashCode(T+"_"+O),"wall"==cur.module&&Object(o.zb)(w)&&(O=Object(o.zb)(w)),m&&(p={postId:m,wallQuery:O,wallType:T}),0===a.context.indexOf("reply")&&(d=s([Object(o.T)("_replies_list",e)]),r="reply"+r),d=d.concat(s([l]))}else"article"==A&&(u=cur.articlePlaylist);return l||(l=Object(o.z)(e)),(d=d.filter(function(e){return!!e}))&&0!=d.length||(d=[l]),(u=(u=u||i.getPlaylist(c,h,r)).getAudiosCount()?u:AudioUtils.initDomPlaylist(u,d)).mergeWith(p||{}),-1==u.indexOfAudio(a)&&(u=AudioUtils.initDomPlaylist(u,[Object(o.z)(e)])),{playlist:u,context:_}},renderAudioDiag:function(){var e=Object(o.F)("audio_diag_log"),t=ls.get(AudioUtils.LOG_LS_KEY)||[];e&&each(t,function(t,i){var a=new Date(i.shift()).toUTCString();i=i.join(", "),e.appendChild(Object(o.mb)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+i+"</div>"))})},claim:function(e,t,i){Object(o.a)(t,"audio_moder_claimed"),AudioUtils.onRowOver(t,!1,!0),e=AudioUtils.asObject(e),ajax.post("al_claims.php",{act:"a_claim",claim_id:i,type:"audio",id:e.id,owner_id:e.ownerId})},unclaim:function(e,t,i){Object(o.hb)(t,"audio_moder_claimed"),AudioUtils.onRowOver(t,!1,!0),e=AudioUtils.asObject(e),ajax.post("al_claims.php",{act:"a_unclaim",claim_id:i,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})},getUMAInfo:function(e,t){t.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:750}})},getUMAInfoAlbum:function(e,t){t.isInEditBox||showBox("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})},cancelReplacement:function(e,t,i){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e}),Object(o.fb)(i)},removeFromGroup:function(e,t,i){var a=e+"_"+t;if(cur.audioPage._ownerId<0)var s=window.showBox("al_audio.php",{act:"delete_from_group_box",playlist_id:a,group_id:-cur.audioPage._ownerId}).setButtons(getLang("global_yes"),()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:-cur.audioPage._ownerId,hash:i,playlist_id:a},{onDone(e){s.hide(),showDoneBox(e)},onFail:e=>(s.hide(),showDoneBox(e),!0)})},getLang("global_cancel"),()=>s.hide()).show()},addToGroupBox:function(e,t,i){var a=e+"_"+t,s=window.showBox("al_audio.php",{act:"add_to_groups_box",playlist_id:a,access_hash:i}).setButtons(getLang("Save"),()=>{var e=[];for(var t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&(Object(o.F)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:Object(o.F)("add_playlist_to_group_hash").value,playlist_id:a},{onDone(e){s.hide(),showDoneBox(e)},onFail:e=>(Object(o.F)("add_playlist_to_group_fail").innerHTML=e,!0)}))})},showAudioRestriction:function(e){if(!e)return!1;if((e=f(e)).restrictionStatus){if(e.actionHash){Object(j.d)("audio_restriction_popup","show",e.restrictionStatus);var t=showBox("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){var t=curBox();t&&t.once("click:ok",()=>{Object(j.d)("audio_restriction_popup","click",e.restrictionStatus)})},onHide:t=>{t||Object(j.d)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,i)=>{if(i&&i.play){t.hide();var a=function(e){var t=Object(o.G)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;var i=Object(U.l)(Object(o.s)(t[0],"audio"));if(!i)return!1;var a=Object(U.l)(i[s.a.AUDIO_ITEM_INDEX_EXTRA]);a&&delete a.claim,i[s.a.AUDIO_ITEM_INDEX_RESTRICTION]=0,i[s.a.AUDIO_ITEM_INDEX_FLAGS]&=~s.a.AUDIO_ITEM_CLAIMED_BIT,i[s.a.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(a);var r=Object(R.k)().getCurrentPlaylist(),l=Object(o.mb)(A(i,"no_extra"));if(r){var d=i[s.a.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i[s.a.AUDIO_ITEM_INDEX_ID],n=r.getAudio(d);n&&(n[s.a.AUDIO_ITEM_INDEX_RESTRICTION]=i[s.a.AUDIO_ITEM_INDEX_RESTRICTION],n[s.a.AUDIO_ITEM_INDEX_FLAGS]=i[s.a.AUDIO_ITEM_INDEX_FLAGS],n[s.a.AUDIO_ITEM_INDEX_EXTRA]=i[s.a.AUDIO_ITEM_INDEX_EXTRA])}return each(t,(e,t)=>{var a=e>0?Object(o.mb)(A(i,"no_extra")):l;t.parentElement.insertBefore(a,t),t.parentElement.removeChild(t)}),l}(i.audio?f(i.audio):e),r=Object(R.k)();a&&r.toggleAudio(a,{target:a})}},onFail:()=>{t&&t.hide(),x(e)}})}else x(e);return!0}return!1},isPodcast:y.a,isPrivatePodcast:function(e){return!(!AudioUtils.isPodcast(e)||!AudioUtils.getAudioExtra(e).private)},PodcastsLogs:a,copyPlaylistLink:function(e,t,i){var a=location.protocol+"//"+location.host+"/music?z=audio_playlist"+e+"_"+t;i&&(a+="/"+i),statlogsValueEvent("audio_copy_link",vk.id),Object(O.b)(a),showDoneBox(getLang("audio_playlist_link_copied"))},connectListenQueue:S,getAlbumParts:function(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){for(var t=e.getAudiosList(),i=e.getAudiosCount(),a=[],o=0,r=0;r<i;r++){var l=t[r][s.a.AUDIO_ITEM_INDEX_ALBUM_PART];l>o&&(o=l,a.push({number:l,offset:r}))}if(a.length>1)return a}return!1},drawAlbumPartRow:function(e){return`<div class="audio_album_part_row">${getLang("audio_album_part").replace("{part}",e)}</div>`},onRowOver:r.a,onRowLeave:function(e){Object(o.i)(e,"leaved",!0);var t=Object(o.i)(e,"tt");if((!t||!t.isShown())&&(clearTimeout(window.audioRowHoverTO),Object(o.i)(e,"actions"))){var i=Object(o.H)("_audio_row__actions",e),a=Object(o.H)("_audio_row__duration",e);re(i),Object(o.rb)(a,"visibility","visible"),Object(o.i)(e,"actions",0)}},onAudioAddedToPlaylist:function(e,t,i,a){getAudioPlayer().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).addAudio(a,0),each(Object(o.G)(`_audio_pl_${e}_${t}`),(e,t)=>{domReplaceEl(t,Object(o.mb)(i))})},onAudioChoose:function(e,t,i,a){if(Object(l.A)(t.selected)){var s=cur.attachCount&&cur.attachCount()||0,r=i.fullId+(i.accessKey?"_"+i.accessKey:"");if(cur.chooseMedia("audio",r,a),(!cur.attachCount||cur.attachCount()>s)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,Object(o.a)(Object(o.z)(t),"audio_selected");var n=Object(o.N)(t)[0];Object(o.rb)(t,"width",n),t.innerHTML=getLang("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,Object(o.hb)(Object(o.z)(t),"audio_selected"),t.innerHTML=getLang("global_add_media");return Object(d.c)(e)},onPlaylistChoose:function(e,t){var i=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(i?":"+i:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})},_showPlaylistsChooser:function(e,t,i,a,s,r){var l=i.playlists,d=i.newPlaylistHash,n=i.morePlaylists;AudioUtils.copiedToPlaylistAudios=AudioUtils.copiedToPlaylistAudios||{},AudioUtils.copiedToPlaylistAudiosHashes=AudioUtils.copiedToPlaylistAudiosHashes||{};var _=t,u=Object(o.mb)(Object(o.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,getLang("audio_add_to_new_pl"),"audio_row__action_playlist"]));if(domInsertAfter(u,_),_=u,u.addEventListener("click",()=>{AudioUtils.editPlaylist(a,!1,"edit",{addAudio:r,newPlaylistHash:d})}),each(l,(e,t)=>{var i=!0,a=t[0]+"_"+t[1]+"_"+s.fullId,r=AudioUtils.copiedToPlaylistAudios[a],l="audio_row__action_playlist";(t[3]||r)&&(i=!1,l+=" audio_row__more_playlist_added");var d=Object(o.mb)(Object(o.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],l]));domInsertAfter(d,_),_=d;var n=!1;d.addEventListener("click",()=>{if(!n){n=!0;var e=s.ownerId,r=s.id,l=AudioUtils.copiedToPlaylistAudios[a];l&&(e=(l=l.split("_"))[0],r=l[1]),i&&(AudioUtils.copiedToPlaylistAudiosHashes[a]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:r,do_add:intval(i)},{onDone:(e,s,o)=>{AudioUtils.copiedToPlaylistAudios[a]=!!i&&o,t[4]=i?e:AudioUtils.copiedToPlaylistAudiosHashes[a],i=!i,n=!1}}),Object(o.wb)(d,"audio_row__more_playlist_added",i)}})}),n){var c=Object(o.mb)(Object(o.lb)(AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,getLang("audio_row_show_all_playlists"),"audio_row__action_playlist"]));c.addEventListener("click",()=>{showBox("al_audio.php?act=more_playlists_add",{owner_id:a,audio_owner_id:s.ownerId,audio_id:s.id},{params:{bodyStyle:"padding: 0px",width:560}})}),domInsertAfter(c,_),_=c}e.updatePosition()},debugLog:function(){}})}}]);try{stManager.done("cmodules/bundles/audioplayer.217d4978fabefb5fe9f4.js")}catch(e){}