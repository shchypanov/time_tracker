!function(e){function a(a){for(var i,d,r=a[0],n=a[1],l=a[2],_=0,p=[];_<r.length;_++)d=r[_],o[d]&&p.push(o[d][0]),o[d]=0;for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);for(c&&c(a);p.length;)p.shift()();return s.push.apply(s,l||[]),t()}function t(){for(var e,a=0;a<s.length;a++){for(var t=s[a],i=!0,r=1;r<t.length;r++){var n=t[r];0!==o[n]&&(i=!1)}i&&(s.splice(a--,1),e=d(d.s=t[0]))}return e}var i={},o={"web/ui_media_selector":0},s=[];function d(a){if(i[a])return i[a].exports;var t=i[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,d),t.l=!0,t.exports}d.m=e,d.c=i,d.d=function(e,a,t){d.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.t=function(e,a){if(1&a&&(e=d(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(d.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var i in e)d.d(t,i,function(a){return e[a]}.bind(null,i));return t},d.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(a,"a",a),a},d.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},d.p="";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=a,r=r.slice();for(var l=0;l<r.length;l++)a(r[l]);var c=n;s.push([154,"bundles/common"]),t()}({"/aNj":function(e,a,t){"use strict";t.r(a);t("rGqo"),t("Vd3H"),t("a1Th"),t("Btvt"),t("KKXr"),t("Oyvg"),t("SRfc"),t("pIFo");var i=t("BxOC"),o=t("wetz"),s="postpone",d="anonymous",r="poll_fixed",n="poll_closed",l="poll_background_id",c="poll_photo_id",_="poll_until",p="poll_is_multiple",u=127,h=340,g=510,m=200,v=120,w=480;window.MediaSelector=function(e,a,t,f,b,k){var y,C=[],x=(f=f||{}).mediaHandlers||{};each(t||[],function(a,t){var i=t[0],o=t[1],d=t[2];if(o){var r=!1,n=f.toId||cur.postTo,l={to_id:n,blockPersonal:f.blockPersonal};switch(l.mail_add=f.mail?1:"",l.from=f.from,i){case"graffiti":r=showBox.pbind("al_wall.php",{act:"canvas_draw_box",to_id:n,flash:browser.flash},{cache:1,dark:1});break;case"photos_list":r=showBox.pbind("al_photos.php",extend(l,{act:"choose_photo"}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"photo":r=x.photo?x.photo.pbind(f):showBox.pbind("al_photos.php",extend(l,{act:"choose_photo",max_files:f.limit||10,no_album_select:~(f.disabledTypes||[]).indexOf("album")?1:""}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"video":var c=extend(l,{act:"a_choose_video_box",max_files:f.limit||10});r=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||showBox("al_video.php",c,{cache:1,dark:1})};break;case"audio":r=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||stManager.add(["audio.js","indexer.js","auto_list.js","grid_sorter.js","audio.css"],function(){var a=!1;each(y.chosenMedias||[],function(){"audio_playlist"==this[0]&&(a=!0)}),cur.audioAttachOriginalOwnerId=!1,cur.audioAttachSwitchOwnerId=!1;var t=vk.id,i=parseInt((""+l.to_id||"").replace(/^board/,"-")),o=domClosest("_submit_post_box",e);domData(o,"from-oid")<0||"im"===cur.module&&cur.gid?(t=i,cur.audioAttachOriginalOwnerId=i,cur.audioAttachSwitchOwnerId=vk.id):cur.hasGroupAudioAccess&&(cur.audioAttachOriginalOwnerId=vk.id,cur.audioAttachSwitchOwnerId=i),AudioPage.showAttachBox(t,{canPlaylistAttach:!a&&!cur.editor,onAudioChoose:AudioUtils.onAudioChoose,onPlaylistChoose:AudioUtils.onPlaylistChoose})})};break;case"poll":r=(()=>y.chooseMedia("poll","",d));break;case"doc":r=x.doc?x.doc.pbind(f):showBox.pbind("docs.php",Object.assign(l,f.docParams,{act:"a_choose_doc_box"}),{stat:["docs.css"]});break;case"map":r=showBox.pbind("al_places.php",extend(l,{act:"a_choose_place_box"}),{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"note":r=showWiki.pbind({note:"new"},!0,!1,{queue:1});break;case s:r=(e=>{if(k){if(hasClass(e.target,"_close"))return y.unchooseMedia(y.postponeInd),void cancelEvent(e);var a=()=>{cur["postPostponeTT"+y.lnkId].show(),triggerEvent(geByClass1("datepicker_control",cur["postPostponeTT"+y.lnkId]._ttel),"mousedown",!1,!0);var e=!y.postponeDate;y.postponeDate=val("postpone_date"+y.lnkId),e&&y.chooseMedia(s,y.postponeDate,d)};y.postponeDatepicker?"DP_PLACEHOLDER"!==y.postponeDatepicker&&a():(cur.postponedLastDate&&(d.date=intval(cur.postponedLastDate)+3600),y.postponeDatepicker="DP_PLACEHOLDER",y.setupPostpone(d,null,a))}else y.chooseMedia(s,o,d)});break;case"mark_as_ads":r=(()=>y.chooseMedia("mark_as_ads",o,d));break;case"share":r=function(e){e=e||{},window.onShareChooseUrlBoxInit=function(){var e=geByClass1("share_url_input",curBox().bodyNode);addEvent(e,"keydown",function(e){if(e.which==KEY.ENTER)return t(curBox().btns.ok[0],e),!1})};var a=showBox("share.php",{act:"choose_url_box"},{dark:1}),t=function(t,i){var s=geByClass1("share_url_input",a.bodyNode),r=val(s);lockButton(t),disable(s,!0),hide("share_url_error"),y.chooseMedia("share",o,extend(d,{url:r,draft:!0,onSuccess:function(){disable(s,!1),unlockButton(t),a.hide(),e.videoId&&window.AdsEdit&&window.AdsEdit.showSnippetVideo&&window.AdsEdit.showSnippetVideo(e.videoId)},onError:function(e){var a="";e&&e!==getLang("global_unknown_error")&&(a=e+" "),disable(s,!1),unlockButton(t),ge("share_url_error").innerHTML=a+getLang("global_share_link_failed"),show("share_url_error")}}))};a.removeButtons(),a.addButton(getLang("global_continue"),t)};break;case"pretty_cards":r=function(e){e&&e.replace_owner_id&&(d.editor.owner_id=e.replace_owner_id),y.chooseMedia("pretty_cards",o,d)};break;case"gift":r=function(){var e=(e=f.peer<2e9?f.peer:0)||cur.peer;f.giftBoxPrepare&&f.giftBoxPrepare(e),showBox("al_gifts.php",{act:"get_gift_box",mid:e,fr:e==vk.id?1:0,ref:"media_selector"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1})};break;case"money":r=function(){var e=cur.peer;n>-2e9&&n<0&&(l.owner_id=n),showBox("al_payments.php",extend(l,{act:"money_transfer_box",to_id:e}),{onFail:function(e){return setTimeout(showFastBox(getLang("global_error"),e).hide,2e3),!0}})};break;case"market":n==vk.id?(r=showBox.pbind("al_market.php",extend(l,{act:"a_choose_user_product_box"}),{cache:1}),d.tt_words&&(cur.checkMessageHandler=function(e){if(!cur.marketIntroShown&&(e=" "+e+" ").match(new RegExp("\\s("+d.tt_words.join("|")+")\\s","i"))){var a=getSize(y.menu.moreWrap);showTooltip(y.menu.moreWrap,{text:d.tt_text,dir:"left",slideX:15,width:230,shift:[-a[0]-5,-a[1]/2],hasover:1}),cur.marketIntroShown=!0}})):r=showBox.pbind("al_market.php",extend(l,{act:"a_choose_product_box"}),{cache:1});break;case"article":r=(()=>openArticleEditor(n));break;case"podcast":r=function(){stManager.add([jsc("web/podcast.js")],function(){Podcast.select()})}}r&&C.push([i,o,r])}}),a=ge(a||"media_preview"),b=!1!==b&&ge(b||"post_settings_btn"),k=!1!==k&&ge(k||"post_actions_btns");var M=f.limit||10,S=M>1,B=f.editable&&(!browser.msie||parseInt(browser.version)>8),P=f.sortable&&(!browser.msie||parseInt(browser.version)>8),$=!!k,I=function(e,a,t){if(!(e=ge(e)))return!1;t=t||{},window.__addMediaIndex||(window.__addMediaIndex=0);var i=++__addMediaIndex;e.innerHTML='<div class="media_selector clear_fix"></div>';var o,d=domByClass(e,"media_selector"),r=[],n={id:i,menuNode:d,types:a,lastTypes:a,activate:function(e){n.touched=!0===e,t.onActivate&&t.onActivate()},show:function(){if(o&&(clearTimeout(o),o=0),n.moreWrap&&!hasClass(n.moreWrap,"shown")){t.forceToUp||replaceClass(n.moreWrap,"to_up","to_down");var e=domByClass(n.moreWrap,"_more_items"),a=getClientRectOffsetY(e);(a>0||t.forceToUp)&&replaceClass(n.moreWrap,"to_down","to_up"),setTimeout(addClass.pbind(n.moreWrap,"shown"),0)}},hide:function(e){function a(a){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e){if(!o){var a=function(){o=0,n.moreWrap&&removeClass(n.moreWrap,"shown")};if(e){var t=domByClass(n.moreWrap,"_more_items");hide(t),a(),setTimeout(show.pbind(t),0)}else o=setTimeout(a,300)}}),setOptions:function(e){extend(t,e)},setItems:function(e){for(window.tooltips&&tooltips.destroyAll(d);d.firstChild;)re(d.firstChild);var a=void 0!==t.hideAfterCount?t.hideAfterCount:4,i=void 0!==t.maxShown?t.maxShown:3,o=!1,l=t.hideItem,c=(l||e.length>a)&&(!browser.mobile||t.ignoreMobile),_=t.hideLabel||getLang("global_media_selector_more");function p(e,a,i,o,s,d){var l=ce("a",{innerHTML:o?a:'<span class="blind_label">'+a+"</span>",className:"ms_item ms_item_"+e+" _type_"+e});if(!o&&n.moreWrap?domInsertBefore(l,n.moreWrap):(o||s).appendChild(l),l.setAttribute("tabindex",0),!o){l.setAttribute("data-title",a),l.setAttribute("aria-label",a),l.setAttribute("role","link");var c=function(){hasClass(this,"ms_item_article_highlight")||showTitle(this,!1,d||!1,{noZIndex:!0})};addEvent(l,"mouseover",c),r.push(function(){removeEvent(l,"mouseover",c)})}if(i&&!cur.viewAsBox){var _=function(){return n.activate(),n.hide(!0),!(t.onItemClick&&!t.onItemClick(e))&&(i(),!1)};addEvent(l,"click",_),r.push(function(){removeEvent(l,"click",_)})}}n.moreWrap=!1,n.lastTypes=e,each(e,function(e,a){var u=a[0],h=a[1],g=a[2];if("article"!=u){if(u===s&&$&&!n.postponeBtn){var m=getLang("wall_publication_now");n.postponeBtn=se(`<div class="post_action_btn has_cross" id="post_postpone_btn${n.id}">\n                <div class="post_action_btn_layout">\n                  <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(m)}">${m}</span>\n                  <span class="post_action_image_btn _close" role="button" title="${replaceEntities(getLang("wall_post_timer_reset"))}"></span>\n                  <div class="post_action_tt_content _postpone" id="post_postpone_tt_content${n.id}" onclick="cancelEvent(event)"></div>\n                </div>\n               </div>`),t.actionsEl.appendChild(n.postponeBtn);var v="post_postpone_btn"+n.id,w=ge(v),f=geByClass1("post_action_tt_content",w),b=geByClass1("post_action_btn_layout",w),k=[-4*(vk.rtl?-1:1),4],C=new ElementTooltip(b,{appendTo:domPN(w),forceSide:"bottom",autoShow:!1,customShow:!0,cls:"_postpone timer_in_tt",noOverflow:!1,centerShift:0,offset:k,content:f,noHideOnClick:!0,align:"left",onShow:()=>{y.activeState=!0},onHide:()=>{y.activeState=!1,setTimeout(()=>{y.postponeDatepicker&&y.postponeDatepicker.hide()},ElementTooltip.FADE_SPEED)},onFirstTimeShow:function(){show(f)}});return cur["postPostponeTT"+n.id]=C,cur.destroy.push(function(){C&&C.destroy()}),addEvent(n.postponeBtn,"click",g),void r.push(function(){removeEvent(n.postponeBtn,"click",g)})}if(c&&(l?u==l:e==i)){var x=d.appendChild(ce("div",{className:"ms_items_more_wrap"})),M=function(e){n.fromKeyboard=checkKeyboardEvent(e),"mouseover"==e.type&&(n.touched||n.fromKeyboard)||(n.fromKeyboard&&hasClass(n.moreWrap,"shown")?n.hide():n.show())},S=function(){n.fromKeyboard||n.hide()};addEvent(x,"mouseover click",M),addEvent(x,"mouseout",S),r.push(function(){removeEvent(x,"mouseover click",M),removeEvent(x,"mouseout",S)}),t.vectorIcon&&(_='<span class="blind_label">'+_+"</span>",addClass(x,"ms_items_more_wrap_vector"));var B=x.appendChild(ce("a",{className:"ms_item_more",innerHTML:'<span class="ms_item_more_label">'+_+"</span>"}));B.setAttribute("tabindex",0),B.setAttribute("role","button");var P=ce("div",{className:"ms_items_more_helper"});o=ce("div",{className:"ms_items_more _more_items"}),P.appendChild(o),x.appendChild(P),n.moreWrap=x}p(u,h,g,o,d)}else isArticleEditorAvailable()&&p(u,h,g,!1,d,[6,8])})}};a&&n.setItems(a),browser.msie&&(removeEvent(e,"MSPointerDown"),addEvent(e,"MSPointerDown",n.activate.pbind(!0)));removeEvent(e,"mouseover"),addEvent(e,"mouseover click",n.activate),t.global||cur.destroy.push(function(){removeEvent(e,"mouseover click",n.activate)});t.forceToUp&&addClass(geByClass1("ms_items_more_wrap",d),"to_up");return n.handlersToClean=r,n}(e,C,{onActivate:function(){cur.attachCount=y.attachCount,cur.chooseMedia=y.chooseMedia,cur.hasChosenMedia=y.hasChosenMedia,cur.lastAddMedia=y,cur.onMediaUploadStarted=f.onMediaUploadStarted,cur.showMediaProgress=y.showMediaProgress,cur.unchooseMedia=y.unchooseMedia,cur.updateChosenMedia=y.updateChosenMedia},onItemClick:function(e){return!(S&&y.attachCount()>=M&&"postpone"!==e&&"mark_as_ads"!==e&&"copyright"!==e)||(vk.widget?showBox("blank.php",{code:1900,limit:M}):showFastBox(getLang("global_error"),getLang("attachments_limit",M)),!1)},hideAfterCount:f.hideAfterCount,topOffset:f.topOffset,forceUp:f.forceUp,global:f.global,maxShown:f.maxShown,forceToUp:f.forceToUp,vectorIcon:f.vectorIcon,ignoreMobile:f.ignoreMobile,actionsEl:k,hideLabel:f.hideLabel});if(I){var T=intval(I.id);if(S){a.innerHTML=`<div id="page_pics_preview${T}" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview${T}" class="page_pics_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview${T}" class="page_docs_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview${T}" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview${T}" class="page_docs_preview media_preview clear_fix"></div><div id="page_adocs_preview${T}" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview${T}" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview${T}" class="page_docs_preview media_preview _page_ppdocs_preview clear_fix"></div><div id="page_progress_preview${T}" class="page_progress_preview media_preview clear_fix"></div>`;var A=domFC(a),D=domNS(A),L=domNS(D),E=domNS(L),N=domNS(E),U=domNS(N),z=domNS(U),q=domNS(z),F=domNS(q);removeClass(a,"media_preview"),addClass(a,"multi_media_preview")}else addClass(a,"med_no_attach"),show(a);return $&&(q=ge("post_postpone_tt_content"+T)),(y={_addMediaLink:e,lnkId:T,menu:I,types:C,phLists:{},handlers:{},postponeIsTooltip:$,chosenMedias:[],limit:M,_showAddMedia:function(){I.show()},_hideAddMedia:function(e){I.hide(e)},hasRestrictingAttach:function(){return geByClass1("medadd_c_market",L)||geByClass1("medadd_c_story",L)},updateChosenMedia:function(e,a,t){y.chooseMedia(e,a,t,null,null,null,!0)},hasChosenMedia:function(e,a){var t=!1;return each(y.chosenMedias,function(){if(this[0]===e&&this[1]===a)return t=!0,!1}),t},chooseMedia:function(t,i,o,d,r,n,l){if(!cur.articleEditorLayer||"article"===t||"poll"===t){if(vk.widget&&(i=clean(i)),t===s&&$){if(hasClass(y.menu.postponeBtn,"on"))return!1;addClass(y.menu.postponeBtn,"on")}if(f.poster&&f.poster.isOpen()&&t!==s&&"copyright"!==t&&f.poster.closeEditor(),y.onChange&&!1===y.onChange(t,i,o,d))return void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),!1;if("note"===t&&(cur.pbNoteAdded=!1),inArray(t,f.disabledTypes||[]))return!1;if((y.attachCount()>=M&&void 0===o.upload_ind&&t!==s&&"mark_as_ads"!==t||y.hasRestrictingAttach())&&"copyright"!==t){if(S)return!1;y.unchooseMedia()}var c=!1,_={},p=null;if(S&&(each(y.chosenMedias,function(e){if(p=e,this[0]==t&&this[1]==i)return c=!0,!1;_[this[0]]=_[this[0]]?_[this[0]]+1:1}),c&&!l||l&&!c))return!1;var b,k,C="",x="",F=!1,O=L,R="",j="";switch(t){case"graffiti":if(_.pretty_cards)return!1;isObject(o)||(o={thumb:o||""}),C=`<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="${(o=Ne(o)).thumb}" /></div>`,O=F=z;break;case"photos_list":if(vk.widget||_.pretty_cards)return!1;hide(this._addMediaLink),vkImage().src=o[1],(H=o[3].replace(/^{|}$/g,""))&&(H+=","),H+='"queue":1',C=`<div${f.nocl?"":` onclick="return showPhoto('${o[4]}', '${o[2]}', '${H.replace(/"/g,"&quot;")});"`} class="fl_l page_preview_photo"><img class="page_preview_photo" src="${o[1]}" /></div>`,O=F=A;break;case"photo":if(_.pretty_cards)return!1;isObject(o)||(o={thumb_m:o[0]||"",thumb_s:o[1]||"",list:o[2]||"",view_opts:o[3]||"",upload_ind:o.upload_ind||void 0}),o=Ne(o),vkImage().src=o.thumb_m;var H=o.view_opts.replace(/^{|}$/g,"");if(vk.widget&&(H=H.replace(/&quot;/g,'"')),H&&(H+=","),H+='"queue":1',y.phLists[i]=o.list,B){if(!o.editable)return!1;if(!f.nocl){var W="{"+H+"}";W=vk.widget?JSON.parse(W):parseJSON(W),o.editable.click=y.showPhoto.pbind(i,o.list,W)}}C=`<div ${f.nocl?"":` onclick="return cur.addMedia[${y.lnkId}].showPhoto('${i}', '${o.list}', {${H.replace(/"/g,"&quot;")}});"`} class="fl_l page_preview_photo${n?" page_preview_ph_graff":""}"><img class="page_preview_photo" src="${o.thumb_m}" /></div>`,F=1,O=A;break;case"video":if(_.pretty_cards)return!1;if(isObject(o)||(o={thumb:o||""}),B){if(!o.editable)return!1;f.nocl||(o.editable.click=showVideo.pbind(i,o.list_id,{queue:1,autoplay:1}))}o=Ne(o),C=`<div ${f.nocl?"":`onclick="return showVideo('${i}', '${o.list_id}', {queue:1,autoplay:1});"`} class="fl_l page_preview_video"><img class="page_preview_video" src="${o.thumb}" /></div>`,F=1,O=A,k=o.list_id;break;case"article":if(vk.widget||_.article||_.page||_.pretty_cards||!o)return!1;C='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+getLang("global_article")+"</div>",x=o.snippet_html,i=o.url,o.rev&&(i+="?rev="+o.rev),O=N;break;case"audio":if(_.pretty_cards)return!1;o=Ne(o),C=Page.addAudioPreview(clean(i),o),R=` id="pam${T}_audio${clean(i)}"`;break;case"audio_playlist":if(_.audio_playlist)return!1;var G=(o=Ne(o)).coverUrl?`background-image:url('${o.coverUrl}'); background-size: cover;`:"",V="";V=o.authorHref?`<a href="${o.authorHref}" onclick="return nav.go(this)">${o.authorName}</a>`:o.authorName;var K="'"+(o.accessHash||"")+"'";x='<div class="audio_pl_attach_preview _audio_pl _audio_pl_'+o.ownerId+"_"+o.id+' clear_fix"><div class="audio_pl_attach_preview__play" onclick="return getAudioPlayer().playPlaylist('+o.ownerId+", "+o.id+", "+K+')"></div><div class="audio_pl_attach_preview__cover" style="'+G+'">'+(o.gridCovers||"")+'</div><div class="audio_pl_attach_preview__title">'+o.title+'</div><div class="audio_pl_attach_preview__info_line">'+V+"</div></div>",C='<span class="medadd_h">'+getLang("global_audio_playlist")+"</span>",O=N;break;case"artist":if(_.artist)return!1;var X=o.coverUrl?`background-image:url('${o.coverUrl}');`:"";x='<div class="audio_artist_attach_preview _audio_artist _audio_pl _audio_pl_'+o.ownerId+"_artist"+o.blockId+' clear_fix"><div class="audio_artist_snippet__cover" style="'+X+'"></div><div class="audio_artist_snippet__info"><div class="audio_artist_snippet__play" onclick="return getAudioPlayer().playBlock(\''+o.ownerId+"', 'artist"+o.blockId+"', '', '', 'artist')\">"+getLang("audio_listen_snippet")+'</div><div class="audio_artist_snippet__title">'+o.title+'</div><div class="audio_artist_snippet__subtitle">'+getLang("global_artist")+"</div></div></div>",C='<span class="medadd_h">'+getLang("global_artist")+"</span>",O=N;break;case"doc":if(vk.widget||_.pretty_cards)return!1;if(o.editable){var Y="stopEvent(event);";(o=Ne(o)).hasBox&&(o.editable.click=(e=>{Page.showGifBox(o.id,o.ownerId,intval(o.postId),intval(o.postOwnerId),o.hash,e)}),Y=`Page.showGifBox(${intval(o.id)}, ${intval(o.ownerId)}, ${intval(o.postId)}, ${intval(o.postOwnerId)}, '${o.hash}', event);`),j+=" page_preview_doc_as_photo_wrap";var[Q]=o.editable.sizes.m||o.editable.sizes.s;C=`<a href="${o.editable.href}" onclick="${f.nocl?"":Y}" class="page_preview_doc_as_photo" target="_blank" rel="noopener" style="background-image: url('${Q}');"><img class="page_preview_doc_as_photo" src="${Q}" />${o.editable.label}</a>`,F=1,O=A}else o.thumb&&o.thumb_s?(C="gif"==o.ext?'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+o.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+o.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint doc_gif">'+o.title+"</div>":'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+o.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+o.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint">'+o.title+"</div>",x='</a><div class="pam_bg"></div>',O=F=D,R=' id="pam'+T+"_doc"+i+'"'):(C="",x='<div class="page_doc_row"><a target="_blank" rel="noopener" href="'+o.href+'" class="page_doc_icon page_doc_icon'+intval(o.type)+'"></a><a target="_blank" href="'+o.href+'" class="page_doc_title">'+o.title+'</a><div class="page_doc_description_row"><div class="page_doc_size">'+o.size_str+"</div></div></div>",R=' id="pam'+T+"_doc"+i+'"');break;case"story":if(vk.widget||_.pretty_cards)return!1;C='<div class="medadd_c_story"><a target="_blank" rel="noopener" '+o.attr+'"><div class="medadd_c_story_thumb fl_l" style="background-image:url('+o.thumb+')"></div></a><div class="medadd_c_story_info fl_l"><a class="medadd_c_story_title" target="_blank" '+o.attr+'">'+o.title+'</a><div class="medadd_c_story_desc">'+o.date_string+"</div></div>",hide(e);break;case"narrative":if(_.narrative)return!1;C='<span class="medadd_h">'+getLang("global_type_narrative")+"</span>",x=o.snippet_html;break;case"mask":if(vk.widget||_.pretty_cards)return!1;C='<div class="medadd_c_mask"><div class="medadd_c_story_thumb fl_l" style="background-image:url(/images/landings/vkmasks/masksSnippet_2x.png)"></div></a><div class="medadd_c_story_info fl_l"><div class="medadd_c_story_title">'+o.share.title+'</div><div class="medadd_c_story_desc">'+o.share.desc+"</div></div>";break;case"share":if(_.share||_.page||_.pretty_cards||_.market||!o.lang)return!1;if(isArray(o)&&(o={domain:o[0],url:o[1],initialPattern:o[2],title:o[3],description:o[4],images:[o[5]],user_id:o[6],photo_id:o[7]}),o.draft){var J={onSuccess:o.onSuccess,onError:o.onError};return y.checkURL(o.url,void 0,{},J),!1}if(!o.title&&!(cur.options.share||{}).allow_preview_empty_links)return(o.onError||function(){})(),!1;if(o.title=unclean((o.title||"").replace(/<br>/g,"\n")),o.description=unclean((o.description||"").replace(/<br>/g,"\n")),o.description_short=unclean((o.description_short||"").replace(/<br>/g,"\n")),o.description_narrow=unclean((o.description_narrow||"").replace(/<br>/g,"\n")),cur.options=cur.options||{},cur.options.share&&cur.options.share.max_title_len&&(o.title=(o.title||"").substr(0,cur.options.share.max_title_len)),cur.options.share&&cur.options.share.max_desc_len&&(o.description=(o.description||"").substr(0,cur.options.share.max_desc_len),o.description_short=(o.description_short||"").substr(0,cur.options.share.max_desc_len),o.description_narrow=(o.description_narrow||"").substr(0,cur.options.share.max_desc_len)),o.media=o.media||i,o.lang&&(cur.lang=extend(cur.lang||{},o.lang)),o=Ne(o),C='<a target="_blank" rel="noopener" href="/away.php?to='+encodeURIComponent(o.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(unclean(o.lang.profile_choose_link))+"</a>",o.map_data){var Z=Ue(N),ee="";ee=o.map_data[3]?o.map_data[3].replace("size=0,0","size="+Z.width+","+Z.height):"/maps?lat="+floatval(o.map_data[0])+"&lng="+floatval(o.map_data[1])+"&z=11&"+(window.isRetina()?"w="+2*Z.width+"&h="+2*Z.height:"w="+Z.width+"&h="+Z.height),C+=`<div class="medadd_c_share_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(o.map_data[0])}, long: ${floatval(o.map_data[1])}, provider: ${intval(o.map_data[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" width="${Z.width}" height="${Z.height}" src="${ee}" /></a></div>`}if(y.shareData=extend(y.shareData||{},o,{imagesStyles:[""]}),O=N,(o.onSuccess||function(){})(),(cur.options.share||{}).button_exclusive&&o.shareButtons)hide(e),(ae=ge("signed"))&&disable(ae);hide(domByClass(I.menuNode,"_type_share")),hide(domByClass(I.menuNode,"_type_market"));break;case"pretty_cards":if(_.share||_.pretty_cards||vk.widget)return!1;var ae;C='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+o.lang.global_wall_pretty_cards+"</div>",(ae=ge("signed"))&&disable(ae),hide(domByClass(I.menuNode,"_type_pretty_cards")),hide(e),O=N;break;case"poll":if(!o.lang||vk.vidget||_.poll||!E||_.pretty_cards)return!1;hide(domByClass(I.menuNode,"_type_poll")),O=E;break;case"map":if(vk.widget||_.pretty_cards)return!1;var te=Ue(z);C=`<span class="medadd_h medadd_h_link inl_bl">${clean(unclean(o[4]))}</span><div class="fl_l medadd_c_map"><a onclick="return showBox('al_places.php', {act: 'geo_box', lat: ${floatval(o[0])}, long: ${floatval(o[1])}, provider: ${intval(o[3])}}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" width="${te.width}" height="${te.height}" src="/maps?lat=${floatval(o[0])}&lng=${floatval(o[1])}&z=11&w=${te.width}&h=${te.height}" /></a></div>`,O=F=z,hide(domByClass(I.menuNode,"_type_map"));break;case"page":if(_.share||_.page||!o.lang||vk.widget||_.pretty_cards)return!1;var ie=o.media.split("_");C='<a href="/page'+o.media+'" onclick="return showWiki({oid: '+ie[0]+", id: "+ie[1]+'}, false, event, {queue: 1})" class="medadd_h medadd_h_page inl_bl">'+o.lang.profile_choose_page+"</a>",O=N;break;case"album":if(vk.widget||_.pretty_cards)return!1;if(o.is_private_album){extend(o.editable,{title:o.title,size:0}),F=1,O=A;break}if(o.thumb.match(/^\/images\//)&&(o.thumb=""),B){if(!o.editable)return!1;extend(o.editable,{title:o.title,size:o.count,click:!f.nocl&&nav.change.pbind({z:"album"+i})})}var oe=o.thumb;vkImage().src=oe,b=f.nocl?"":' href="/album'+i+'" onclick="return nav.change({z: \'album'+i+"'}, event)\"",C=`<a class="${"fl_l page_album_link"+(oe?"":" page_album_nocover")}" ${b}>\n              ${oe?`<div class="page_album_thumb_wrap"><img class="page_album_thumb" src="${oe}"/></div>`:""}\n              <div class="page_album_title">\n                <div class="page_album_size">${o.count}</div>\n                <div class="page_album_title_text">${o.title}</div>\n              </div>\n            </a>`,F=1,O=A;break;case"note":if(!o.lang||vk.widget||_.pretty_cards)return!1;C="<a onclick=\"showWiki({w: 'note"+o.raw+'\', edit: 1}, true, event, {queue: 1})" class="medadd_h medadd_h_note inl_bl">'+o.lang.profile_choose_note+"</a>",x='<div class="medadd_c medadd_c_note"><a onclick="showWiki({w: \'note'+o.raw+'\', edit: 1}, true, event, {queue: 1})" id="share_note_title'+o.raw+'">'+o.title+"</a></div>",O=N;break;case"market":if(vk.widget||_.pretty_cards||_.share)return!1;C='<div class="medadd_c_market"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_market_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_market_info fl_l"><a class="medadd_c_market_title" target="_blank" href="'+o.href+'">'+o.title+'</a><div class="medadd_c_market_price">'+o.price+"</div></div>",hide(e);break;case"market_album":if(vk.widget||_.pretty_cards)return!1;if(o.is_private_album){extend(o.editable,{title:o.title,msize:""}),F=1,O=A;break}if(B){if(!o.editable)return!1;extend(o.editable,{title:o.title,msize:langNumeric(o.count,o.lang.profile_X_market_items),click:!1})}ie=i.split("_");vkImage().src=o.thumb,b=f.nocl?"":' href="/market'+ie[0]+"?section=album_"+ie[1]+'"',C=`<a class="${"fl_l page_preview_album wall_album_cover_wrap wall_market_album_cover"+(o.thumb?"":" page_album_nocover")}" ${b}>\n              ${o.thumb?`<img class="wall_album_cover" src="${o.thumb}"/>`:""}\n              <div class="wall_album_caption">\n                <div class="wall_album_title_wrap clear_fix">\n                  <div class="wall_album_count fl_r">${o.count}</div>\n                  <div class="wall_album_title">${o.title}</div>\n                </div>\n              </div>\n            </a>`,F=1,O=A;break;case"copyright":if(vk.widget)return!1;y.copyrightCreate(o);break;case s:if(vk.widget)return!1;var de="";if(cur.editingPost&&!S)i=intval(i),o.date=i||intval(cur.editingPost[7]),ge("wpe_save").innerHTML=getLang("global_save"),de=getLang("global_save");else if(cur.editingPost&&"wpe_media_preview"==a.id){i=intval(i),o.date=i||intval(cur.editingPost[7]);var ne=geByClass1("medadd_c_timersett",q);if(ne){var le=domPN(ne);ne=le.innerHTML,re(le)}else ne="";ge("wpe_save").innerHTML=getLang("global_save"),de=getLang("global_save")}else{o.draft?o.date=intval(i):cur.postponedLastDate&&(o.date=intval(cur.postponedLastDate)+3600);var _e=ge("official");if(!(Se=gpeByClass("_submit_post_box",_e))&&f.poster&&domClosest("poster",_e)&&(Se=ge("submit_post_box")),_e&&Se){var pe=domData(Se,"from-oid"),ue=domData(Se,"oid");pe==vk.id&&ue&&wall.setReplyAsGroup(_e,{from:ue}),disable(_e);var he=window.data(_e,"tt");if(he&&he.rdBtns){var me=he.rdBtns[1],ve=he.rdBtnsGroup,we=domData(me,"as");radiobtn(me,we,ve)}}(me=ge("send_post"))&&(me.innerHTML=o.lang.profile_wall_postpone_btn,de=o.lang.profile_wall_postpone_btn)}$?(y.updatePostponeBtnText(!1,o.date),y.postponeDate=o.date):C=`<div class="medadd_h medadd_h_timer inl_bl">${o.lang.profile_choose_timer}<span id="postpone_preview${T}"></span></div>`,!y.postponeDatepicker&&$&&y.setupPostpone(o,ne),f.poster&&f.poster.changeBtnText(de);var fe=Math.round((new Date).getTime()/1e3);intval(o.date)<fe&&(o.date=fe+3600),hide(domByClass(I.menuNode,"_type_postpone")),O=q;break;case"mark_as_ads":if(vk.widget)return!1;C='<div class="medadd_h medadd_h_mark_as_ads inl_bl">'+o.lang.global_ads_wall_post_mark_as_ads_action+"</div>",hide(domByClass(I.menuNode,"_type_mark_as_ads")),O=q;break;case"wall":if(vk.widget||_.pretty_cards)return!1;C='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+o.href+'">'+o.author+'</a><div class="medadd_c_wall_type">'+o.lang.title+"</div></div>",R=' id="pam'+T+"_wall"+i+'"',hide(e);break;case"wall_reply":if(vk.widget||_.pretty_cards)return!1;C='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+o.href+'">'+o.author+'</a><div class="medadd_c_wall_type">'+o.lang.title+"</div></div>",R=' id="pam'+T+"_wall_reply"+i+'"',hide(e);break;case"podcast":if(vk.widget||_.pretty_cards)return!1;var be="_im_media_preview"===domPN(O).id,ke=!be&&cur.editingPost&&"wpe_media_preview"===domPN(O).id;if(be)C='<div class="medadd_c_podcast"><a target="_blank" rel="noopener" href="'+o.href+'"><img class="medadd_c_podcast_thumb fl_l" src="'+o.thumb+'" /></a><div class="medadd_c_podcast_info fl_l"><a class="medadd_c_podcast_title" target="_blank" href="'+o.href+'">'+o.title+'</a><div class="medadd_c_podcast_type">'+o.lang.title+"</div></div>";else{var ye=!1;each(y.chosenMedias||[],function(e,a){isArray(a)&&"podcast"===a[0]&&(cur.addMedia[y.lnkId].unchooseMedia(e),ye=!0)}),ye&&y.onChange&&y.onChange(t,i,o,d),C='<div class="podcast_preview_title">'+getLang("audio_podcast_attach_media")+"</div>";var Ce=o.audio[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+o.audio[AudioUtils.AUDIO_ITEM_INDEX_ID];cur.podcastEditData={audioId:Ce,ref:"post",onCreate:function(e,a){y.chooseMedia("podcast",e[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[AudioUtils.AUDIO_ITEM_INDEX_ID],{audio:e,coverUrl:a})}};var xe="<span class=\"podcast_snippet__edit\" onclick=\"cur.chooseMedia = cur.podcastEditData.chooseMedia; stManager.add([jsc('web/podcast.js')], function() { Podcast.edit('"+Ce+"'); });\"></span>";C+='<div class="podcast_snippet_loading" id="podcast_loading'+i[0]+'"></div>',stManager.add([jsc("web/podcast.js")],function(){domReplaceEl(ge("podcast_loading"+i[0]),Podcast.drawSnippet(o.audio,o.coverUrl,xe))},!0)}if(O=U,(o.onSuccess||function(){})(),hide(domByClass(I.menuNode,"_type_podcast")),!be&&!ke){var Me=ge("official"),Se=Me&&gpeByClass("_submit_post_box",Me);if(Me&&Se)(pe=domData(Se,"from-oid"))!==(ue=domData(Se,"oid"))&&(j=" attach_disabled")}break;case"group":if(vk.widget||_.pretty_cards||_.group)return!1;if(!(C=getTemplate("event_snippet",extend({bottom:o.private?getTemplate("event_snippet_private_info"):""},o))))return(o.onError||function(){})(),!1;C='<div class="event_preview_title">'+getLang("events_media_type")+"</div>"+C,O=N,(o.onSuccess||function(){})()}if(S){var Be=y.chosenMedias,Pe=c?p:Be.length,$e="";if(B&&1===F)$e=!1;else if("photos_list"===t)$e=se('<div class="page_preview_'+t+"_wrap"+j+'" style="position: relative">'+C+'<div class="page_photos_count">'+i.split(",").length+"</div></div>");else if(t==s&&$||"copyright"===t)$e=!1;else{var Ie=null;"share"===t&&o.map_data&&(Ie="map"),$e=se('<div class="page_preview_'+(Ie||t)+"_wrap"+j+'"'+(f.nocl?' style="cursor: default"':"")+R+'><div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+y.lnkId+"].unchooseMedia("+Pe+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+C+x+"</div>")}if(addClass($e,F?"fl_l":"clear_fix"),void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),f.toggleLnk&&!c){var Te=y.attachCount()+1<M;toggle(e,Te),f.onToggleBlock&&f.onToggleBlock(Te)}B&&1===F?(addClass(O,"editable_thumbs_wrap"),O=domLC(O)&&hasClass(domLC(O),"editable_thumbs")?domLC(O):O.appendChild(ce("div",{id:"thumbs_edit"+T,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css",jsc("web/thumbs_edit.js")],()=>{if(Be[Pe]&&(Be[Pe].type===t||Be[Pe].media!==i)){if(f.toggleLnk&&!c){var s=y.attachCount()+1<M;toggle(e,s),f.onToggleBlock&&f.onToggleBlock(s)}o.editable.remove=y.unchooseMedia.pbind(Pe),show(domPN(O));var d=ThumbsEdit.convert(t,i,o.editable);domData(O,"te-inited")?c?ThumbsEdit.updateMedia(O,t,i,o):ThumbsEdit.addMedia(O,d):ThumbsEdit.init(O,[d],{width:f.teWidth,height:f.teHeight,force:!0,onMove:f.onAddMediaChange,onUpdate:f.onChangedSize,deferred:!0}),toggleClass(a,"media_preview_has_medias",y.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),f.onChangedSize&&f.onChangedSize()}},!0)):((t!=s&&"copyright"!=t||!$)&&(show(O),c?O.replaceChild($e,Be[p][2]):O.appendChild($e)),P&&(O==L?stManager.add(["sorter.js"],function(){var e=getXY(L),a=getSize(L),t=function(){L.sorter?sorter.added(L):O.childNodes.length>1&&sorter.init(L,{onReorder:f.onAddMediaChange})};e[0]||e[1]||a[0]||a[1]?t():cur.sorterClbk=t,f.onChangedSize&&f.onChangedSize()},!0):O==D&&stManager.add(["qsorter.js"],function(){D.qsorter?qsorter.added(D):O.childNodes.length>1&&qsorter.init(D,y.qsorterOpts()),f.onChangedSize&&f.onChangedSize()},!0)),f.onChangedSize&&f.onChangedSize()),c?Be[p]=[t,i,$e,d,k,o]:Be.push([t,i,$e,d,k,o])}else{Pe=0;if(t===s?Pe=1:"mark_as_ads"===t&&(Pe=2),t==s&&$||"copyright"===t)$e=!1;else{var Ae=(!1===F?"page_docs_preview":"page_pics_preview")+(Pe?"":" post_thumbed_media");Ae+=F?" fl_l":" clear_fix";var De=null;"share"===t&&o.map_data&&(De="map"),$e=se(`\n            <div class="${Ae}">\n              <div class="${"page_preview_"+(De||t)+"_wrap"} ${j}" ${(f.nocl?'style="cursor: default"':"")+R}>\n                ${C}\n                <div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="${getLang("dont_attach")}" aria-label="${getLang("dont_attach")}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[${y.lnkId}].unchooseMedia(${Pe}); return cancelEvent(event);">\n                  <div class="page_media_x" nosorthandle="1"></div>\n                </div>\n                ${x}\n              </div>\n            </div>`)}void 0!==o.upload_ind&&re("upload"+o.upload_ind+"_progress_wrap"),"postpone"!==t&&"mark_as_ads"!==t&&"copyright"!==t&&(y.chosenMedia=[t,i],y.chosenMedia[5]=o,y.chosenMediaData=o),y.singleAdded($e,t)}"share"==t?!o.title||d||o.url?o.video?(cur.shareShowImg=0,y.bigLink=!0,y.showExternalPreview()):y.showExternalPreview():(cur.shareShowImg=0,y.showPreview(!0),y.shareData.images=!1):"page"==t?o.nopreview||(cur.shareShowImg=0,y.shareData=extend(y.shareData||{},o,{images:!1}),y.showPreview()):"poll"===t?y.pollCreate(o):t==s?$?y.postponeInd=Pe:y.setupPostpone(o,ne):"mark_as_ads"==t?y.markAsAds=1:"pretty_cards"==t&&y.createPrettyCards(o),toggleClass(a,"media_preview_has_medias",y.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),f.onChangedSize&&f.onChangedSize();var Le=window.event;return Le&&"click"==Le.type&&(Le.ctrlKey||Le.metaKey||Le.shiftKey)&&y.attachCount()+1<=M&&(r=!0),cur.fileApiUploadStarted&&void 0!==o.upload_ind||cur.preventBoxHideWithSharedBox||cur.preventBoxHide||!0===r||inArray(t,["poll","share","page","postpone","mark_as_ads","pretty_cards","copyright"])||boxQueue.hideLast(),cur.lastPostMsg=!1,f.onMediaAdd&&f.onMediaAdd(),getAudioPlayer().updateCurrentPlaying(),cur.onMediaChanged&&cur.onMediaChanged(y.chosenMedias),f.onMediaChanged&&f.onMediaChanged(),void 0!==o.upload_ind&&delete o.upload_ind,!1}function Ee(e,a){return isString(e)?e=clean(unclean(unclean(e))):(isObject(e)||isArray(e))&&(e=Ne(e,a)),e}function Ne(e,a){if(!vk.widget)return e;if((a=positive(a))>5)return e;if(isArray(e))e.forEach(function(t,i){e[i]=Ee(t,a+1)});else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&(e[t]=Ee(e[t],a+1));return e}function Ue(e){var a=h,t=u;return"im"!==cur.module&&(a=Math.min(parseInt(e.parentElement.offsetWidth),g)||w,t=Math.min(a/2,m),(hasClass(e.parentElement,"reply_media_preview")||"wpe_media_preview"===e.parentElement.id)&&t>v&&(t=v)),{width:a,height:t}}},unchooseMedia:function(t,i){if(y.onChange&&!1===y.onChange(!1,t))return!1;if(S){if(cur.checkURLDomainRequest&&cur.checkURLDomainRequest.abort(),clearTimeout(cur.showLoaderTimeout),clearInterval(cur.shareImgInterval),clearTimeout(cur.shareImgInterval2),clearTimeout(cur.imgLoadTimeout),clearTimeout(cur.checkURLDomainTO),void 0===t){if(window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+T),each(y.chosenMedias,function(e,a){!a||void 0===e||i&&!inArray(a[0],i)||y.unchooseMedia(e)}),y.urlsCancelled=[],f.onChangedSize){f.onChangedSize();var o=setInterval(f.onChangedSize,50);setTimeout(clearTimeout.bind(null,o),500)}return void(y.copyrightToggle&&y.copyrightToggle(!0))}var s=y.chosenMedias;if(s[t]){var d;switch("podcast"===s[t][0]&&(d=cur.editingPost&&!cur.editingPost[3].reply&&"wpe_media_preview"===gpeByClass("multi_media_preview",s[t][2]).id),s[t][2]?((v=geByClass1("page_media_x_wrap",s[t][2],"div"))&&v.tt&&v.tt.el&&v.tt.destroy(),domPN(s[t][2])==L&&L.sorter?(each(L.sorter.elems,function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})}),L.sorter.destroy(),re(s[t][2]),L.childNodes.length>1&&sorter.init(L,{onReorder:f.onAddMediaChange})):domPN(s[t][2])==D&&D.qsorter?(each(D.qsorter.elems,function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})}),D.qsorter.destroy(),re(s[t][2]),D.childNodes.length>1&&qsorter.init(D,y.qsorterOpts())):re(s[t][2])):"photo"!=s[t][0]&&"video"!=s[t][0]&&"album"!=s[t][0]||window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+T,s[t][0]+s[t][1]),s[t][0]){case"page":case"share":y.shareData={},re(y.sharePreview),hide("medadd_c_linkimg_loader"),delete y.sharePreview,show(domByClass(I.menuNode,"_type_share")),show(e),(r=ge("signed"))&&disable(r,!isChecked("official")),show(domByClass(I.menuNode,"_type_market"));break;case"pretty_cards":var r;re(y.prettyCardGallery.el),delete y.prettyCardGallery,(r=ge("signed"))&&disable(r,!isChecked("official")),show(domByClass(I.menuNode,"_type_pretty_cards")),show(e);break;case"poll":re(y.pollPreview),delete y.pollPreview,show(domByClass(I.menuNode,"_type_poll"));break;case"map":show(domByClass(I.menuNode,"_type_map"));break;case"podcast":var n=!0;if(d)+cur.editingPost[0].split("_")[0]!==cur.oid&&(n=!1);else{var l=(c=ge("official"))&&gpeByClass("_submit_post_box",c);if(c&&l)domData(l,"from-oid")!==domData(l,"oid")&&(n=!1)}toggle(domByClass(I.menuNode,"_type_podcast"),n);break;case"market":case"wall":case"wall_reply":case"story":case"narrative":show(e);break;case"postpone":var c,_=geByClass1("medadd_c_timersett",y.postponePreview);cur.editingPost&&_&&!$?re(domFC(y.postponePreview)):(q.innerHTML="",y.postponeDatepicker=null,y.postponeDate=null),y.postponePreview=!1,(c=ge("official"))&&disable(c,!1);var p=f.poster,u="";if(cur.editingPost)if(cur.editingPost[6]&&intval(cur.editingPost[6].getAttribute("data-suggest"))){u=getLang("wall_publish_suggest");var h=ge("wpe_save");h&&(h.innerHTML=u)}else{u=getLang("wall_publish_now");var g=ge("wpe_save");g&&(g.innerHTML=u)}else u=getLang("wall_send"),ge("send_post").innerHTML=u;p&&p.changeBtnText(u),$?(removeClass(y.menu.postponeBtn,"on"),y.updatePostponeBtnText(!0)):show(domByClass(I.menuNode,"_type_postpone"));break;case"mark_as_ads":show(domByClass(I.menuNode,"_type_mark_as_ads")),y.markAsAds=!1;break;case"copyright":y.copyrightRemove()}s[t]=!1}if(f.toggleLnk){n=y.attachCount()<M;toggle(e,n),f.onToggleBlock&&f.onToggleBlock(n)}toggle(A,!!(B?geByClass1("thumb_wrap",A):domFC(A))),toggle(D,!!domFC(D)),toggle(L,!!domFC(L)),toggle(E,!!domFC(E)),toggle(N,!!domFC(N)),toggle(U,!!domFC(U)),toggle(z,!!domFC(z)),$||toggle(q,!!domFC(q)),toggle(F,!!domFC(F))}else{var m,v;if(void 0==t&&(t=0),(v=geByClass("page_media_x_wrap",a,"div")[t])&&v.tt&&v.tt.el&&v.tt.destroy(),1==t){if($)q.innerHTML="",y.postponeDatepicker=null,y.postponeDate=null,removeClass(y.menu.postponeBtn,"on"),y.updatePostponeBtnText(!0);else if(y.postponePreview){show(geByClass1("add_media_type_"+T+"_postpone",I.menuNode,"a"));var w=domPN(y.postponePreview);window.tooltips&&tooltips.destroyAll(w),re(w),y.postponePreview=!1;var b=I.lastTypes;each(I.types,function(e,a){"postpone"===a[0]&&b.push(a)}),I.setItems(b)}}else if(2==t&&y.markAsAds){y.markAsAds=!1;var k=geByClass1("page_preview_mark_as_ads_wrap",a);window.tooltips&&k&&tooltips.destroyAll(k),re(k);b=I.lastTypes;each(I.types,function(e,a){"mark_as_ads"===a[0]&&b.push(a)}),I.setItems(b)}else if(3===t)y.copyrightRemove();else{if(y.postponePreview||y.markAsAds){w=y.postponePreview&&domPN(y.postponePreview),k=y.markAsAds&&domPN(geByClass1("page_preview_mark_as_ads_wrap",a));for(var C=[],x=0;x<a.childNodes.length;x++){var P=a.childNodes[x];"DIV"==P.nodeName&&P!=w&&P!=k&&C.push(P)}each(C,function(e,a){re(a)});b=[];each(I.types,function(e,a){"postpone"===a[0]&&y.postponePreview||"mark_as_ads"===a[0]&&y.markAsAds||b.push(a)}),I.setItems(b)}else val(a,""),addClass(a,"med_no_attach"),I.setItems(I.types);y.chosenMedia&&(y.chosenMedia=!1,y.chosenMediaData=!1),(m=y.shareData)&&(m.url&&y.urlsCancelled.push(m.url),m.initialPattern&&y.urlsCancelled.push(m.initialPattern),y.shareData={}),each([y.sharePreview,y.pollPreview],function(){re(this)}),y.sharePreview=y.pollPreview=!1}f.toggleLnk&&show(e)}if(toggleClass(a,"media_preview_has_medias",y.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),y.copyrightToggle&&y.copyrightToggle(!0),cur.onMediaChanged&&cur.onMediaChanged(s),f.onMediaChanged&&f.onMediaChanged(),cur.lastPostMsg=!1,y.onChange&&y.onChange(!1),f.onChangedSize){f.onChangedSize();o=setInterval(f.onChangedSize,50);setTimeout(clearTimeout.bind(null,o),500)}},singleAdded:function(t,i){if("copyright"!==i){if(i===s){if($)return;a.appendChild(t)}else"mark_as_ads"===i?y.postponePreview?a.insertBefore(t,domLC(a)):a.appendChild(t):domFC(a)?a.insertBefore(t,domFC(a)):a.appendChild(t);removeClass(a,"med_no_attach");var o=[];each(I.lastTypes,function(e,a){("postpone"!==a[0]||!y.postponePreview&&"postpone"!==i)&&("mark_as_ads"!==a[0]||!y.markAsAds&&"mark_as_ads"!==i)&&(inArray(i,["postpone","mark_as_ads"])||inArray(a[0],["postpone","mark_as_ads"]))&&o.push(a)}),I.setItems(o),f.toggleLnk&&!o.length&&hide(e)}},getMedias:function(e){if(S){var a=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+T):[],t={},i=y.chosenMedias||[],o=[],s=function(e,a,i){if(i[0]+i[1]==e)return o.push(i),t[e]=!0,!1};return each(a,function(e,a){each(i,s.pbind(a[0]+a[1]))}),each(D.childNodes,function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(i,s.pbind(t[1]+t[2]))}),each(L.childNodes,function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(i,s.pbind(t[1]+t[2]))}),each(i,function(e,a){a&&isArray(a)&&a.length&&!t[a[0]+a[1]]&&o.push(a)}),o}return(i=y.chosenMedia)?[e?i:i[0]+i[1]]:[]},showPhoto:function(e){function a(a,t,i,o){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e,a,t,i){for(var o in!cur.pvData||cur.pvShown&&cur.pvListId==a||delete cur.pvData[a],ajaxCache)o.toString().match(/^\/al_photos\.php\#act=show&draft_photos/)&&delete ajaxCache[o];var s=y.getMedias(),d=[];return each(s,function(e,a){a&&"photo"==a[0]&&d.push(a[1]+"/"+(y.phLists[a[1]]||""))}),t.additional={},t.additional.open_pe=intval(cur.openEditor),cur.openEditor||(t.additional.draft_photos=d.join(";")),delete cur.openEditor,showPhoto(e,a,extend(t,{queue:1}),i)}),showMediaProgress:function(a,t,i){if(y.onProgress&&!1===y.onProgress(a,t,i))return!1;var o=i.loaded/i.total,s=intval(100*o),d=(i.fileName||i.name||"").replace(/[&<>"']/g,""),r=d?t+"_"+d:t,n=d?d.length>33?d.substr(0,30)+"...":d:"",l=ge("upload"+r+"_progress");if(l){show(l);u=geByClass1("ui_progress_bar",l);setStyle(u,{width:s+"%"})}else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[r]=T;var c=`\n          <div class="fl_l">\n            <div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">\n              <div id="upload${r}_progress" class="page_attach_progress ui_progress">\n                <div class="ui_progress_back"></div>\n                <div class="ui_progress_bar"></div>\n              </div>\n            </div>\n          </div>\n          ${n?'<div class="attach_label fl_l">'+n+"</div>":""}\n          <div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200);showTooltip(this, {text: '${getLang("dont_attach")}', shift: [16, 8, 8], black: 1})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="Upload.terminateUpload(${t}, '${d||t}', this);"></div>\n          `;if(S){if(F.appendChild(ce("div",{id:"upload"+r+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"},{marginTop:"6px"})),show(F),f.toggleLnk){var _=y.attachCount()<M;toggle(e,_),f.onToggleBlock&&f.onToggleBlock(_)}}else{var p=ce("div",{id:"upload"+r+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"});y.chosenMedia="progress",y.singleAdded(p,"progress")}f.onChangedSize&&f.onChangedSize(),l=ge("upload"+r+"_progress");var u=geByClass1("ui_progress_bar",l);s?setStyle(u,{width:s+"%"}):(setStyle(u,{width:"1px"}),hide(l))}},hasVisibleRows:function(){var e=!1;return each(geByClass("media_preview",a),function(){if(isVisible(this))return e=!0,!1}),e},attachCount:function(){if(y.attachedCount)return y.attachedCount();if(!a)return 0;if(!S)return a.childNodes.length-(y.postponePreview?1:0)-(y.markAsAds?1:0);var e=(B&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+T]||{}).previews||[]:A.childNodes).length+D.childNodes.length+z.childNodes.length+L.childNodes.length/(L.sorter?2:1)+F.childNodes.length;return y.sharePreview&&++e,y.pollPreview&&++e,e},pollCreate:function(e){var a=e.poll_html;if(cur.addMedia[T].pollInputData=e,E)if(a){var t=`<div class="medadd_c" id="poll_dummy${T}">${a}</div>`;y.pollPreview=E.appendChild(domFC(cf(t)))}else stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],()=>{var a=e.poll_question_length,t=e.question,i=e.lang,o=e[d],s=e.answers,u=e[r],h=e[n],g=e[l],m=e[c],v=e[_],w=e[p],b=e.poll_is_board,k=e.poll_is_edit,C=e.poll_is_not_posted,x=e.poll_backgrounds,M=e.poll_answers_limit||10,S=e.poll_no_animate_opening||e.question,B=`\n          <div class="medadd_h medadd_h_poll inl_bl">\n            ${i.question}\n            <span class="medadd_poll_question_warning"></span>\n          </div>\n          <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" oninput="cur.addMedia[%lnkid%].pollChangeQuestion(this)" maxlength="${a}" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_question${b&&k?" disabled":""}"${b&&k?' readonly="readonly"':""} id="create_poll_question%lnkid%" value="%question%" />\n          <div class="medadd_h">${i.answers}</div>\n          <div class="medadd_poll_answers" id="create_poll_answers%lnkid%">\n            %answers%\n          </div>\n          ${b&&k?"":`<div class="medadd_poll_answer_add_wrap" id="create_poll_add%lnkid%">\n            <div class="medadd_poll_answer_add fakeinput dark" onclick="cur.addMedia[%lnkid%].pollAnswerAdd()">${i.answer_add}</div>\n          </div>`}\n          %backgrounds%\n          %settings%\n          <div class="checkbox medadd_datepicker_checkbox medadd_poll_cb%classuntil%" id="create_poll_until%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.until}</div>\n          <div class="medadd_datepicker">\n            <input type="text" class="medadd_datepicker_date dark" id="create_poll_untildate%lnkid%"/><div class="medadd_datepicker_at datepicker_at">${i.at}</div><input type="text" class="medadd_datepicker_time dark" id="create_poll_untiltime%lnkid%"/>\n          </div>\n          ${b?`\n          <div class="checkbox medadd_poll_cb%classonmain%" id="create_poll_onmain%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.add_to_main}</div>\n          `:""}\n          ${b&&k?`\n          <div class="checkbox medadd_poll_cb%classclosed%" id="create_poll_closed%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.close}</div>\n          `:""}\n        `,P=`\n          <div class="medadd_h">${i.settings}</div>\n          ${k&&!C||b?"":`<div class="checkbox medadd_poll_cb%classanon%" id="create_poll_anonymous%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.anonymous}</div>`}\n          ${k?"":`<div class="checkbox medadd_poll_cb%classmulty%" id="create_poll_multy%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">${i.multy}</div>`}\n        `,$=`\n          <div class="medadd_poll_answer_wrap">\n            <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_answer${b&&k?" disabled":""}"${b&&k?' readonly="readonly"':""} %attrs%/>\n            <div class="page_media_x_wrap medadd_poll_answer_remove" data-title="${i.answer_remove}" aria-label="${i.answer_remove}" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[%lnkid%].pollAnswerRemove(this)">\n              <div class="page_media_x"></div>\n            </div>\n          </div>\n        `,I=`\n          <div class="medadd_h">${i.background}</div>\n          <div class="medadd_poll_backgrounds_wrap" id="create_poll_backgrounds_wrap%lnkid%">\n            <div class="medadd_poll_backgrounds_arrow_prev" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('prev')"></div>\n            <div class="medadd_poll_backgrounds_arrow_next" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging('next')"></div>\n            <div class="medadd_poll_backgrounds" id="create_poll_backgrounds%lnkid%">\n              %backgrounds%\n            </div>\n          </div>\n        `;cur.addMedia[T].answersLimit=M,cur.addMedia[T].tplAnswer=$;var A="";b||(A+=cur.addMedia[T].pollBackgroundGetHtml(),x&&x.forEach(e=>{A+=cur.addMedia[T].pollBackgroundGetHtml(e)}),A+=rs('\n          <div class="medadd_poll_background medadd_poll_background_uploader" onclick="cur.addMedia[%lnkid%].pollBackgroundUpload(this);">\n            <div class="medadd_poll_background_preview"></div>\n          </div>\n        ',{lnkid:T}),A=rs(I,{lnkid:T,backgrounds:A}));var D="";if(!s||isArray(s)&&!s.length){var L=[];for(var N in e)if(e.hasOwnProperty(N)){var U="answers".length+1;if("answers["===N.substr(0,U)){var z=intval(N.slice(U,-1));L.push([z,e[N]])}}L.length?(s=[],L.sort((e,a)=>e[0]<0&&a[0]<0?e[0]<a[0]:e[0]>=0&&a[0]>=0?e[0]>a[0]:a[0]<0).forEach(e=>{s.push([e[0]<0?e[0]:0,e[1]])})):s=[[0,""],[0,""]]}s.forEach((e,a)=>{var[t,i]=e;D+=rs($,{attrs:(t?` id="create_poll_ans${t}"`:"")+(i?` value="${clean(unclean(i))}"`:""),lnkid:T})}),y.pollPreview=E.appendChild(ce("div",{className:"medadd_c medadd_poll",innerHTML:rs(B,{lnkid:T,question:t?clean(unclean(t)):"",classuntil:v?" on":"",settings:rs(P,{lnkid:T,classanon:o?" on":"",classmulty:w?" on":""}),backgrounds:A,answers:D,classonmain:u?" on":"",classclosed:h?" on":""})})),s.length==M&&hide(`create_poll_add${T}`);var q=`create_poll_untildate${T}`,F=new Datepicker(q,{time:`create_poll_untiltime${T}`,width:157,noPast:!0,activePeriod:2592e6,minStep:1,date:v||Math.round(((new Date).getTime()+864e5)/1e3),onUpdate:()=>{var e=new Date,a=new Date(1e3*positive(val(q)));a.getTime()>=e.getTime()+2592e6&&(F.timePicker.hourDD.val(e.getHours()),a.getMinutes()>e.getMinutes()&&F.timePicker.minDD.val(e.getMinutes()),F.setDate(a.getFullYear(),a.getMonth()+1,a.getDate(),!0,e.getHours(),e.getMinutes())),cur.addMedia[T].pollChanged()}});if(cur.addMedia[T].pollBackgroundsPos=0,cur.addMedia[T].pollBackgroundSelect(m?-m:intval(g)),cur.addMedia[T].pollChangeQuestion(ge(`create_poll_question${T}`)),S)elfocus(`create_poll_question${T}`),f.onChangedSize&&f.onChangedSize(),cur.addMedia[T].pollUpdateArrows();else{y.pollPreview.style.position="absolute",y.pollPreview.style.visibility="hidden";var O=y.pollPreview.offsetHeight;y.pollPreview.style.height=0,y.pollPreview.style.position="",y.pollPreview.style.visibility="",animate(y.pollPreview,{height:O},f.mail?0:200,()=>{y.pollPreview.style.height="",elfocus(`create_poll_question${T}`),f.onChangedSize&&f.onChangedSize(),cur.addMedia[T].pollUpdateArrows()})}var R=ge(`create_poll_backgrounds_wrap${T}`);function j(){addEvent(R,browserFeatures.wheelEvent,cur.addMedia[T].pollMouseWheel)}function H(){removeEvent(R,browserFeatures.wheelEvent,cur.addMedia[T].pollMouseWheel)}addEvent(R,"mouseenter",j),addEvent(R,"mouseleave",H),cur.destroy.push(function(){removeEvent(R,browserFeatures.wheelEvent,cur.addMedia[T].pollMouseWheel),removeEvent(R,"mouseenter",j),removeEvent(R,"mouseleave",H)})})},pollMouseWheel:function(e){cancelEvent(e);var a=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;cur.addMedia[T].pollBackgroundsPaging(a,!0)},pollBackgroundsPaging:function(e,a){var t=ge(`create_poll_backgrounds_wrap${T}`),i=ge(`create_poll_backgrounds${T}`),o=t.offsetWidth,s=cur.addMedia[T].pollBackgroundsPos;isNumeric(e)?s+=e:"next"===e?s+=o:s-=o,cur.addMedia[T].pollBackgroundsPos=Math.max(0,Math.min(s,i.scrollWidth-o)),a?removeClass(i,"animated"):addClass(i,"animated"),setStyle(i,"transform","translateX("+cur.addMedia[T].pollBackgroundsPos*(vk.rtl?1:-1)+"px)"),cur.addMedia[T].pollUpdateArrows()},pollUpdateArrows:function(){var e=ge(`create_poll_backgrounds_wrap${T}`),a=ge(`create_poll_backgrounds${T}`);if(e){var t=e.offsetWidth,i=a.scrollWidth-t;toggleClass(e,"medadd_poll_backgrounds_arrow_prev_disabled",0===cur.addMedia[T].pollBackgroundsPos),toggleClass(e,"medadd_poll_backgrounds_arrow_next_disabled",cur.addMedia[T].pollBackgroundsPos===i||i<=0)}},pollUntilGet:function(){var e=isChecked(`create_poll_until${T}`)?positive(val(`create_poll_untildate${T}`)):0;return Math.min(e,(new Date).getTime()+2592e6)},pollBackgroundChange:function(e,a){var t=gpeByClass("medadd_poll_backgrounds",e),i=geByClass1("medadd_poll_background_radio",e);geByClass("medadd_poll_background_radio",t).forEach(e=>{checkbox(e,e===i)}),cur.addMedia[T].pollChanged()},pollAnswerAdd:function(){var e=ge("create_poll_answers"+T),a=geByClass("medadd_poll_answer_wrap",e).length,t=cur.addMedia[T].answersLimit;if(a<t){var i=cf(rs(cur.addMedia[T].tplAnswer,{lnkid:T}));e.appendChild(i);var o=geByClass("medadd_poll_answer",e).pop();elfocus(o)}f.onChangedSize&&f.onChangedSize(),toggle("create_poll_add"+T,a<t-1)},pollAnswerRemove:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),f.onChangedSize&&f.onChangedSize(),cur.addMedia[T].pollChanged(),show("create_poll_add"+T)},pollKeydown:function(e,a){if((a=a||window.event)&&(10==a.keyCode||a.keyCode==KEY.ENTER||a.keyCode==KEY.TAB)){var t=hasClass(e,"medadd_poll_question"),i=a.shiftKey;if(t&&i)return;var o=t?domFC(domNS(domNS(e))):(i?domPS:domNS)(domPN(e));return o?elfocus(geByTag1("input",o)):i?elfocus(geByClass1("medadd_poll_question",domPN(domPN(domPN(e))))):this.pollAnswerAdd(),cancelEvent(a)}},pollKeyup:function(e,a){(!(a=a||window.event)||10!=a.keyCode&&a.keyCode!=KEY.ENTER&&a.keyCode!=KEY.TAB)&&(cur.addMedia[T].pollChangedTimeout&&clearTimeout(cur.addMedia[T].pollChangedTimeout),cur.addMedia[T].pollChangedTimeout=setTimeout(()=>cur.addMedia[T].pollChanged(),100))},pollBackgroundGetHtml:function(e){var a="",[t]=e||[0];if(t<0){var[,i,o,s,d]=e;a=`\n          <div class="medadd_poll_background" onclick="cur.addMedia[${T}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview">\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n              <div class="medadd_poll_background_photo" style="background: rgb(${o}, ${s}, ${d});">\n                <div class="medadd_poll_background_photo_holder">\n                  <div class="medadd_poll_background_photo_gradient" style="background: linear-gradient(0, rgba(${o}, ${s}, ${d}, 1) 0, rgba(${o}, ${s}, ${d}, 0) 50%)"></div>\n                  <img src="${i}" class="medadd_poll_background_photo_img"/>\n                </div>\n              </div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}" data-photo-r="${o}" data-photo-g="${s}" data-photo-b="${d}" data-photo-url="${i}"></div>\n          </div>\n        `}else{var r="",n="";if(t){var[,l]=e;if("gradient"===l){var[,,c,_]=e,p=[];_.forEach(e=>{var[a,t]=e;p.push(`#${t} ${Math.round(100*a)}%`)}),r=`background: linear-gradient(${c-90}deg, ${p.join(",")});"`}else if("tile"===l){var[,,u,h,g]=e;r=`background: url(${g}) top center;background-size: ${u}px ${h}px;"`}}else n=" medadd_poll_background_default";a=`\n          <div class="medadd_poll_background${n}" onclick="cur.addMedia[${T}].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview"${r?` style="${r}"`:""}>\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="${t}"></div>\n          </div>\n        `}return a},pollBackgroundAdd:function(e){var a=ge("create_poll_backgrounds"+T),t=geByClass1("medadd_poll_background_uploader",a),i=cf(cur.addMedia[T].pollBackgroundGetHtml(e));i=domFC(i),a.insertBefore(i,t)},pollBackgroundSelect:function(e){var a=ge("create_poll_backgrounds"+T);if(a){var t=domQuery1(`.radiobtn[data-id="${e}"]`,a)||domQuery1('.radiobtn[data-id="0"]',a);if(t){var i=domPN(t);cur.addMedia[T].pollBackgroundsPos=(i.offsetLeft-a.offsetWidth/2+i.offsetWidth/2)*(vk.rtl?-1:1),cur.addMedia[T].pollBackgroundsPaging(0,!0),cur.addMedia[T].pollBackgroundChange(i)}}},pollBackgroundGet:function(){var e=domQuery1(`#create_poll_backgrounds${T} .radiobtn.on`);return intval(domData(e,"id"))},pollBackgroundUploaded:function(e,a,t){var i=-intval(e);cur.addMedia[T].pollBackgroundAdd([i,clean(a),intval(t.r),intval(t.g),intval(t.b)]),cur.addMedia[T].pollBackgroundSelect(i)},pollBackgroundUpload:function(){var e=cur.addMedia[T].pollInputData;showBox("al_page.php",{act:"owner_photo_box",oid:e&&e.poll_owner_id||(f.mail?cur.gid?-cur.gid:vk.id:cur.oid||vk.id),lnk_id:T,is_voting:1},{stat:["owner_photo.css","owner_photo.js"]})},pollChanged:function(){f.onMediaChange&&f.onMediaChange()},pollBackgroundsGet:function(){var e=cur.addMedia[T].pollInputData,a=[];e&&e.poll_backgrounds&&e.poll_backgrounds.forEach(e=>{var[t]=e;t>0&&a.push(e)});var t=ge("create_poll_backgrounds"+T);return geByClass("radiobtn",t).forEach(function(e){var t=intval(domData(e,"id"));t&&t<0&&a.push([t,domData(e,"photo-url"),intval(domData(e,"photo-r")),intval(domData(e,"photo-g")),intval(domData(e,"photo-b"))])}),a},pollData:function(e,a){var t=cur.addMedia[T],i={};if(t&&ge("create_poll_question"+T)){for(var o=ge("create_poll_answers"+T),s=!1,u=0,h=domFC(o);h;h=domNS(h)){var g=trim(val(domFC(h)));if(g){var m=-intval((domFC(h).id.match(/^create_poll_ans(\d+)$/)||[0,-u++])[1]);i[`answers[${m}]`]=g,s=!0}}if(!s)return domFC(o)||t.pollAnswerAdd(),!0!==e&&notaBene(domFC(domFC(o))),!1;var v=trim(val("create_poll_question"+T));if(!v)return!0!==e&&notaBene("create_poll_question"+T),!1;i.question=v,i[_]=t.pollUntilGet();var w=t.pollBackgroundGet();if(w<0?(i[c]=-w,i[l]=0):w>=0&&(i[c]=0,i[l]=w),i[d]=isChecked("create_poll_anonymous"+T)?1:0,i[r]=isChecked("create_poll_onmain"+T)?1:0,i[n]=isChecked("create_poll_closed"+T)?1:0,i[p]=isChecked("create_poll_multy"+T)?1:0,t.pollInputData&&a){i.poll_backgrounds=t.pollBackgroundsGet();var b=["poll_is_board","poll_is_edit","poll_id","poll_answers_limit"];f.mail&&b.push("lang"),b.forEach(e=>{t.pollInputData[e]&&(i[e]=t.pollInputData[e])}),f.mail&&(i.poll_is_edited=0,i["answers[0]"]||i.question!=t.pollInputData.question?i.poll_is_edited=1:[d,r,n,p,_,c,l].forEach(e=>{intval(i[e])!==intval(t.pollInputData[e])&&(i.poll_is_edited=1)}),i.poll_is_edited||t.pollInputData.answers.forEach(e=>{var[a,t]=e;void 0!==i[`answers[${-a}]`]&&i[`answers[${-a}]`]==t||(i.poll_is_edited=1)}))}}else t&&ge("poll_dummy"+T)&&t.pollInputData&&t.pollInputData.poll_id&&(i.poll_id=t.pollInputData.poll_id);return i},pollChangeQuestion:function(e){var a=cur.addMedia[T].pollInputData,t=a.poll_question_length-e.value.length,i=geByClass1("medadd_poll_question_warning");i.innerHTML=t<=20?langNumeric(t,a.lang.question_length):""},markAsAdsInit(){var e=this.markAsAdsGetCheckboxEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].markAsAdsChanged();`)},markAsAdsGetCheckboxEl:()=>!!b&&b.querySelector(".Post__markAsAdsButton"),markAsAdsData(e){var a=!!e&&{},t=this.markAsAds||isChecked(this.markAsAdsGetCheckboxEl());return!t&&this.chosenMedias&&(t=this.chosenMedias.some(e=>{if(isArray(e)){var[a]=e;if("mark_as_ads"===a)return!0}})),(t||e)&&(a={mark_as_ads:t?1:0}),a},markAsAdsChanged(){var e=this.markAsAdsGetCheckboxEl();if(e){checkbox(e),Wall&&Wall.togglePostMarkAsAds(e,e.dataset.muteId);var a=this.markAsAdsData(!0).mark_as_ads;y.copyrightToggle&&y.copyrightToggle(!a),f.onMediaChange&&f.onMediaChange()}},copyrightInit(){var e=this.copyrightGetBtnEl();e&&attr(e,"onclick",`cur.addMedia[${this.lnkId}].copyrightShowBox();`),this.markAsAdsData(!0).mark_as_ads&&this.copyrightToggle(!1)},copyrightToggle(e){var a=document.querySelector(`#post_copyright_btn${this.lnkId}`);toggle(a,e);var t=this.copyrightGetBtnEl();t&&(e?(this.copyrightData(!0).copyright?(val(t,getLang("wall_post_copyright_edit_button")),t.classList.add("Post__copyrightButton--added")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added")),t.classList.remove("Post__copyrightButton--disabled")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added"),t.classList.add("Post__copyrightButton--disabled")))},copyrightGetBtnEl:()=>!!b&&b.querySelector(".Post__copyrightButton"),copyrightCreate(e){if(this.copyrightInputData=e,k&&e&&e.copyright){var a=`post_copyright_btn${this.lnkId}`,t=document.querySelector(`#${a}`);if(!t){var i=getLang("wall_post_copyright_source_text");t=cf(`<div class="post_action_btn on" id="${a}" onclick="cur.addMedia[${this.lnkId}].copyrightShowBox();">\n              <div class="post_action_btn_layout">\n                <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(i)}">${i}</span>\n              </div>\n             </div>`),k.appendChild(t)}}this.copyrightChanged()},copyrightRemove(){var e=document.querySelector(`#post_copyright_btn${this.lnkId}`);e&&e.parentNode.removeChild(e),this.copyrightInputData&&(this.copyrightInputData.copyright=""),this.copyrightChanged()},copyrightUnchoose(){this.chosenMedias&&this.chosenMedias.forEach((e,a)=>{isArray(e)&&"copyright"===e[0]&&this.unchooseMedia(a)}),this.multi||this.copyrightRemove()},copyrightBoxAccept(e){var a=e.btns.ok[0],t=document.querySelector(".PostCopyrightBox__input"),i=document.querySelector(".PostCopyrightBox__error");if(hide(i),!buttonLocked(a)){var o=val(t);if(!o)return notaBene(t);ajax.post("al_wall.php",{act:"copyright_check_link",link:o},{onDone:()=>{this.copyrightInputData||(this.copyrightInputData={}),this.copyrightInputData.copyright=o,this.chooseMedia("copyright","",this.copyrightInputData),e.hide()},onFail:e=>(val(i,e),show(i),!0),showProgress:()=>lockButton(a),hideProgress:()=>unlockButton(a)})}},copyrightBoxDecline(e,a){a&&this.copyrightUnchoose(),e.hide()},copyrightShowBox(){showBox("al_wall.php",{act:"copyright_box"},{cache:!0,onDone:e=>{cur.postCopyrightFeatureTT&&cur.postCopyrightFeatureTT.hide();var a=this.copyrightData(!0);e.removeButtons(),a.copyright?(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text_edit")}),e.setButtons(getLang("wall_post_copyright_edit_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText(`<a onclick="cur.addMedia[${this.lnkId}].copyrightBoxDecline(curBox(), true);">${getLang("global_delete")}</a>`)):(e.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text")}),e.setButtons(getLang("wall_post_copyright_add_button"),()=>this.copyrightBoxAccept(e),getLang("global_cancel"),()=>this.copyrightBoxDecline(e)),e.setControlsText("")),e.show();var t=document.querySelector(".PostCopyrightBox__input");val(t,a.copyright||""),addEvent(t,"keypress",a=>Object(o.d)(()=>{this.copyrightBoxAccept(e)},a)),t.focus()}})},copyrightChanged(){var e=this.markAsAdsData(!0).mark_as_ads;this.copyrightToggle(!e),f.onMediaChange&&f.onMediaChange()},copyrightData(e){var a=!!e&&{};return(this.copyrightInputData&&this.copyrightInputData.copyright||e)&&(a={copyright:this.copyrightInputData&&this.copyrightInputData.copyright||""}),a},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,a,t){if(!(cur.noCheckMessageURLs||y.chosenMedia||y.urlAttachmentLoading&&y.urlAttachmentLoading[0]>vkNow()-1e4||y.attachCount()>=M)){if(cur.checkMessageHandler&&isFunction(cur.checkMessageHandler)&&cur.checkMessageHandler(e),cur.reply_to&&cur.reply_to[0]){var i=Wall.getReplyName(cur.reply_to[0]);if(i=i&&isArray(i)&&i[1]?i[1]:""){var o=extractUrls(i,a);for(var s in o)if(o.hasOwnProperty(s)){var d=o[s].url;d.match(/^https?:\/\//)||(d="http://"+d),inArray(d,y.urlsCancelled)||y.urlsCancelled.push(d)}}}var r=extractUrls(e,a).map(function(e){var a=e.url,t=e.query,i=e.domain,o=a,s={};a.match(/^https?:\/\//)||(a="http://"+a);var d=inArray(a,y.urlsCancelled)||inArray(o,y.urlsCancelled),r=!0,n=!1;if(!d&&i.match(/(^|\.|\/\/)(vkontakte\.ru|vk\.com)/i)){r=!!t.match(/(#photo|^\/(photo|video|album|page|audio|doc|mask|poll|podcast)|z=(album|photo|video|audio_playlist|podcast)|w=(page|product|poll))(-?\d+_)?\d+|app\d+(?:_-\d+)?|\.(jpg|png|gif)$|artist\/([^\/]+).*$|market-?\d+\?section=album_\d+|^\/stickers\/.+$|\?w\=story(\d+)_(\d+)$|stor(y|ies)(\d+)_(\d+)$|^(\/dev)?\/(blog|press)\/.+$|^\/jobs\?w=job\d+$|^\/landings\/.+$|\?w\=vk10\_years(\d+)$|^\/messenger$|^\/fellowship$|^\/bestgames2016$|^\/bestgames2017$|^\/services$|^\/vk_apps_contest$|^\/data_protection(\?section=(rules|requests|principles))?$|^\/safety(\?section=(social|parents|youth|tips))?$|^\/ads(\/([a-zA-Z0-9\_]+))?$|^http:\/\/instagram\.com\/p\/.+/),t.match(/narrative(-?\d+_\d+)/)&&(r=!0);var l=t.match(/^(\/@[._a-zA-Z0-9-]+)([\?|\&]rev=[_a-z0-9]+|[\?|\&]anchor=[-a-zа-я0-9]+)*$/);l&&(o="vk.com"+l[1],delete(s=nav.fromStr(a))[0],r=!0),!r&&t.match(/[a-zA-Z0-9_\.-]{2,32}/)&&(r=!0,n=!0)}return e.url=a,e.canceled=d,e.valid=r,e.initialUrl=o,e.params=s,e.needsCheckDomain=n,e}).filter(function(e){return!e.canceled&&e.valid}).sort(function(e,a){return e.needsCheckDomain-a.needsCheckDomain});if(r.length){var n=r[0];n.needsCheckDomain?y.checkURLDomain(n.query,n.initialUrl,t):y.checkURL(n.initialUrl,t,n.params)}}},checkURLDomain:function(e,a,t){cur.checkURLDomainTO&&clearTimeout(cur.checkURLDomainTO),cur.checkURLDomainTO=setTimeout(function(e,a,t){cur.checkURLDomainRequest=ajax.post("share.php",{act:"id_by_link",url:e},{onDone:function(e,i,o){(o||e&&!i)&&y.checkURL(a,t)},onFail:function(){return!0}})}.pbind(e,a,t),100)},clearCheckURL:function(){clearTimeout(cur.checkURLTO),re(y.urlAttachmentLoading[2]),S?toggle(F,F.childNodes>0):toggleClass(a,"med_no_attach",!a.childNodes),y.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})},onCheckURLDone:function(e,a,t){var i="";a=a||{},y.urlAttachmentLoading&&(i=y.urlAttachmentLoading[1],y.clearCheckURL()),e?y.chooseMedia(t[0],t[1],extend({},t[2],a),i,!0):((f.onCheckURLDone||function(){})(e,t),(a.onError||function(){})(t))},cancelCheckUrl:function(){re(y.checkURLForm)},_getShareTimeHash:function(){var e=cur.share_timehash||((cur.options||{}).share||{}).timehash||"",a=Math.floor(Date.now()/1e3),t=-1;return e&&(t=parseInt(e.split("_",1)[0])+36e3),t-a<60?Object(i.b)("share.php?act=renew_url_attachment_hash",{act:"renew_url_attachment_hash",hash:e}).then(function(e){var a=e[0];return cur.share_timehash=a,a}):Promise.resolve(e)},checkURL:function(e,a,t={},i={}){e?this._getShareTimeHash().then(function(o){y.urlsCancelled.push(e),y.urlAttachmentLoading=[vkNow(),e],re(y.checkURLForm),y.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+T+'"></iframe>'}),utilsNode.appendChild(y.checkURLForm);var s=y.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+T}));each(extend({hash:o,allowed_share_buttons:((cur.options||{}).share||{}).allowed_buttons||"",index:T,url:e,to_mail:f.mail?1:"",from:cur.module},t),function(e,a){s.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=y.onCheckURLDone.pbind(!0,i),window.onUploadFail=y.onCheckURLDone.pbind(!1,i),a&&(cur.checkURLTO=setTimeout(function(){y.urlAttachmentLoading.length>0&&y.clearCheckURL()},a)),s.submit()}):(i.onError||function(){})()},addPreview:function(e,a){var t=a?" medadd_c_link_hidden":"";return y.sharePreview=N.appendChild(ce("div",{className:"medadd_c medadd_c_link"+t,innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="medadd_c_linkprg">'+getProgressHtml("","medadd_c_linkprg_inner")+"</div>":"")+"</div>"}))},shareImgUrl:function(e){var a=y.shareData;if(isArray(a.preview_images)&&a.preview_images[e])return a.preview_images[e];if(a.images_proxy&&a.images_proxy[e])return a.images_proxy_url+a.images_proxy[e];if(a.images){var t=a.images[e];return isArray(t)&&(t=t[0]?t[0]:""),t}return""},initSnippetVideoFunctions:function(){cur.selectSnippetVideo=function(){var e={to_id:f.toId||cur.postTo,act:"a_choose_video_box",snippet_video:1};showBox("al_video.php",e,{cache:1,dark:1})},cur.chooseSnippetVideo=function(e,a){var t=y.shareData,i=e.split("_");t.video_owner_id=i[0],t.video_id=i[1],t.video_full_id=e,t.video=a;var o=!1;for(var s of Object.keys(a.editable.sizes))(o&&a.editable.sizes[s][1]>a.editable.sizes[o][1]||!o)&&(o=s);if(o){var d=a.editable.sizes[o];t.images[t.images.length-1]=[d[0],i[0],i[1],"video",a.editable.duration],cur.shareShowNext(0,1)}y.showVideoSnippetPreview()}},showPreview:function(e){var t,i,o=y.shareData,s=y.sharePreview||y.addPreview();o.is_product?addClass(domFC(s),"medadd_c_link_product"):removeClass(domFC(s),"medadd_c_link_product"),"comment"===f.from&&(o.images=[]),o.images&&(t=o.images[cur.shareShowImg],i=!(!y.bigLink&&!o.big_link||o.force_small_link));var d=!(!cur.options.share||!cur.options.share.allow_snippet_video),r=o.video&&d;if(o.failed)var n=getLang("page_not_loaded");else{var l,c="",_=clean(y.shareImgUrl(cur.shareShowImg));if(d&&y.initSnippetVideoFunctions(),o.images&&o.images[cur.shareShowImg]&&_){var p=o.images[cur.shareShowImg];if(o.images.length>0){var u=!(!cur.options.share||!cur.options.share.allow_custom_photo),h=u&&!(cur.options.share&&cur.options.share.require_image),g="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",m="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_video")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",v="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_remove_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",w=isArray(p)&&1==p.length,b=w&&!d,k=w&&d,C=o.media&&"_"!=o.media&&u?'<div class="medadd_c_linkimg_controls">  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_l">'+(o.images.length>1?'    <div class="medadd_c_linkimg_controls_btn_arrows_group">      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_left" onclick="cur.shareShowNext(true);"></div>      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_right" onclick="cur.shareShowNext();"></div>    </div>':"")+'    <div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload" '+g+" onclick=\"Page.ownerPhoto('"+o.media+"');\"></div>"+(d?'<div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload_video" '+m+' onclick="cur.selectSnippetVideo();"></div>':"")+"  </div>"+(h?'  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_r">    <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_remove" '+v+' onclick="window.tooltips && window.tooltips.hide(this); cur.removeLinkImage(this)"></div>  </div>':"")+"</div>":"",x=(t?"":"display: none")+";background-image:url("+_+")";o.image_ratio>0&&(x+=";height: 0px; padding-top: "+100*o.image_ratio+"%;min-height: 0px;");var M="video"===p[3];c='<div class="medadd_c_linkimg_container '+(N&&N.offsetWidth>550?"medadd_c_linkimg_container_wide":"")+'" style="'+x+'">'+c+(M?'<div class="medadd_c_linkimg_container_video_overlay"></div>':"")+(M?'<div class="video_thumb_label"><span class="video_thumb_label_item"></span><span class="video_thumb_label_item">'+p[4]+"</span></div>":"")+(b?'<div class="medadd_c_linkimg_button"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+"</button></div>":"")+(k?'<div class="medadd_c_linkimg_button"><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+'</button></div><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark medadd_c_linkimg_video_button" onclick="cur.selectSnippetVideo();">'+getLang("global_link_choose_own_video")+"</button></div></div>":"")+C+'<div id="medadd_c_linkimg_loader" class="medadd_c_linkimg_loader">'+getProgressHtml("","inv medadd_c_linkimg_loader_inner")+"</div></div>"}}var S="";o.microdata&&o.microdata_preview_html&&(S=o.microdata_preview_html);var B={title:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_title")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_title},description:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_desc")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_desc}},P=o.shareButtons,$=P&&P.length&&P[0],I=o.button_text||$&&$[1],T=o.button_text_lang||$&&$[2],A=o.button_action||$&&$[0];if(P&&P.length&&T===I)for(var D=0;D<P.length;++D)if(P[D][0]===A&&P[D][2]===I){I=P[D][1];break}var L=!1;P&&P.length&&(L=P.length>1||T===I||$[0]!==A||$[1]!==I);var E=!!P&&P.length,U=cur.options.share&&cur.options.share.allow_remove_button&&!r;n=c+'<div class="medadd_c_linkwrap '+(c?"":"no_photo")+'"><div class="medadd_c_linkwrap_block">'+(o.title||B.title.editable?'<div class="medadd_c_linkhead '+(B.title.editable?"medadd_inline_editable":"")+'">'+(B.title.editable?'<div class="medadd_inline_editable_icon"></div>':"")+'<span class="medadd_inline_edit_target" data-max-length="'+(cur.options.share&&cur.options.share.max_title_len?cur.options.share.max_title_len:0)+'" data-field="title">'+(clean(o.title).replace(/\n/g,"<br>")||B.title.placeholder)+"</span></div>":"")+(S?'<div class="medadd_c_linkmicrodata">'+S+"</div>":"")+(o.domain?'<div class="page_media_link_url medadd_c_linkaddr">'+o.domain+"</div>":"")+"</div>"+(T&&E?'<div class="medadd_c_linkwrap_block medadd_c_linkwrap_block_button">'+(U?'<div class="hide_icon medadd_c_linkbtn_remove" onclick="cur.shareRemoveButton();" onmouseover="showTooltip(this, {text: \''+getLang("global_share_button_remove_tooltip")+"', black: 1, shift: [15, 10, 0]})\"></div>":"")+'<div class="wall_postlink_preview_btn medadd_c_linkbtn"><a onclick="cur.toggleShareButton(this);return false;" onmouseout="Page.actionsDropdownHide(domNS(this), 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" class="flat_button"><span onmouseover="Page.actionsDropdownUnhide()" class="'+(L?"page_actions_dd_label":"")+' wall_postlink_preview_btn_label" data-field="button_text">'+T+"</span></a></div></div>":"")+'</div><div class="clear_fix"></div>'}if(i?addClass(domFC(s),"medadd_c_linkimg_big"):removeClass(domFC(s),"medadd_c_linkimg_big"),e)cur.preventShareAnim&&(cur.preventShareAnim.stop(),clearInterval(cur.animateUpdateInterval),f.onChangedSize&&f.onChangedSize()),val(domFC(s),n),domFC(s).style.height="auto",l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency();else{show(N);var z=a.appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon '+(i?"medadd_c_linkimg_big":"")+'">'+n+"</div>"},{position:"absolute",width:getSize(s)[0]-10,visibility:"hidden"})),q=getSize(z)[1];re(z),setStyle(domFC(s),{height:"0"}),setStyle(s,{overflow:"hidden"}),val(domFC(s),n),l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency(),cur.animateUpdateInterval=setInterval(function(){f.onChangedSize&&f.onChangedSize()},100),cur.preventShareAnim=animate(domFC(s),{height:q},200,function(){setStyle(domFC(s),{height:"auto",display:""}),setStyle(s,{overflow:""}),clearInterval(cur.animateUpdateInterval),f.onChangedSize&&f.onChangedSize()}),re(geByClass1("medadd_c_linkprg",N))}function F(e){if(!e||e.inlineEdit)return!1;var a=getSize(e),t=gpeByClass("medadd_inline_editable",e);e.inlineEdit=!0,addClass(t,"medadd_inline_editing");var i=ce("textarea",{className:"medadd_inline_edit"},{width:a[0],height:a[1]}),o=parseInt(e.getAttribute("data-max-length"));o&&i.setAttribute("maxlength",o);var s=e.getAttribute("data-field");val(i,y.shareData[s]),val(e,""),e.appendChild(i);var d=ce("span",{className:"medadd_inline_edit_target"},{opacity:0,zIndex:-1,width:a[0],height:"auto",wordWrap:"break-all",position:"absolute"});t.appendChild(d);var r=a[1];elfocus(i),i.onblur=function(){re(d),y.shareData[s]=val(i),val(e,clean(val(i)).replace(/\n/g,"<br>")||B[s].placeholder),removeClass(t,"medadd_inline_editing"),e.inlineEdit=!1};var n=function(){var e=clean(val(i)+" M").replace(/\n/g,"<br>");if(val(d,e),!(e.length>=o)){var a=getSize(d);r!=a[1]&&(r=a[1],animate(i,{height:a[1]},200))}};addEvent(i,"click keyup change",n),setTimeout(n,0)}if(B.title.editable){var O=geByClass1("medadd_c_linkhead",domFC(s)),R=geByClass1("medadd_inline_edit_target",O);O&&R&&(O.onclick=F.bind(this,R))}if(B.description.editable){var j=geByClass1("medadd_inline_edit_target",geByClass1("medadd_c_linkdsc",domFC(s)));j&&(j.onclick=F.bind(this,j))}if(E&&(y.shareData.button_text=I,y.shareData.button_text_lang=T,y.shareData.button_action=A,L)){var H=domPN(geByClass1("wall_postlink_preview_btn_label",domFC(s))),W=[],G=0,V=0,K=[];for(var D in P)if(P.hasOwnProperty(D)){var X=P[D];X[0]==A&&X[1]==I&&(G=V),W.push([V++,X[1]]),K.push('<a class="page_actions_item" tabindex="0" role="link" onclick="cur.updateShareButton(this);Page.actionsDropdownHide(domPN(domPN(this)), 1, cur.setActiveShareButton.pbind(false));return false;" data-button-text="'+X[1]+'" data-button-text-lang="'+X[2]+'" data-button-action="'+X[0]+'">'+X[2]+"</a>")}H.setAttribute("data-items",JSON.stringify(W)),H.setAttribute("data-value",G);var Y=['<div class="page_actions_wrap medadd_c_linkbtn_actions_wrap unshown" onmouseout="Page.actionsDropdownHide(this, 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" onmouseup="setTimeout(function() { Page.actionsDropdownUnhide(); }, 5)">','<div class="page_actions_inner">',K.join(""),"</div>","</div>"].join("");domPN(H).appendChild(se(Y)),ls.get("share_button_text_tooltip_shown")||cur.buttonTextTooltip||setTimeout(function(){cur.closeButtonTextTooltip=function(){cur.buttonTextTooltip.hide(),ls.set("share_button_text_tooltip_shown",1)};var e=geByClass1("wall_postlink_preview_btn_label",domFC(s)),a=domCA(e,".box_layout");cur.buttonTextTooltip=new ElementTooltip(e,{autoShow:!1,appendTo:a||geByTag1("body"),content:'<div class="feature_intro_tt_hide" onclick="cur.closeButtonTextTooltip();"></div>'+getLang("global_share_button_text_tooltip"),forceSide:"left",cls:"feature_intro_tt",offset:[-10,0,0],onHide:function(){cur.buttonTextTooltip.destroy()}}),cur.buttonTextTooltip.show(),addEvent(e,"mouseover",function(){cur.buttonTextTooltip&&cur.buttonTextTooltip.hide()})},1e3)}},showVideoSnippetPreview:function(){if(!(!cur.options.share||!cur.options.share.allow_snippet_video)){var e=y.shareData,a=e.video,t=e.video_owner_id,i=e.video_id;a&&isObject(a)&&t&&i&&a.editable&&(y.initSnippetButtonFunctions(),y.showPreview())}},initSnippetButtonFunctions:function(){cur.shareRemoveButton=function(){var a=y.sharePreview;window.tooltips&&tooltips.destroyAll(a),re(geByClass1("medadd_c_linkwrap_block_button",a)),y.shareData.button_text="",y.shareData.button_text_lang="",y.shareData.button_action="",show(domByClass(e,"media_selector"))},cur.updateShareButton=function(e){var a=e.getAttribute("data-button-text"),t=e.getAttribute("data-button-text-lang"),i=e.getAttribute("data-button-action");y.shareData.button_text=a,y.shareData.button_text_lang=t,y.shareData.button_action=i;var o=y.sharePreview;return val(geByClass1("page_actions_header_inner",o),t),val(geByClass1("wall_postlink_preview_btn_label",o),t),!1},cur.setActiveShareButton=function(e){var a=y.sharePreview;(e?addClass:removeClass)(domPN(geByClass1("wall_postlink_preview_btn_label",a)),"active")},cur.toggleShareButton=function(e){hasClass(e,"active")?(Page.actionsDropdownHide(domNS(e),1),cur.setActiveShareButton(!1)):(Page.actionsDropdown(domNS(e)),cur.setActiveShareButton(!0))}},showExternalPreview:function(){var e=y.shareData;e.images||(e.images=[]);var a,t=[],i=[],o={};each(e.images,function(a,s){o[s]||(o[s]=!0,t.push(s),e.images_proxy&&i.push(e.images_proxy[a]))}),e.uniqueImagesCount=t.length,e.images=t,e.images_proxy=i;var s=!(!cur.options.share||!cur.options.share.allow_snippet_video);if(a=N&&N.offsetWidth>550?isRetina()?"/images/post_snippet_image_placeholder_w_2x.png":"/images/post_snippet_image_placeholder_w.png":s?isRetina()?"/images/post_snippet_image_video_placeholder_2x.png":"/images/post_snippet_image_video_placeholder.png":isRetina()?"/images/post_snippet_image_placeholder_2x.png":"/images/post_snippet_image_placeholder.png",e.placeholder_inserted||(e.images.push([(cur.options.share||{}).allow_custom_photo?a:""]),e.placeholder_inserted=!0),!e.images||!e.images.length)return cur.shareShowImg=0,void y.showPreview();cur.shareShowImg=0,cur.shareShowImg--,y.addPreview(!0,!!e.map_data),e.imagesStyles={};var d=!1;cur.shareSetOwnPhoto=function(a){curBox()&&curBox().hide(),y.bigLink=!0,e.images[e.images.length-1]=[a.photo_url,a.user_id,a.photo_id],cur.shareShowNext(0,1)},cur.shareClearOwnPhoto=function(){e.images[e.images.length-1]=[],cur.shareShowNext(0,0,1)},cur.removeLinkImage=function(e){var a=gpeByClass("medadd_c_linkcon",e);addClass(a,"no_photo"),removeClass(a,"medadd_c_linkimg_big"),re(gpeByClass("medadd_c_linkimg_container",e)),setStyle(a,"height",""),y.shareData.noPhoto=!0},y.initSnippetButtonFunctions(),cur.shareShowNext=function(t,i,o){var s=vkImage();cur.prevShareShowDir=t,o||(i?cur.shareShowImg=e.images.length-1:t?cur.shareShowImg-=1:cur.shareShowImg+=1);var r=isArray(e.images[e.images.length-1])&&!!e.images[e.images.length-1][0];if(!r&&cur.shareShowImg>e.images.length-2)cur.shareShowImg=0;else if(cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(!r&&cur.shareShowImg<0)cur.shareShowImg=e.images.length-2;else if(cur.shareShowImg<0)cur.shareShowImg=e.images.length-1;else if(0==cur.shareShowImg)for(var n=1;n<e.images.length-1;n++){vkImage().src=y.shareImgUrl(n)}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return y.showPreview(d),void(d=!0);var l=y.shareImgUrl(cur.shareShowImg);l&&(s.src=l),e.video=0,isArray(e.images[cur.shareShowImg])&&e.images[cur.shareShowImg][1]&&e.images[cur.shareShowImg][2]?"video"===e.images[cur.shareShowImg][3]?(e.video=1,e.video_owner_id=e.images[cur.shareShowImg][1],e.video_id=e.images[cur.shareShowImg][2]):(e.user_id=e.images[cur.shareShowImg][1],e.photo_id=e.images[cur.shareShowImg][2],e.share_own_image=!0):(e.user_id=void 0,e.photo_id=void 0,e.share_own_image=!1);var c=null;l&&(cur.imgLoadTimeout=c=setTimeout(function(){!0!==cur.shareImgInterval&&(isArray(e.images[cur.shareShowImg])||(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),cur.shareShowNext()))},5e3));var _=setTimeout(function(){show("medadd_c_linkimg_loader"),_=null,f.onChangedSize&&f.onChangedSize()},100);cur.showLoaderTimeout=_;var p=function(){if(s.width||s.height||!l){var t=s.width,i=s.height,o="",r="";if(c&&(clearTimeout(c),c=null),_&&(clearTimeout(_),_=null),hide("medadd_c_linkimg_loader"),clearInterval(cur.shareImgInterval),!isArray(e.images[cur.shareShowImg])&&(t<150||i<67)){if(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext.pbind(0,0,1),0)}else{var n=t>=532&&i>=235,p=(n||!!e.big_link)&&!e.force_small_link;if(cur.options.share&&cur.options.share.force_big_link&&!n){e.images.splice(cur.shareShowImg,1),e.images_proxy.splice(cur.shareShowImg,1);var u=(cur.options.share||{}).allow_custom_photo||(cur.options.share||{}).require_image;return 0==e.images.length&&u&&e.images.push([u?a:""]),cur.prevShareShowDir||cur.shareShowImg--,void cur.shareShowNext(cur.prevShareShowDir)}y.bigLink=p,p?o="width: 100%;":(t>150&&(i=150*i/t,t=150),o="width: "+t+"px; height: "+i+"px;")}e.images.length>1&&(r=""),e.imagesStyles[cur.shareShowImg]='style="'+o+'"'+r,y.showPreview(d),d=!0,f.onAddMediaChange&&f.onAddMediaChange("share",e.media,e)}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(p,300),cur.shareImgInterval2=setTimeout(p,0)},cur.shareShowNext()},uploadShare:function(e){var a=y.shareData,t=y.sharePreview,i=t.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+T+'"></iframe>'})),o=i.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+T})),s=a.images[cur.shareShowImg];each({act:"a_photo",url:a.url,index:T,image:s,extra:a.extra||0,hash:vk.ip_h},function(e,a){o.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),window.onUploadDone=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),y.shareData=extend(y.shareData,{user_id:o.user_id,photo_id:o.photo_id,photo_url:s}),setTimeout(e,0)},window.onUploadFail=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),y.shareData.share_upload_failed=1,setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),o.submit()},setupPostpone:function(e,t,i){var o;o=S||q?q:domPN(geByClass1("page_preview_postpone_wrap",a));var s=cur.editingPost&&"wpe_media_preview"==domPN(o).id,d=s||!S?"":"1px",r=!1,n="",l=`<div class="clear_fix">\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_date${T}" value="${e.date||""}" /></div>\n        <div class="fl_l datepicker_item medadd_c_timerat">${e.lang.profile_wall_postpone_at}</div>\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_time${T}"/></div></div>`;if(cur.editingPost&&void 0!=e.friends_only){l+='<div class="medadd_c_timersett">';var c=e.friends_only?e.lang.friends_only:e.lang.wall_post_access_all;if(r=!0,n=`<div class="post_action_btn post_available ${e.friends_only?"on":""}" id="post_visibility_btn${T}">\n                          <div class="post_action_btn_layout">\n                            <span class="post_action_btn_text" role="button" aria-label="${replaceEntities(c)}">${c}</span>\n                            <div class="post_action_tt_content" id="post_visibility_tt_content${T}">\n                              <div class="eltt_fancy_action radiobtn ${e.friends_only?"":"on"}" id="no_friends_only${T}" onclick="Wall.togglePostFriendsOnly(this, false, ${T})" role="radio" aria-checked="${!e.friends_only}" aria-label="${replaceEntities(e.lang.wall_post_access_all)}">${e.lang.wall_post_access_all}</div>\n                              <div class="eltt_fancy_action radiobtn ${e.friends_only?"on":""}" id="friends_only${T}" onclick="Wall.togglePostFriendsOnly(this, true, ${T})" role="radio" aria-checked="${e.friends_only}" aria-label="${replaceEntities(e.lang.friends_only)}">${e.lang.friends_only}</div>\n                            </div>\n                          </div>\n                         </div>`){var _=geByClass1("post_action_btn",k);_?k.insertBefore(se(n),_):k.appendChild(se(n)),Wall.createVisibilityPostTooltip(T)}}else cur.editingPost&&t&&(l+=t,r=!0);$||(y.postponePreview=o.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(r?" medadd_c_nofixed":"")+($?" timer_in_tt":""),innerHTML:l}))),$&&(y.postponeSubmitWrapper=se(`<div><input type="hidden" id="postpone_date${T}" value="${e.date||""}"><input type="hidden" id="postpone_time${T}"></div>`),o.appendChild(y.postponeSubmitWrapper)),$||(y.postponePreview.style.height=d);var p=`datepicker-inline-container_${T}`,u=`<button class='flat_button reset_time_btn secondary' onclick='cur.addMedia[${T}].onResetPostponeBtnClick()'>${getLang("wall_post_timer_reset")}</button>`,h=`<td class="cal_clear" id="${p}" colspan="7">${u}</td>`;stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){y.postponeDatepicker=new Datepicker("postpone_date"+T,{time:"postpone_time"+T,width:155,noPast:!0,minStep:1,sideTop:cur.oid<0,sideTopOffset:10,inlineTime:$,inlineTimeContainerId:p,inlineTimeContainerIdx:T,addRows:$?"<tr>"+h+"</tr>":null,addRowsM:$?'<tr><td class="cal_clear" colspan="7"></td></tr>':null,onUpdate:function(e,a){var t=[...arguments];f.onMediaChange&&f.onMediaChange.apply(f,t),y.postponeDate=val("postpone_date"+y.lnkId),$&&y.updatePostponeBtnText()},hideAnotherMonth:!1}),s||!S||$||animate(y.postponePreview,{height:33},200,function(){y.postponePreview.style.height=""}),y.menu.postponeBtn&&y.updatePostponeBtnText(),isFunction(i)&&i()})},getPostponeDateString:function(e){if(val("postpone_date"+y.lnkId)||e){e=(e=e||+val("postpone_date"+y.lnkId))+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=getLang("datepicker_dateFormat");"dateFormat"===a&&(a="{day} {month} {year}");var t=new Date(1e3*e),i=t.getDate(),o=t.getMonth()+1,s=t.getFullYear();return a.replace("{day}",i).replace("{month}",winToUtf(getLang("Month"+o+"_of"))).replace("{year}",s)+` ${getLang("profile_wall_postpone_at")} `+`${t.getHours()}:${("0"+t.getMinutes()).slice(-2)}`}},onResetPostponeBtnClick(){cur["postPostponeTT"+y.lnkId].hide(),null!=y.postponeInd&&setTimeout(()=>{y.unchooseMedia(y.postponeInd)},ElementTooltip.FADE_SPEED),cancelEvent(event)},resetPostpone:function(e){if(e){e=e+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=new Date(1e3*e);if(a){var t=a.getDate(),i=a.getMonth()+1,o=a.getFullYear(),s=a.getHours(),d=a.getMinutes();y.postponeDatepicker.timePicker.hourDD.val(s),y.postponeDatepicker.timePicker.minDD.val(d),y.postponeDatepicker.setDate(o,i,t,null,s,d)}}},updatePostponeBtnText:function(e,a){if($){var t=geByClass1("post_action_btn_text",y.menu.postponeBtn),i="";if(e)i=getLang("wall_publication_now");else{var o=y.getPostponeDateString(a);if(!o)return;i=o}t.innerHTML=i,t.setAttribute("aria-label",replaceEntities(i))}},createPrettyCards:function(e){cur.lang=extend(cur.lang||{},e.lang||{});var a=se(e.editor.container_html);N.appendChild(a),y.prettyCardGallery=new PrettyCardGallery(a,e.editor,e.pretty_cards)},destroy:function(){(L||{}).sorter&&L.sorter.destroy();for(var t=0;t<I.handlersToClean.length;t++)I.handlersToClean[t]();(D||{}).qsorter&&D.qsorter.destroy(),removeClass(a,"media_preview_has_medias"),a&&(a.innerHTML=""),show(e)},qsorterOpts:function(){return{xsize:Math.floor(D.offsetWidth/135),width:135,height:102,onReorder:f.onAddMediaChange,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),D.qsorter&&(D.qsorter.destroy(),window.qsorter.init(D,y.qsorterOpts()))}}).copyrightInit(),y.markAsAdsInit(),cur.addMedia||(cur.addMedia={}),cur.addMedia[T]=y,f.onAddMediaChange&&(y.onChange=f.onAddMediaChange),y}};try{stManager.done(jsc("web/ui_media_selector.js"))}catch(e){}},154:function(e,a,t){e.exports=t("/aNj")},BxOC:function(e,a,t){"use strict";t.d(a,"b",function(){return s}),t.d(a,"a",function(){return d});var{ajax:i}=window,o=(t("Btvt"),2);function s(e,a,t){return a&&(a.im_v=o),new Promise((o,s)=>{i.post(e,a,{timeout:t,onDone(){o.apply(null,[[...arguments]])},onFail(){return s.apply(null,arguments),!0}})})}function d(e,a,t={}){var o;return o=window.XDomainRequest?new XDomainRequest:i._getreq(),{request:new Promise((i,s)=>{var d,r=Date.now(),n=t.timeout||60,l=ajx2q(a);if(window.XDomainRequest)o.open("get",`${e}?${l}`),o.ontimeout=function(e){s([e,{}])},o.onerror=function(e){s([e,{}])},o.onload=function(){i([o.responseText,{}])},setTimeout(function(){o.send()},0);else{o.onreadystatechange=function(){4==o.readyState&&(clearInterval(d),o.status>=200&&o.status<300?i([o.responseText,o]):s([o.responseText,o]))};try{o.open("GET",`${e}?${l}`,!0)}catch(e){return s([e,o])}o.send()}d=setInterval(function(){Date.now()-r>1e3*n&&(window.browser.safari&&o.abort(),s(["",{}]),clearInterval(d))},1e3)}),cancel:function(){o.abort()}}}}});